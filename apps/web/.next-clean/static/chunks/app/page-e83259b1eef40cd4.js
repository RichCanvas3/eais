(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{95207:function(e,t,n){Promise.resolve().then(n.bind(n,42290))},42290:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ti}});var a=n(69566),r=n(58590),i=n(72940),o=n(1988),s=n(92002),l=n(84894),d=n(28846),c=n(90510),p=n(28262),u=n(36516),y=n(56808),m=n(94354),g=n(1472),h=n(48434),f=n(67401),b=n(43868),x=n(74911),v=n(43876),w=n(97992),T=n(20851),j=n(45120),S=n(7800),C=n(59111),D=n(54364),E=n(95965),A=n(93191),I=n(59294),Z=n(34934),N=n(78196),R=n(14047),k=n(16325),M=n(89999),P=n(62325),O=n(34114),F=n(67621),U=n(85109),W=n(57200),_=n(31686),L=n(62940),B=n(25),z=n(81497),H=n(79745),G=n(82811),J=n(11023),V=n(85215),K=n(47881),X=n(29289),q=n(47326),Y=JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"owner","type":"address"}],"name":"ERC721IncorrectOwner","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC721InsufficientApproval","type":"error"},{"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC721InvalidApprover","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"}],"name":"ERC721InvalidOperator","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"ERC721InvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC721InvalidReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC721InvalidSender","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC721NonexistentToken","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"_fromTokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"_toTokenId","type":"uint256"}],"name":"BatchMetadataUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"agentId","type":"uint256"},{"indexed":true,"internalType":"string","name":"indexedKey","type":"string"},{"indexed":false,"internalType":"string","name":"key","type":"string"},{"indexed":false,"internalType":"bytes","name":"value","type":"bytes"}],"name":"MetadataSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"MetadataUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"agentId","type":"uint256"},{"indexed":false,"internalType":"string","name":"tokenURI","type":"string"},{"indexed":true,"internalType":"address","name":"owner","type":"address"}],"name":"Registered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"agentId","type":"uint256"},{"indexed":false,"internalType":"string","name":"newUri","type":"string"},{"indexed":true,"internalType":"address","name":"updatedBy","type":"address"}],"name":"UriUpdated","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"string","name":"key","type":"string"}],"name":"getMetadata","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"register","outputs":[{"internalType":"uint256","name":"agentId","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"tokenUri","type":"string"},{"components":[{"internalType":"string","name":"key","type":"string"},{"internalType":"bytes","name":"value","type":"bytes"}],"internalType":"struct IdentityRegistry.MetadataEntry[]","name":"metadata","type":"tuple[]"}],"name":"register","outputs":[{"internalType":"uint256","name":"agentId","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"tokenUri","type":"string"}],"name":"register","outputs":[{"internalType":"uint256","name":"agentId","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"string","name":"newUri","type":"string"}],"name":"setAgentUri","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"string","name":"key","type":"string"},{"internalType":"bytes","name":"value","type":"bytes"}],"name":"setMetadata","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]');async function $(e){let{publicClient:t,registry:n}=e,a=e.agentName.trim().toLowerCase();try{var r,i,o;let e=await t.readContract({address:n,abi:Y,functionName:"resolveByDomain",args:[a]}),s=BigInt(null!==(i=null!==(r=null==e?void 0:e.agentId)&&void 0!==r?r:null==e?void 0:e[0])&&void 0!==i?i:0),l=null!==(o=null==e?void 0:e.agentAddress)&&void 0!==o?o:null==e?void 0:e[2];if(s>0n&&l)return{agentId:s,agentAddress:l}}catch(e){}return null}async function Q(e){let{bundlerUrl:t,chain:n,account:a}=e;if(await a.isDeployed())return!1;let r=(0,J.r)({transport:(0,M.d)(t)}),i=(0,V.E)({transport:(0,M.d)(t),paymaster:!0,chain:n,paymasterContext:{mode:"SPONSORED"}}),{fast:o}=await r.getUserOperationGasPrice(),s=await i.sendUserOperation({account:a,calls:[{to:U.DR}],...o});return await i.waitForUserOperationReceipt({hash:s}),!0}async function ee(e){let{bundlerUrl:t,chain:n,accountClient:a,calls:r}=e,i=(0,J.r)({transport:(0,M.d)(t)}),o=(0,V.E)({transport:(0,M.d)(t),paymaster:!0,chain:n,paymasterContext:{mode:"SPONSORED"}}),{fast:s}=await i.getUserOperationGasPrice();return await o.sendUserOperation({account:a,calls:r,...s})}async function et(e){let{agentENSClient:t,bundlerUrl:n,chain:a,orgAccountClient:r,orgName:i,agentAccountClient:o,agentName:s,agentUrl:l,agentAccount:d}=e;console.log("********************* prepareAddAgentNameToOrgCalls"),console.log("********************* orgName",i),console.log("********************* agentName",s),console.log("********************* agentAccount",d);let c=i.replace(/\.eth$/i,""),p=s.replace(RegExp("^".concat(c,"\\."),"i"),"").replace(/\.eth$/i,"");console.log("********************* cleanOrgName",c),console.log("********************* cleanAgentName",p),console.log("********************* agentUrl",l);let{calls:u}=await t.prepareAddAgentNameToOrgCalls({orgName:c,agentName:p,agentAddress:o.address,agentUrl:l}),y=(0,V.E)({transport:(0,M.d)(n),paymaster:!0,chain:a,paymasterContext:{mode:"SPONSORED"}});if(t.isL1()){let e=await ee({bundlerUrl:n,chain:a,accountClient:r,calls:u}),{receipt:i}=await y.waitForUserOperationReceipt({hash:e});console.log("********************* orgReceipt",i),console.log("********************* prepareSetAgentNameInfoCalls");let{calls:s}=await t.prepareSetAgentNameInfoCalls({orgName:c,agentName:p,agentAddress:d,agentUrl:l}),m=await ee({bundlerUrl:n,chain:a,accountClient:o,calls:s}),{receipt:g}=await y.waitForUserOperationReceipt({hash:m});return console.log("********************* agentReceipt",g),e}try{console.log("********************* orgCalls",u);let e=await t.hasAgentNameOwner(c,p);if(!1==e){console.log("********************* send sponsored user operation to add agent name to org");let e=await ee({bundlerUrl:n,chain:a,accountClient:o,calls:u});console.log("UserOp submitted:",e);let t=await y.waitForUserOperationReceipt({hash:e});console.log("Subname minted successfully! Transaction hash:",t)}let{calls:r}=await t.prepareAddAgentInfoCalls({orgName:c,agentName:p,agentAddress:o.address,agentUrl:l});for(let e of r){console.log("********************* send sponsored user operation to add agent info");let t=await ee({bundlerUrl:n,chain:a,accountClient:o,calls:[e]}),r=await y.waitForUserOperationReceipt({hash:t});console.log("Subname minted successfully! Transaction hash:",r)}}catch(e){console.error("Error adding l2 agent name to org:",e)}return"0x0000000000000000000000000000000000000000000000000000000000000000"}async function en(e){let{bundlerUrl:t,chain:n,agentAccount:a,tokenUri:r}=e;await Q({bundlerUrl:t,chain:n,account:a});let i=e.name,o="eip155:11155111:"+await a.getAddress();console.log("********************* createAIAgentIdentity: agentName",i),console.log("********************* createAIAgentIdentity: agentAddress",o),console.log("********************* createAIAgentIdentity: tokenUri",r);let{calls:s}=await e.agentIdentityClient.prepareRegisterCalls(i,o,null!=r?r:"");console.log("********************* createAIAgentIdentity: registerCalls",s);let l=await ee({bundlerUrl:t,chain:n,accountClient:a,calls:s});console.log("********************* createAIAgentIdentity: userOpHash",l);let d=(0,V.E)({transport:(0,M.d)(t),paymaster:!0,chain:n,paymasterContext:{mode:"SPONSORED"}}),{receipt:c}=await d.waitForUserOperationReceipt({hash:l});console.log("********************* createAIAgentIdentity: aaReceipt",c);let p=e.agentIdentityClient.extractAgentIdFromReceiptPublic(c);return console.log("********************* createAIAgentIdentity: tokenId",p),p}async function ea(e){let{agentIdentityClient:t,bundlerUrl:n,chain:a,agentAccountClient:r,agentId:i,registrationUri:o}=e,{calls:s}=await t.prepareSetRegistrationUriCalls(i,o),l=await ee({bundlerUrl:n,chain:a,accountClient:r,calls:s}),d=(0,V.E)({transport:(0,M.d)(n),paymaster:!0,chain:a,paymasterContext:{mode:"SPONSORED"}}),{receipt:c}=await d.waitForUserOperationReceipt({hash:l});return console.log("********************* setAgentUri 1: aaReceipt",c),"success"}var er=n(46463),ei=n(33669),eo=n(62919),es=n(2009),el=n(73723),ed=n(66340),ec=n(70916),ep=JSON.parse('{"Mt":[{"inputs":[{"internalType":"contract ENS","name":"_ens","type":"address"},{"internalType":"bytes32","name":"_baseNode","type":"bytes32"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"controller","type":"address"}],"name":"ControllerAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"controller","type":"address"}],"name":"ControllerRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"expires","type":"uint256"}],"name":"NameMigrated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"expires","type":"uint256"}],"name":"NameRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"expires","type":"uint256"}],"name":"NameRenewed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"GRACE_PERIOD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"controller","type":"address"}],"name":"addController","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"available","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"baseNode","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"controllers","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ens","outputs":[{"internalType":"contract ENS","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"nameExpires","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"owner","type":"address"}],"name":"reclaim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"register","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"registerOnly","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"controller","type":"address"}],"name":"removeController","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"renew","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"resolver","type":"address"}],"name":"setResolver","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]}'),eu=JSON.parse('{"Mt":[{"inputs":[{"internalType":"contract BaseRegistrarImplementation","name":"_base","type":"address"},{"internalType":"contract IPriceOracle","name":"_prices","type":"address"},{"internalType":"uint256","name":"_minCommitmentAge","type":"uint256"},{"internalType":"uint256","name":"_maxCommitmentAge","type":"uint256"},{"internalType":"contract IReverseRegistrar","name":"_reverseRegistrar","type":"address"},{"internalType":"contract IDefaultReverseRegistrar","name":"_defaultReverseRegistrar","type":"address"},{"internalType":"contract ENS","name":"_ens","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"}],"name":"CommitmentNotFound","type":"error"},{"inputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"},{"internalType":"uint256","name":"minimumCommitmentTimestamp","type":"uint256"},{"internalType":"uint256","name":"currentTimestamp","type":"uint256"}],"name":"CommitmentTooNew","type":"error"},{"inputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"},{"internalType":"uint256","name":"maximumCommitmentTimestamp","type":"uint256"},{"internalType":"uint256","name":"currentTimestamp","type":"uint256"}],"name":"CommitmentTooOld","type":"error"},{"inputs":[{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"DurationTooShort","type":"error"},{"inputs":[],"name":"InsufficientValue","type":"error"},{"inputs":[],"name":"MaxCommitmentAgeTooHigh","type":"error"},{"inputs":[],"name":"MaxCommitmentAgeTooLow","type":"error"},{"inputs":[{"internalType":"string","name":"name","type":"string"}],"name":"NameNotAvailable","type":"error"},{"inputs":[],"name":"ResolverRequiredForReverseRecord","type":"error"},{"inputs":[],"name":"ResolverRequiredWhenDataSupplied","type":"error"},{"inputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"}],"name":"UnexpiredCommitmentExists","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"label","type":"string"},{"indexed":true,"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"baseCost","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"premium","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"expires","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"referrer","type":"bytes32"}],"name":"NameRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"label","type":"string"},{"indexed":true,"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"cost","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"expires","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"referrer","type":"bytes32"}],"name":"NameRenewed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"MIN_REGISTRATION_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"}],"name":"available","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"}],"name":"commit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"commitments","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"defaultReverseRegistrar","outputs":[{"internalType":"contract IDefaultReverseRegistrar","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ens","outputs":[{"internalType":"contract ENS","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"bytes32","name":"secret","type":"bytes32"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"bytes[]","name":"data","type":"bytes[]"},{"internalType":"uint8","name":"reverseRecord","type":"uint8"},{"internalType":"bytes32","name":"referrer","type":"bytes32"}],"internalType":"struct IETHRegistrarController.Registration","name":"registration","type":"tuple"}],"name":"makeCommitment","outputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"maxCommitmentAge","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minCommitmentAge","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"prices","outputs":[{"internalType":"contract IPriceOracle","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"recoverFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"bytes32","name":"secret","type":"bytes32"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"bytes[]","name":"data","type":"bytes[]"},{"internalType":"uint8","name":"reverseRecord","type":"uint8"},{"internalType":"bytes32","name":"referrer","type":"bytes32"}],"internalType":"struct IETHRegistrarController.Registration","name":"registration","type":"tuple"}],"name":"register","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"bytes32","name":"referrer","type":"bytes32"}],"name":"renew","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"rentPrice","outputs":[{"components":[{"internalType":"uint256","name":"base","type":"uint256"},{"internalType":"uint256","name":"premium","type":"uint256"}],"internalType":"struct IPriceOracle.Price","name":"price","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"reverseRegistrar","outputs":[{"internalType":"contract IReverseRegistrar","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"}],"name":"valid","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}]}'),ey=JSON.parse('{"Mt":[{"inputs":[{"internalType":"contract ENS","name":"_ens","type":"address"},{"internalType":"contract IBaseRegistrar","name":"_registrar","type":"address"},{"internalType":"contract IMetadataService","name":"_metadataService","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"CannotUpgrade","type":"error"},{"inputs":[],"name":"IncompatibleParent","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"IncorrectTargetOwner","type":"error"},{"inputs":[],"name":"IncorrectTokenType","type":"error"},{"inputs":[{"internalType":"bytes32","name":"labelHash","type":"bytes32"},{"internalType":"bytes32","name":"expectedLabelhash","type":"bytes32"}],"name":"LabelMismatch","type":"error"},{"inputs":[{"internalType":"string","name":"label","type":"string"}],"name":"LabelTooLong","type":"error"},{"inputs":[],"name":"LabelTooShort","type":"error"},{"inputs":[],"name":"NameIsNotWrapped","type":"error"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"OperationProhibited","type":"error"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"addr","type":"address"}],"name":"Unauthorised","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"controller","type":"address"},{"indexed":false,"internalType":"bool","name":"active","type":"bool"}],"name":"ControllerChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"ExpiryExtended","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"uint32","name":"fuses","type":"uint32"}],"name":"FusesSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"address","name":"owner","type":"address"}],"name":"NameUnwrapped","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes","name":"name","type":"bytes"},{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint32","name":"fuses","type":"uint32"},{"indexed":false,"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"NameWrapped","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"indexed":false,"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"TransferBatch","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"_tokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint32","name":"fuseMask","type":"uint32"}],"name":"allFusesBurned","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"accounts","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"addr","type":"address"}],"name":"canExtendSubnames","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"addr","type":"address"}],"name":"canModifyName","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"controllers","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ens","outputs":[{"internalType":"contract ENS","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"extendExpiry","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"operator","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"getData","outputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"}],"name":"isWrapped","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"isWrapped","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"metadataService","outputs":[{"internalType":"contract IMetadataService","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"names","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"onERC721Received","outputs":[{"internalType":"bytes4","name":"","type":"bytes4"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"owner","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"recoverFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"wrappedOwner","type":"address"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"uint16","name":"ownerControlledFuses","type":"uint16"}],"name":"registerAndWrapETH2LD","outputs":[{"internalType":"uint256","name":"registrarExpiry","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"registrar","outputs":[{"internalType":"contract IBaseRegistrar","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"renew","outputs":[{"internalType":"uint256","name":"expires","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeBatchTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"setChildFuses","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"controller","type":"address"},{"internalType":"bool","name":"active","type":"bool"}],"name":"setController","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint16","name":"ownerControlledFuses","type":"uint16"}],"name":"setFuses","outputs":[{"internalType":"uint32","name":"","type":"uint32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract IMetadataService","name":"_metadataService","type":"address"}],"name":"setMetadataService","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"uint64","name":"ttl","type":"uint64"}],"name":"setRecord","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"resolver","type":"address"}],"name":"setResolver","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"setSubnodeOwner","outputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"uint64","name":"ttl","type":"uint64"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"setSubnodeRecord","outputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint64","name":"ttl","type":"uint64"}],"name":"setTTL","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract INameWrapperUpgrade","name":"_upgradeAddress","type":"address"}],"name":"setUpgradeContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"address","name":"controller","type":"address"}],"name":"unwrap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"address","name":"registrant","type":"address"},{"internalType":"address","name":"controller","type":"address"}],"name":"unwrapETH2LD","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes","name":"name","type":"bytes"},{"internalType":"bytes","name":"extraData","type":"bytes"}],"name":"upgrade","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"upgradeContract","outputs":[{"internalType":"contract INameWrapperUpgrade","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"name","type":"bytes"},{"internalType":"address","name":"wrappedOwner","type":"address"},{"internalType":"address","name":"resolver","type":"address"}],"name":"wrap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"wrappedOwner","type":"address"},{"internalType":"uint16","name":"ownerControlledFuses","type":"uint16"},{"internalType":"address","name":"resolver","type":"address"}],"name":"wrapETH2LD","outputs":[{"internalType":"uint64","name":"expiry","type":"uint64"}],"stateMutability":"nonpayable","type":"function"}]}'),em=JSON.parse('{"Mt":[{"inputs":[{"internalType":"contract ENS","name":"_ens","type":"address"},{"internalType":"contract INameWrapper","name":"wrapperAddress","type":"address"},{"internalType":"address","name":"_trustedETHController","type":"address"},{"internalType":"address","name":"_trustedReverseRegistrar","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"bytes","name":"addressBytes","type":"bytes"}],"name":"InvalidEVMAddress","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":true,"internalType":"uint256","name":"contentType","type":"uint256"}],"name":"ABIChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"address","name":"a","type":"address"}],"name":"AddrChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"coinType","type":"uint256"},{"indexed":false,"internalType":"bytes","name":"newAddress","type":"bytes"}],"name":"AddressChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":true,"internalType":"address","name":"delegate","type":"address"},{"indexed":true,"internalType":"bool","name":"approved","type":"bool"}],"name":"Approved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes","name":"hash","type":"bytes"}],"name":"ContenthashChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes","name":"name","type":"bytes"},{"indexed":false,"internalType":"uint16","name":"resource","type":"uint16"},{"indexed":false,"internalType":"bytes","name":"record","type":"bytes"}],"name":"DNSRecordChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes","name":"name","type":"bytes"},{"indexed":false,"internalType":"uint16","name":"resource","type":"uint16"}],"name":"DNSRecordDeleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes","name":"lastzonehash","type":"bytes"},{"indexed":false,"internalType":"bytes","name":"zonehash","type":"bytes"}],"name":"DNSZonehashChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":true,"internalType":"bytes4","name":"interfaceID","type":"bytes4"},{"indexed":false,"internalType":"address","name":"implementer","type":"address"}],"name":"InterfaceChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"string","name":"name","type":"string"}],"name":"NameChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes32","name":"x","type":"bytes32"},{"indexed":false,"internalType":"bytes32","name":"y","type":"bytes32"}],"name":"PubkeyChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":true,"internalType":"string","name":"indexedKey","type":"string"},{"indexed":false,"internalType":"string","name":"key","type":"string"},{"indexed":false,"internalType":"string","name":"value","type":"string"}],"name":"TextChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"uint64","name":"newVersion","type":"uint64"}],"name":"VersionChanged","type":"event"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint256","name":"contentTypes","type":"uint256"}],"name":"ABI","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"addr","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint256","name":"coinType","type":"uint256"}],"name":"addr","outputs":[{"internalType":"bytes","name":"addressBytes","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"delegate","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"clearRecords","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"contenthash","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"uint16","name":"resource","type":"uint16"}],"name":"dnsRecord","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint256","name":"coinType","type":"uint256"}],"name":"hasAddr","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes32","name":"name","type":"bytes32"}],"name":"hasDNSRecords","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes4","name":"interfaceID","type":"bytes4"}],"name":"interfaceImplementer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"delegate","type":"address"}],"name":"isApprovedFor","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes[]","name":"data","type":"bytes[]"}],"name":"multicall","outputs":[{"internalType":"bytes[]","name":"results","type":"bytes[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"nodehash","type":"bytes32"},{"internalType":"bytes[]","name":"data","type":"bytes[]"}],"name":"multicallWithNodeCheck","outputs":[{"internalType":"bytes[]","name":"results","type":"bytes[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"pubkey","outputs":[{"internalType":"bytes32","name":"x","type":"bytes32"},{"internalType":"bytes32","name":"y","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"recordVersions","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint256","name":"contentType","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"setABI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint256","name":"coinType","type":"uint256"},{"internalType":"bytes","name":"addressBytes","type":"bytes"}],"name":"setAddr","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"_addr","type":"address"}],"name":"setAddr","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes","name":"hash","type":"bytes"}],"name":"setContenthash","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"setDNSRecords","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes4","name":"interfaceID","type":"bytes4"},{"internalType":"address","name":"implementer","type":"address"}],"name":"setInterface","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"string","name":"newName","type":"string"}],"name":"setName","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes32","name":"x","type":"bytes32"},{"internalType":"bytes32","name":"y","type":"bytes32"}],"name":"setPubkey","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"string","name":"key","type":"string"},{"internalType":"string","name":"value","type":"string"}],"name":"setText","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"bytes","name":"hash","type":"bytes"}],"name":"setZonehash","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceID","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"string","name":"key","type":"string"}],"name":"text","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"zonehash","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"}]}'),eg=n(88586),eh=n(32608),ef=n(80368).lW;function eb(e){if(11155111!==e.id)throw Error("This operation only supports Sepolia testnet (chain ID: ".concat(11155111,"). Current chain: ").concat(e.name," (ID: ").concat(e.id,")"))}function ex(e){return e.split(".")[0]}class ev{static async createEnsDomainName(e,t,n){if(!e)throw Error("Smart account client is required");if(!n)throw Error("Chain information is required");if(!t)throw Error("ENS name is required");eb(n);let a=new K.Q(window.ethereum),r=t.replace(/^ENS:\s*/,""),i=(r=(r=r.replace(/\.eth$/i,"")).replace(/[^a-zA-Z0-9-]/g,"").toLowerCase())+".eth";console.log("...................... process this stuff .............: ",i);let o=(0,eg.R)({chain:n,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)});console.log("...................... process this stuff .............: ",i);let s=await o.getAddressRecord({name:i});console.log("Current ENS address:",s);let l=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",d=(0,F.V)(i),c=new es.CH(l,["function resolver(bytes32 node) view returns (address)"],a),p=await c.resolver(d);console.log(".................. Resolver address:",p);let u=new es.CH(l,["function owner(bytes32 node) view returns (address)"],a);console.log(".................. Owner:",await u.owner(d));let y=async()=>{console.log("Managing ENS records for:",i);try{let t,a;let r=(0,k.v)({chain:n,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),o=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),chain:n}),s=(0,J.r)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT")});console.log("Getting gas prices from Pimlico...");let{fast:l}=await s.getUserOperationGasPrice();console.log("Current gas prices:",l);let d={maxFeePerGas:l.maxFeePerGas,maxPriorityFeePerGas:l.maxPriorityFeePerGas,callGasLimit:500000n,preVerificationGas:100000n,verificationGasLimit:500000n},c=await e.getAddress();console.log("Smart Account Address for ENS records:",c);let p=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",u=(0,F.V)(i),y=await r.readContract({address:p,abi:[{name:"resolver",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"resolver",args:[u]});if(console.log("Current resolver address:",y),!y||"0x0000000000000000000000000000000000000000"===y){console.log("No resolver set, skipping record management");return}try{t=await r.readContract({address:y,abi:em.Mt,functionName:"addr",args:[u]}),console.log("Current address record:",t)}catch(e){console.log("Could not read current address record:",e),t="0x0000000000000000000000000000000000000000"}if(t!==c){console.log("Setting ENS address record...");let t=(0,_.R)({abi:em.Mt,functionName:"setAddr",args:[u,c]}),n=await o.sendUserOperation({account:e,calls:[{to:y,data:t,value:0n}],...d}),{receipt:a}=await o.waitForUserOperationReceipt({hash:n});console.log(" ENS address record set successfully")}else console.log(" ENS address record already set correctly");let m=(0,F.V)(c.slice(2).toLowerCase()+".addr.reverse");console.log("Reverse node:",m);try{a=await r.readContract({address:y,abi:em.Mt,functionName:"name",args:[m]}),console.log("Current reverse name record:",a);let e=await r.readContract({address:p,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"owner",args:[m]});console.log("*********** Reverse registrar:",e)}catch(e){console.log("Could not read current reverse name:",e),a=""}if(a!==i){console.log("Setting reverse name record...");let t=(0,_.R)({abi:em.Mt,functionName:"setName",args:[m,i]}),n=await o.sendUserOperation({account:e,calls:[{to:y,data:t,value:0n}],...d}),{receipt:a}=await o.waitForUserOperationReceipt({hash:n});console.log(" Reverse name record set successfully")}else console.log(" Reverse name record already set correctly");console.log("\uD83C\uDF89 ENS records check and update completed for ".concat(i)),console.log("\uD83D\uDCCD Address: ".concat(c)),console.log("\uD83D\uDD04 Reverse resolution: ".concat(c,"  ").concat(i))}catch(e){console.error("Error managing ENS records:",e)}};if("0x0000000000000000000000000000000000000000"!=p){console.log("ENS domain exists, updating records...");let e=new es.CH(p,["function addr(bytes32 node) view returns (address)"],a);console.log(".................. Current Address:",await e.addr(d));try{let e=await a.getResolver(i);console.log(".................. Name resolver:",e);let t=null;e&&(t=await e.getAddress(),console.log(".................. Eth address:",t))}catch(e){console.log(".................. Error resolving name:",e)}console.log("ENS address found:",s);let n=await a.getResolver(i);if(!n)return console.log("No resolver found for",t),i;console.log("Avatar URI:",await n.getText("avatar")),await y()}else{console.log("ENS address not found:",i),console.log("Starting registration process...");try{let t="".concat(r,".eth"),a=(0,F.V)(t),i=el.O(32),o="0x".concat(ef.from(i).toString("hex"));console.log("Registration parameters:",{ensName:t,node:a,duration:31536e3,secret:o.slice(0,10)+"..."});let s="0xfb3cE5D01e0f33f41DbB39035dB9745962F1f968",l=await e.getAddress();console.log("Smart Account (Owner) Address:",l);let d={label:r,owner:l,duration:31536e3,secret:o,resolver:"0x8FADE66B79cC9f707aB26799354482EB93a5B7dD",data:[],reverseRecord:!0,referrer:"0x0000000000000000000000000000000000000000000000000000000000000000"};console.log("Registration object:",{...d,secret:d.secret.slice(0,10)+"..."});let c=(0,k.v)({chain:n,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)});if(console.log("Checking domain availability..."),!await c.readContract({address:s,abi:eu.Mt,functionName:"available",args:[r]}))throw Error("Domain ".concat(t," is not available for registration"));console.log("Domain is available ");let p=await c.readContract({address:s,abi:eu.Mt,functionName:"rentPrice",args:[r,31536e3]});console.log("Current registration costs:",{base:(0,ed.dF)(p.base),premium:(0,ed.dF)(p.premium),total:(0,ed.dF)(p.base+p.premium)}),console.log("Making commitment...");let u=await c.readContract({address:s,abi:eu.Mt,functionName:"makeCommitment",args:[d]});console.log("Commitment created:",u);let m=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:n,paymasterContext:{mode:"SPONSORED"}}),g=await c.estimateFeesPerGas();console.log("Current fee data:",g);let h={maxFeePerGas:2n*g.maxFeePerGas,maxPriorityFeePerGas:2n*g.maxPriorityFeePerGas};console.log("Using gas config:",h),console.log("Sending commitment transaction...");let f=await m.sendUserOperation({account:e,calls:[{to:s,data:(0,_.R)({abi:eu.Mt,functionName:"commit",args:[u]})}],...h});console.log("Commitment transaction sent:",f);let{receipt:b}=await m.waitForUserOperationReceipt({hash:f});console.log("Commitment transaction mined:",b),console.log("Waiting for commitment to be ready (90 seconds)..."),await new Promise(e=>setTimeout(e,9e4)),console.log("Verifying commitment...");let x=await c.readContract({address:s,abi:eu.Mt,functionName:"commitments",args:[u]});if(console.log("Commitment status:",x),!x)throw Error("Commitment not found or expired");console.log("Preparing registration transaction...");let v=(0,_.R)({abi:eu.Mt,functionName:"register",args:[d]}),w=await c.readContract({address:s,abi:eu.Mt,functionName:"rentPrice",args:[r,31536e3]}),T=w.base+w.premium;console.log("Final registration price:",(0,ed.dF)(T),"ETH");let j=await c.getBalance({address:e.address});if(console.log("Account balance:",(0,ed.dF)(j),"ETH"),j<T)throw Error("Insufficient balance. Need ".concat((0,ed.dF)(T)," ETH but have ").concat((0,ed.dF)(j)," ETH"));let S=await m.sendUserOperation({account:e,calls:[{to:s,data:v,value:T}],...h});console.log("Registration transaction sent:",S);let{receipt:C}=await m.waitForUserOperationReceipt({hash:S});return console.log("Registration transaction mined:",C),console.log(' ENS name "'.concat(t,'" registered successfully')),console.log("\uD83D\uDD17 View: https://sepolia.app.ens.domains/".concat(t)),console.log("Setting up ENS records..."),await y(),t}catch(t){let e=t instanceof Error?t:Error("Unknown error occurred");throw console.error("Error registering ENS name:",e),Error("Failed to register ENS name: ".concat(e.message))}}return t}static async setTextWithAA(e,t,n,a,r,i){eb(i);let o=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:i,paymasterContext:{mode:"SPONSORED"}}),s=(0,J.r)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT")}),{fast:l}=await s.getUserOperationGasPrice(),d={maxFeePerGas:l.maxFeePerGas,maxPriorityFeePerGas:l.maxPriorityFeePerGas,callGasLimit:500000n,preVerificationGas:100000n,verificationGasLimit:500000n},c=(0,_.R)({abi:em.Mt,functionName:"setText",args:[n,a,r]}),p=await o.sendUserOperation({account:e,calls:[{to:t,data:c,value:0n}],...d});return await o.waitForUserOperationReceipt({hash:p}),!0}static async setTextWithEOA(e,t,n,a,r){eb(r);let i=new K.Q(window.ethereum),o=await i.getSigner(),s=new es.CH(e,em.Mt,o),l=await s.setText(t,n,a);return await l.wait(),!0}static async wrapEnsDomainName(e,t,n,a){console.log("Wrapping ENS domain name:",n),eb(a);let r=new es.CH("0x57f1887a8bf19b14fc0df6fd9b2acc9af147ea85",ep.Mt,e),i=new es.CH(eh.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8",ey.Mt,e),o=new es.CH("0xE99638b40E4Fff0129D56f03b55b6bbC4BBE49b5",em.Mt,e),s=ex(n),l=function(e){let t=ex(e),n=(0,ei.Y0)(t);return(0,eo.w)(n)}(n),d=(0,F.V)(n+".eth");try{let c,p,u;let y=await e.getAddress(),m=await t.getAddress();console.log("Label:",s),console.log("Token ID:",l),console.log("Node:",d),console.log("Signer address:",y),console.log("Smart Account address:",m);try{console.log("Checking ownership in BaseRegistrar...: ",r.target),console.log("Token ID:",l),c=await r.ownerOf(l),console.log("BaseRegistrar owner:",c)}catch(e){throw console.error("Error checking ownership in BaseRegistrar:",e),Error('ENS name "'.concat(n,'" does not exist or is not registered'))}try{let e=await i.ownerOf(l);if(console.log("NameWrapper owner:",e),e.toLowerCase()===m.toLowerCase())return console.log("Name is already wrapped and owned by the smart account"),n;throw Error("ENS name is already wrapped and owned by ".concat(e))}catch(e){console.log("Name is not wrapped yet, proceeding with wrapping")}let g=c.toLowerCase()===y.toLowerCase(),h=c.toLowerCase()===m.toLowerCase();if(!g&&!h)throw Error("You are not the owner of this ENS name. "+"Current owner: ".concat(c,". ")+"Your addresses - Signer: ".concat(y,", Smart Account: ").concat(m));if(h){console.log("Smart account owns the name, using it for wrapping...");let e=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),chain:a}),n=(0,k.v)({chain:a,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")}),l=await n.estimateFeesPerGas();console.log("Current fee data:",l);let d={maxFeePerGas:2n*l.maxFeePerGas,maxPriorityFeePerGas:2n*l.maxPriorityFeePerGas,callGasLimit:500000n,preVerificationGas:100000n,verificationGasLimit:500000n},c=await r.isApprovedForAll(m,i.target);if(console.log("Current approval status for NameWrapper:",c),!c){console.log("Setting approval from smart account...");let a=await n.getBalance({address:t.address});console.log("Smart Account Balance (before approval):",a.toString(),"wei"),console.log("Smart Account Balance (ETH):",(Number(a)/1e18).toFixed(6),"ETH");let o=d.maxFeePerGas*d.callGasLimit;if(console.log("Estimated approval gas cost:",o.toString(),"wei"),console.log("Estimated approval gas cost (ETH):",(Number(o)/1e18).toFixed(6),"ETH"),a<o)throw console.error("Insufficient funds for approval operation!"),console.error("Required:",o.toString(),"wei"),console.error("Available:",a.toString(),"wei"),Error("Smart account has insufficient funds for approval. Required: ".concat((Number(o)/1e18).toFixed(6)," ETH, Available: ").concat((Number(a)/1e18).toFixed(6)," ETH"));let s=(0,_.R)({abi:ep.Mt,functionName:"setApprovalForAll",args:[i.target,!0]}),l=await e.sendUserOperation({account:t,calls:[{to:r.target,data:s,value:0n}],...d});console.log("Waiting for approval transaction..."),await e.waitForUserOperationReceipt({hash:l});let c=!1,p=0;for(;!c&&p<5;)p>0&&(console.log("Approval verification attempt ".concat(p+1,"/").concat(5)),await new Promise(e=>setTimeout(e,3e3))),c=await r.isApprovedForAll(m,i.target),console.log("Approval verification:",c),p++;if(!c)throw Error("Approval failed to set correctly after multiple verification attempts");console.log("Approval set and verified successfully"),await new Promise(e=>setTimeout(e,5e3))}console.log("Wrapping name using smart account..."),console.log("Wrap parameters:",{label:s,owner:m,fuses:0,resolver:o.target});let p=(0,_.R)({abi:ey.Mt,functionName:"wrapETH2LD",args:[s,m,0,o.target]}),u=await n.readContract({address:t.address,abi:[{inputs:[],name:"getNonce",outputs:[{type:"uint256",name:""}],stateMutability:"view",type:"function"}],functionName:"getNonce"});console.log("Current nonce:",u);let y=await n.getBalance({address:t.address});console.log("Smart Account Balance:",y.toString(),"wei"),console.log("Smart Account Balance (ETH):",(Number(y)/1e18).toFixed(6),"ETH");let g=d.maxFeePerGas*d.callGasLimit;if(console.log("Estimated gas cost:",g.toString(),"wei"),console.log("Estimated gas cost (ETH):",(Number(g)/1e18).toFixed(6),"ETH"),y<g)throw console.error("Insufficient funds in smart account!"),console.error("Required:",g.toString(),"wei"),console.error("Available:",y.toString(),"wei"),Error("Smart account has insufficient funds. Required: ".concat((Number(g)/1e18).toFixed(6)," ETH, Available: ").concat((Number(y)/1e18).toFixed(6)," ETH"));let h=await e.sendUserOperation({account:t,calls:[{to:i.target,data:p,value:0n}],...d,nonce:u});console.log("Waiting for wrapping transaction..."),await e.waitForUserOperationReceipt({hash:h}),console.log("Wrapping transaction confirmed")}else{console.log("Signer owns the name, using normal transaction flow...");let e=await r.isApprovedForAll(y,i.target);if(console.log("Current approval status for NameWrapper:",e),!e){console.log("Setting approval...");let e=await r.setApprovalForAll(i.target,!0);await e.wait();let t=!1,n=0;for(;!t&&n<5;)n>0&&(console.log("Approval verification attempt ".concat(n+1,"/").concat(5)),await new Promise(e=>setTimeout(e,3e3))),t=await r.isApprovedForAll(y,i.target),console.log("Approval verification:",t),n++;if(!t)throw Error("Approval failed to set correctly after multiple verification attempts");console.log("Approval set and verified successfully")}console.log("Wrapping name..."),console.log("Wrap parameters:",{label:s,owner:m,fuses:0,resolver:o.target});let t=await i.wrapETH2LD(s,m,0,o.target,{gasLimit:5e5});console.log("Wrapping transaction sent:",t.hash),await t.wait(),console.log("Wrapping transaction confirmed")}await new Promise(e=>setTimeout(e,5e3)),console.log("Verifying wrapping...");try{p=await i.ownerOf(l),console.log("NameWrapper owner after wrapping:",p)}catch(e){console.error("Error checking NameWrapper ownership:",e),p=ec.N}try{u=await r.ownerOf(l),console.log("BaseRegistrar owner after wrapping:",u)}catch(e){console.error("Error checking BaseRegistrar ownership:",e),u=ec.N}if(p.toLowerCase()===m.toLowerCase())return console.log(" ".concat(n,".eth has been wrapped successfully!")),n;if(u.toLowerCase()===m.toLowerCase())return console.log(" ".concat(n,".eth has been wrapped successfully! BaseRegistrar ownership confirmed.")),n;if(p===ec.N&&u===i.target)return console.log(" ".concat(n,".eth has been wrapped successfully (owned by NameWrapper contract)!")),n;throw Error("Wrapping verification failed:\n"+"Expected owner: ".concat(m,"\n")+"NameWrapper owner: ".concat(p,"\n")+"BaseRegistrar owner: ".concat(u,"\n")+"NameWrapper contract: ".concat(i.target))}catch(e){throw console.error("Error wrapping ENS name:",e),e}}static async checkEnsNameStatus(e,t){console.log("Checking ENS name status for:",e+".eth"),eb(t);let n="https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A";if(!n)throw Error("NEXT_PUBLIC_ETH_SEPOLIA_RPC_URL environment variable is not set");let a=new X.r6(n),r=new es.CH("0x57f1887a8bf19b14fc0df6fd9b2acc9af147ea85",ep.Mt,a),i=new es.CH(eh.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8",ey.Mt,a),o=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",s=new es.CH(o,["function owner(bytes32 node) view returns (address)"],a);console.log("................ Checking ENS name status for:",e);let l=e.split(".")[0],d=(0,eo.w)((0,ei.Y0)(l));console.info("ensName to match: ",e);let c=(0,F.V)(e+".eth");console.info("ensOwner123: ",await s.owner(c));let p={exists:!1,isWrapped:!1,registrationMethod:"none"};try{let e=await r.ownerOf(d);p.baseRegistrarOwner=e,p.exists=!0,p.registrationMethod="baseRegistrar"}catch(e){console.log(" Not found in BaseRegistrar")}try{let e=await s.owner(c);if(p.ensRegistryOwner=e,e&&"0x0000000000000000000000000000000000000000"!==e){if(p.exists=!0,e.toLowerCase()===(eh.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8").toLowerCase())try{let e=await i.ownerOf(c);p.nameWrapperOwner=e,p.isWrapped=!0,p.registrationMethod="nameWrapper"}catch(e){console.log(" Error getting NameWrapper owner:",e),p.isWrapped=!0,p.registrationMethod="nameWrapper"}else p.registrationMethod="ensRegistry",console.log(" Found in ENS Registry, direct owner:",e)}else console.log(" Not found in ENS Registry")}catch(e){console.log(" Error checking ENS Registry:",e)}return p}static async createSubdomain(e,t,n,a,r){console.log("Creating subdomain:",a+"."+n+".eth"),eb(r);try{let i,o;let s=await t.getAddress();console.log("Smart Account address:",s);let l=await this.checkEnsNameStatus(n,r);if(console.log("Parent name status:",l),!l.exists)throw Error('Parent name "'.concat(n,'.eth" does not exist. ')+"Please register it first using the ENS registration feature.");let d=l.isWrapped;if(l.isWrapped&&l.nameWrapperOwner&&"0x0000000000000000000000000000000000000000"!==l.nameWrapperOwner)i=l.nameWrapperOwner,console.log("Using NameWrapper owner:",i);else if(l.baseRegistrarOwner){if(i=l.baseRegistrarOwner,console.log("Using BaseRegistrar owner:",i),l.isWrapped&&"0x0000000000000000000000000000000000000000"===l.nameWrapperOwner)throw Error('Parent name "'.concat(n,'.eth" is wrapped but has no owner (zero address). ')+'This indicates the name was not properly wrapped. Please wrap the name first using the "Wrap ENS Name" button.')}else if(l.ensRegistryOwner&&"0x0000000000000000000000000000000000000000"!==l.ensRegistryOwner)i=l.ensRegistryOwner,console.log("Using ENS Registry owner:",i);else throw Error('Cannot determine owner of "'.concat(n,'.eth". ')+"Registration status: ".concat(JSON.stringify(l)));if(i.toLowerCase()!==s.toLowerCase())throw Error("You don't own the parent name \"".concat(n,'.eth". ')+"Current owner: ".concat(i,", Your address: ").concat(s));let c=new es.CH(eh.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8",ey.Mt,e),p=new es.CH("0xE99638b40E4Fff0129D56f03b55b6bbC4BBE49b5",em.Mt,e),u="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",y=new es.CH(u,["function owner(bytes32 node) view returns (address)","function setSubnodeRecord(bytes32 node, bytes32 label, address owner, address resolver, uint64 ttl) external"],e),m=(0,F.V)(n+".eth"),g=(0,F.V)(a+"."+n+".eth"),h=(0,eo.w)((0,ei.Y0)(a));console.log("Parent node:",m),console.log("Subnode:",g),console.log("Label hash:",h);try{let e;if(e=d?await c.ownerOf(g):await y.owner(g),"0x0000000000000000000000000000000000000000"!==e)throw console.log("Subdomain already exists, owner:",e),Error('Subdomain "'.concat(a,".").concat(n,'.eth" already exists and is owned by ').concat(e))}catch(e){console.log("Subdomain does not exist yet, proceeding with creation")}let f=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),chain:r}),b=(0,J.r)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT")}),{fast:x}=await b.getUserOperationGasPrice(),v={maxFeePerGas:x.maxFeePerGas,maxPriorityFeePerGas:x.maxPriorityFeePerGas,callGasLimit:500000n,preVerificationGas:100000n,verificationGasLimit:500000n},w=(0,k.v)({chain:r,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),T=await w.readContract({address:t.address,abi:[{inputs:[],name:"getNonce",outputs:[{type:"uint256",name:""}],stateMutability:"view",type:"function"}],functionName:"getNonce"});if(d){console.log("Creating subdomain via NameWrapper...");let e=(0,_.R)({abi:ey.Mt,functionName:"setSubnodeRecord",args:[m,a,s,p.target,0,0,0]}),n=await f.sendUserOperation({account:t,calls:[{to:c.target,data:e,value:0n}],...v,nonce:T});await f.waitForUserOperationReceipt({hash:n})}else{console.log("Creating subdomain via ENS Registry...");let e=(0,_.R)({abi:[{name:"setSubnodeRecord",type:"function",stateMutability:"nonpayable",inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"},{name:"resolver",type:"address"},{name:"ttl",type:"uint64"}],outputs:[]}],functionName:"setSubnodeRecord",args:[m,h,s,p.target,0n]}),n=await f.sendUserOperation({account:t,calls:[{to:u,data:e,value:0n}],...v,nonce:T});await f.waitForUserOperationReceipt({hash:n})}if(console.log("Subdomain creation transaction confirmed"),await new Promise(e=>setTimeout(e,5e3)),o=d?await c.ownerOf(g):await y.owner(g),console.log("New subdomain owner:",o),o.toLowerCase()===s.toLowerCase())return console.log(' Subdomain "'.concat(a,".").concat(n,'.eth" created successfully!')),a+"."+n+".eth";throw Error("Subdomain creation verification failed. "+"Expected owner: ".concat(s,", ")+"Actual owner: ".concat(o))}catch(e){throw console.error("Error creating subdomain:",e),e}}static async createSubdomainForOrg(e,t,n,a,r,i,o){if(console.log("Creating subdomain for ORG AA:",i+"."+r+".eth"),console.log("ORG AA address:",a),console.log("subdomain name:",i+"."+r+".eth"),eb(o),i.includes("."))throw Error('Invalid subdomain label: "'.concat(i,'". ENS subdomain labels cannot contain dots. Please use a single label like "finder" instead of "finder.airbnb.org".'));if(!i||0===i.length)throw Error("Subdomain label cannot be empty");if(!/^[a-zA-Z0-9-]+$/.test(i))throw Error('Invalid subdomain label: "'.concat(i,'". Only alphanumeric characters and hyphens are allowed.'));try{let s,l;let d=await t.getAddress();console.log("ENS Owner AA address:",d);let c=(0,k.v)({chain:o,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")}),p="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",u=(0,F.V)(r+".eth"),y=await c.readContract({address:p,abi:[{name:"owner",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}],stateMutability:"view"}],functionName:"owner",args:[u]});if(console.log("\uD83D\uDD17 Parent domain: ".concat(r,".eth")),console.log("\uD83D\uDD17 Parent node: ".concat(u)),console.log("\uD83D\uDC64 Parent owner: ".concat(y)),"0x0000000000000000000000000000000000000000"===y)throw Error("Parent domain ".concat(r,".eth does not exist or has no owner"));if("0x0635513f179d50a207757e05759cbd106d7dfce8"===y.toLowerCase()){console.log(" Parent domain is wrapped, getting NameWrapper owner...");try{let e=BigInt(u);s=await c.readContract({address:"0x0635513f179D50A207757E05759CbD106d7dFcE8",abi:ey.Mt,functionName:"ownerOf",args:[e]}),console.log("\uD83C\uDFAF NameWrapper owner: ".concat(s))}catch(e){throw console.error(" Error getting NameWrapper owner:",e),Error("Failed to get NameWrapper owner: ".concat(e instanceof Error?e.message:String(e)))}}else s=y,console.log("\uD83C\uDFAF Direct owner: ".concat(s));if(s.toLowerCase()!==d.toLowerCase())throw console.log(" Error: ENS Owner AA does not match NameWrapper owner"),console.log("Expected: ".concat(s)),console.log("Actual: ".concat(d)),Error("ENS Owner AA (".concat(d,") is not the owner of the parent domain. Actual owner: ").concat(s,". Please ensure the ENS owner AA is properly set as the owner of the parent domain."));let m=new es.CH("0x0635513f179D50A207757E05759CbD106d7dFcE8",ey.Mt,e),g=new es.CH("0x8FADE66B79cC9f707aB26799354482EB93a5B7dD",em.Mt,e),h=(0,F.V)(i+"."+r+".eth");console.log("Parent node:",u),console.log("Subnode:",h);let f=!1;try{let e;e=await m.ownerOf(h),"0x0000000000000000000000000000000000000000"!==e&&(console.log("Subdomain already exists, owner:",e),f=!0,console.log(' Subdomain "'.concat(i,".").concat(r,'.eth" already exists, skipping creation but will attempt reverse record setup')))}catch(e){console.log("Subdomain does not exist yet, proceeding with creation")}let b=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:o,paymasterContext:{mode:"SPONSORED"}}),x=(0,J.r)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT")}),{fast:v}=await x.getUserOperationGasPrice(),w={maxFeePerGas:v.maxFeePerGas,maxPriorityFeePerGas:v.maxPriorityFeePerGas,callGasLimit:500000n,preVerificationGas:100000n,verificationGasLimit:500000n},T=null,j=null;if(f)console.log("Skipping subdomain creation - already exists");else{console.log("Creating subdomain via NameWrapper...");let e=(0,_.R)({abi:ey.Mt,functionName:"setSubnodeRecord",args:[u,i,a,g.target,0n,0,0n]});console.log("Create subdomain call details:",{to:m.target,data:e,parentNode:u,label:i,owner:a,resolver:g.target,ttl:0n,fuses:0,expiry:0n}),T=await b.sendUserOperation({account:t,calls:[{to:m.target,data:e,value:0n}],...w}),console.log("Subdomain creation transaction sent:",T),j=await b.waitForUserOperationReceipt({hash:T}),console.log("Subdomain created successfully:",j),await new Promise(e=>setTimeout(e,5e3))}if(l=await m.ownerOf(h),console.log("Subdomain owner:",l),f?console.log(' Subdomain "'.concat(i,".").concat(r,'.eth" already exists and is owned by ').concat(l)):console.log(' Subdomain "'.concat(i,".").concat(r,'.eth" created successfully and owned by ').concat(l,"!")),l.toLowerCase()===a.toLowerCase()){console.log(" Subdomain ownership verified - proceeding with reverse record setup");try{let e,t;console.log("Setting reverse address record for subdomain...");let o=i+"."+r+".eth",s=(0,F.V)(a.slice(2).toLowerCase()+".addr.reverse");console.log("Reverse node:",s);try{let n=await c.readContract({address:p,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"owner",args:[s]});console.log("*********** Reverse registrar for our reverse node:",n),e=await c.readContract({address:n,abi:[{name:"name",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{type:"string"}]},{name:"addr",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{type:"address"}]},{name:"addr",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"},{name:"coinType",type:"uint256"}],outputs:[{type:"bytes"}]}],functionName:"name",args:[s]}),console.log("*********** Current reverse name:",e);let a=(0,F.V)("addr.reverse");t=await c.readContract({address:p,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"owner",args:[a]}),console.log("*********** Reverse registrar:",t)}catch(e){console.log("Could not read current reverse name:",e),t=""}if(console.log("Current reverse name:",e),e!==o){console.log("Setting reverse name record using agent's account abstraction...");let e=(0,_.R)({abi:[{name:"setName",type:"function",stateMutability:"nonpayable",inputs:[{name:"name",type:"string"}],outputs:[{name:"node",type:"bytes32"}]}],functionName:"setName",args:[o]});console.log("Setting reverse name record using agent's AA..."),console.log("reverseRegistrar:",t);let a=await b.sendUserOperation({account:n,calls:[{to:t,data:e,value:0n}],...w}),{receipt:r}=await b.waitForUserOperationReceipt({hash:a});console.log(" Reverse name record set successfully")}else console.log(" Reverse name record already set correctly")}catch(e){console.error(" Warning: Failed to set reverse address record:",e)}try{await this.forwardFromEnsName(r,o,t,n,i)}catch(e){console.warn("Forward (addr) record setup failed:",e)}try{await this.reverseFromEnsAddress(r,o,t,n,i)}catch(e){console.warn("Reverse record setup failed:",e)}return i+"."+r+".eth"}throw Error("Subdomain creation verification failed. "+"Expected owner: ".concat(a,", ")+"Actual owner: ".concat(l))}catch(e){throw console.error("Error creating subdomain for ORG AA:",e),e}}static async getEnsName(e,t){try{let n=(0,eg.R)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),a=await n.getName({address:e});return(null==a?void 0:a.name)||null}catch(e){return console.error("Error getting ENS name:",e),null}}static async forwardFromEnsName(e,t,n,a,r){try{console.log("inside Forwarding from ENS Name ..."),console.log("subdomainName:",r),console.log("chain:",t),console.log("ensOwnerAA:",n),console.log("agentAA:",a);let i=(0,F.V)(r+".orgtrust.eth"),o=(0,k.v)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),s=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",l=await o.readContract({address:s,abi:[{name:"resolver",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{type:"address"}]}],functionName:"resolver",args:[i]});console.log("........... resolver:",l);let d=await o.readContract({address:s,abi:[{name:"owner",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{type:"address"}]}],functionName:"owner",args:[i]});console.log("........... owner:",d),console.log("........... agent address:",a.address);let c=BigInt(i),p=await o.readContract({address:eh.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8",abi:ey.Mt,functionName:"ownerOf",args:[c]});console.log("........... actual owner:",p);let u=(0,_.R)({abi:[{name:"setAddr",type:"function",stateMutability:"nonpayable",inputs:[{name:"node",type:"bytes32"},{name:"a",type:"address"}]}],functionName:"setAddr",args:[i,a.address]}),y=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:t,paymasterContext:{mode:"SPONSORED"}});console.info("sending user operation to set addr record");let m=await y.sendUserOperation({account:a,calls:[{to:l,data:u}],maxFeePerGas:412596685n,maxPriorityFeePerGas:412596676n});console.info("get address record receipt");let{receipt:g}=await y.waitForUserOperationReceipt({hash:m});console.info("get address record");let h=(0,eg.R)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),f=await h.getAddressRecord({name:e+".orgtrust.eth"});return(null==f?void 0:f.value)||null}catch(e){return console.error("Error getting ENS address:",e),null}}static async reverseFromEnsAddress(e,t,n,a,r){try{console.log("inside reverse from ENS address..."),console.log("name:",r),console.log("chain:",t),console.log("ensOwnerAA:",n),console.log("agentAA:",a);let i=r+".orgtrust.eth",o=(0,F.V)(a.address.slice(2).toLowerCase()+".addr.reverse");console.log("Reverse node:",o);try{let e=(0,k.v)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),n=(0,F.V)("addr.reverse"),r=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",s=await e.readContract({address:r,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"owner",args:[n]});console.log("*********** Reverse registrar:",s);let l=await e.readContract({address:r,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"owner",args:[o]});console.log("*********** Reverse registrar for our reverse node:",l);let d=(0,_.R)({abi:[{name:"setName",type:"function",stateMutability:"nonpayable",inputs:[{name:"name",type:"string"}],outputs:[{name:"node",type:"bytes32"}]}],functionName:"setName",args:[i]}),c=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:t,paymasterContext:{mode:"SPONSORED"}});console.log("Setting reverse name record using agent's AA..."),console.log("reverseRegistrar:",s);let p=await c.sendUserOperation({account:a,calls:[{to:s,data:d,value:0n}],maxFeePerGas:412596685n,maxPriorityFeePerGas:412596676n}),{receipt:u}=await c.waitForUserOperationReceipt({hash:p});console.log("*********** Reverse name record set successfully xxxxxx");let y=(0,eg.R)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),m=await y.getName({address:a.address});return console.log("*********** done reverse from ens address:  ",m),(null==m?void 0:m.name)||null}catch(e){console.log("Could not read current reverse name:",e)}let s=(0,F.V)(i),l=(0,k.v)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),d=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",c=await l.readContract({address:d,abi:[{name:"resolver",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{type:"address"}]}],functionName:"resolver",args:[s]});console.log("........... resolver:",c);let p=await l.readContract({address:d,abi:[{name:"owner",stateMutability:"view",type:"function",inputs:[{name:"node",type:"bytes32"}],outputs:[{type:"address"}]}],functionName:"owner",args:[s]});console.log("........... owner:",p),console.log("........... agent address:",a.address);let u=BigInt(s),y=await l.readContract({address:eh.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8",abi:ey.Mt,functionName:"ownerOf",args:[u]});console.log("........... actual owner:",y);let m=(0,_.R)({abi:[{name:"setAddr",type:"function",stateMutability:"nonpayable",inputs:[{name:"node",type:"bytes32"},{name:"a",type:"address"}]}],functionName:"setAddr",args:[s,a.address]}),g=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:t,paymasterContext:{mode:"SPONSORED"}});console.info("sending user operation to set addr record");let h=await g.sendUserOperation({account:a,calls:[{to:c,data:m}],maxFeePerGas:412596685n,maxPriorityFeePerGas:412596676n});console.info("get address record receipt");let{receipt:f}=await g.waitForUserOperationReceipt({hash:h});console.info("get address record");let b=(0,eg.R)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),x=await b.getAddressRecord({name:e+".orgtrust.eth"});return(null==x?void 0:x.value)||null}catch(e){return console.error("Error getting ENS address:",e),null}}static async getEnsAddress(e,t){try{let n=(0,eg.R)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),a=await n.getAddressRecord({name:e});return(null==a?void 0:a.value)||null}catch(e){return console.error("Error getting ENS address:",e),null}}static async getTextRecord(e,t,n,a){try{eb(n);let r=a||"https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A";if(!r)throw Error("RPC URL is not configured");let i=(0,k.v)({chain:n,transport:(0,M.d)(r)}),o=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",s=e.endsWith(".eth")?e:"".concat(e,".eth"),l=(0,F.V)(s),d=await i.readContract({address:o,abi:[{name:"resolver",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"resolver",args:[l]});if(!d||"0x0000000000000000000000000000000000000000"===d)return null;let c=await i.readContract({address:d,abi:em.Mt,functionName:"text",args:[l,t]}).catch(()=>null);return"string"==typeof c&&""!==c.trim()?c:null}catch(n){return console.error("Error reading text record",{name:e,key:t,error:n}),null}}static async getEnsData(e,t){try{let n=(0,eg.R)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),a=await n.getName({address:e});return{name:(null==a?void 0:a.name)||null,avatar:null}}catch(e){return console.error("Error getting ENS data:",e),{name:null,avatar:null}}}static async getEnsComprehensiveData(e,t){try{let n=await this.getEnsData(e,t);if(!n.name)return{name:null,avatar:null,website:null,email:null,twitter:null,github:null,discord:null};let a=null;console.log("About to fetch avatar for ENS name:",n.name,"on chain:",t.name);try{a=await this.getEnsAvatar(n.name,t),console.log("Fetched avatar for ENS name:",n.name,"Avatar:",a)}catch(e){console.error("Error fetching avatar for ENS name:",n.name,e),console.error("Avatar error details:",e)}return{name:n.name,avatar:a,website:null,email:null,twitter:null,github:null,discord:null}}catch(e){return console.error("Error getting comprehensive ENS data:",e),{name:null,avatar:null,website:null,email:null,twitter:null,github:null,discord:null}}}static async getEnsAvatar(e,t){try{console.log("getEnsAvatar called with:",{ensName:e,chainName:t.name});let n=e.replace(/^ENS:\s*/,""),a=(n=(n=n.replace(/\.eth$/i,"")).replace(/[^a-zA-Z0-9-]/g,"").toLowerCase())+".eth";if(console.log("ENS name cleaning:",{original:e,cleaned:n,fullName:a}),!n||n.length<3)return console.error("Invalid ENS name after cleaning:",{original:e,cleaned:n}),null;let r=(0,k.v)({chain:t,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),i=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",o=(0,F.V)(a),s=await r.readContract({address:i,abi:[{name:"resolver",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"resolver",args:[o]});if(!s||"0x0000000000000000000000000000000000000000"===s)return console.log("No resolver found for ENS name:",a),console.log("Resolver address returned:",s),null;console.log("Resolver address found:",s),console.log("Fetching avatar text record for node:",o);let l=await r.readContract({address:s,abi:em.Mt,functionName:"text",args:[o,"avatar"]});console.log("Avatar text record result:",l),console.log("Avatar type:",typeof l);let d="string"==typeof l?l:null;return console.log("Returning avatar:",d),d}catch(e){return console.error("Error getting ENS avatar:",e),null}}static async findCorrectEnsName(e,t){try{let n=await e.getAddress();console.log("Looking for ENS name for address:",n);let a=await this.getEnsName(n,t);if(a)return console.log("Found ENS name via reverse resolution:",a),a;return console.log("No ENS name found via reverse resolution"),null}catch(e){return console.error("Error finding ENS name:",e),null}}static async updateEnsAvatar(e,t,n,a){try{let r=t.replace(/^ENS:\s*/,""),i=(r=(r=r.replace(/\.eth$/i,"")).replace(/[^a-zA-Z0-9-]/g,"").toLowerCase())+".eth",o=(0,k.v)({chain:a,transport:(0,M.d)(eh.env.NEXT_PUBLIC_RPC_URL)}),s=(0,V.E)({transport:(0,M.d)("https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"),paymaster:!0,chain:a,paymasterContext:{mode:"SPONSORED"}}),l={maxFeePerGas:412596685n,maxPriorityFeePerGas:412596676n},d=eh.env.NEXT_PUBLIC_ENS_REGISTRY||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",c=(0,F.V)(i),p=await o.readContract({address:d,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"owner",args:[c]});if(!p||"0x0000000000000000000000000000000000000000"===p){console.error("ENS name does not exist:",i),console.error("Current network:",a.name),console.error("Possible solutions:"),console.error("1. Check if the ENS name is correct"),console.error("2. The ENS name might not exist on Sepolia testnet"),console.error("3. The ENS name might not be registered yet");let e=[r.replace("eth",""),r.replace("canvas",""),r.replace("rich",""),"aarichcanvas","richcanvas"];return console.error("Suggested ENS names to try:",e),!1}console.log("ENS owner:",p);let u=await e.getAddress();if(p.toLowerCase()!==u.toLowerCase())return console.error("Smart account is not the owner of the ENS name"),console.error("Smart account address:",u),console.error("ENS owner:",p),console.error("You can only update ENS records if you own the ENS name"),!1;let y=await o.readContract({address:d,abi:[{name:"resolver",type:"function",stateMutability:"view",inputs:[{name:"node",type:"bytes32"}],outputs:[{name:"",type:"address"}]}],functionName:"resolver",args:[c]});if(!y||"0x0000000000000000000000000000000000000000"===y)return console.error("No resolver found for ENS name:",i),console.error("This could mean:"),console.error("1. The ENS name doesn't exist"),console.error("2. The ENS name is on a different network"),console.error("3. The ENS name doesn't have a resolver set"),console.error("Current network:",a.name),!1;console.log("Resolver address:",y);try{let e=await o.readContract({address:y,abi:em.Mt,functionName:"text",args:[c,"avatar"]});if(console.log("Current avatar:",e),e===n)return console.log("Avatar is already set to the same value"),!0}catch(e){console.log("Could not read current avatar, proceeding with update")}let m=(0,_.R)({abi:em.Mt,functionName:"setText",args:[c,"avatar",n]});console.log("Setting avatar with data:",m),console.log("Calling resolver at:",y);try{let t=await s.sendUserOperation({account:e,calls:[{to:y,data:m,value:0n}],...l}),{receipt:n}=await s.waitForUserOperationReceipt({hash:t});return console.log(" ENS avatar updated successfully"),console.log("\uD83D\uDD17 View: https://sepolia.app.ens.domains/".concat(i,"?tab=more")),!0}catch(m){console.error("Failed to update avatar with current resolver:",m),console.log("Trying to set a new resolver first...");let t="0x8FADE66B79cC9f707aB26799354482EB93a5B7dD",a=(0,_.R)({abi:[{name:"setResolver",type:"function",stateMutability:"nonpayable",inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],outputs:[]}],functionName:"setResolver",args:[c,t]}),r=await s.sendUserOperation({account:e,calls:[{to:d,data:a,value:0n}],...l}),{receipt:o}=await s.waitForUserOperationReceipt({hash:r});console.log(" New resolver set successfully");let p=(0,_.R)({abi:em.Mt,functionName:"setText",args:[c,"avatar",n]}),u=await s.sendUserOperation({account:e,calls:[{to:t,data:p,value:0n}],...l}),{receipt:y}=await s.waitForUserOperationReceipt({hash:u});return console.log(" ENS avatar updated successfully with new resolver"),console.log("\uD83D\uDD17 View: https://sepolia.app.ens.domains/".concat(i,"?tab=more")),!0}}catch(e){return console.error("Error updating ENS avatar:",e),e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message&&e.message.includes("UserOperation reverted")&&(console.error("The transaction was reverted. This could be because:"),console.error("1. The smart account doesn't have permission to update this ENS record"),console.error("2. The resolver contract doesn't support the setText function"),console.error("3. The ENS name might be on a different network"),console.error("4. The resolver might be outdated or incompatible")),!1}}}var ew=n(32608);function eT(){let e=ew.env.NEXT_PUBLIC_IDENTITY_API_URL||ew.env.NEXT_PUBLIC_API_URL;return e&&""!==e.trim()?e:"http://localhost:4000"}async function ej(e,t){let n=eT(),a=e.startsWith("http")?e:"".concat(n).concat(e),r=await fetch(a,{...t,headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},credentials:"include"});if(!r.ok){let e="Request failed: ".concat(r.status);try{let t=await r.json();(null==t?void 0:t.error)&&(e=String(t.error))}catch(e){}throw Error(e)}return await r.json()}class eS{static get apiBase(){return eT()}static async uploadJson(e){var t;let n={data:e.data,filename:null!==(t=e.filename)&&void 0!==t?t:"data.json"},a=await ej("/api/web3storage/upload",{method:"POST",body:JSON.stringify(n)});return{cid:a.cid,url:a.url}}static async downloadJson(e){var t;return null!==(t=(await ej("/api/web3storage/download/".concat(e))).data)&&void 0!==t?t:null}static async saveCredentials(e){let t=await ej("/api/web3storage/credentials/save",{method:"POST",body:JSON.stringify({credentials:e.credentials,did:e.did})});return{cid:t.cid,url:t.url}}static async getCredentials(e){var t;return null!==(t=(await ej("/api/web3storage/credentials/".concat(e))).data)&&void 0!==t?t:null}static async deleteCredentials(e){return!!(await ej("/api/web3storage/credentials/".concat(e),{method:"DELETE"})).success}static async getStatus(){return await ej("/api/web3storage/status")}}var eC=n(23701),eD=n(45945),eE=n(64662),eA=n(24602),eI=n(61537),eZ=n(552);function eN(e){let{open:t,onClose:n}=e,[o,s]=r.useState("0xaa36a7"),[d,c]=r.useState("8004-agent"),[u,y]=r.useState(!1),[g,h]=r.useState(null),[f,b]=r.useState(""),[x,v]=r.useState(""),[w,T]=r.useState(""),[E,A]=r.useState(null),[I,Z]=r.useState(!1),[N,F]=r.useState(null),[_,L]=r.useState(null),[Y,$]=r.useState(null),[Q,ee]=r.useState(!1),[ea,ei]=r.useState(null),[eo,es]=r.useState(""),[el,ed]=r.useState(!0),[ec,ep]=r.useState(!1),[eu,ey]=r.useState(null),[em,eg]=r.useState(null),[eh,ef]=r.useState(!1),[eb,ex]=r.useState(null),[ew,eT]=r.useState(null),[ej,eN]=r.useState(null),[eR,ek]=r.useState(!1),[eM,eP]=r.useState(null),[eO,eF]=r.useState(null),[eU,eW]=r.useState(null),[e_,eL]=r.useState(null),[eB,ez]=r.useState(null),[eH,eG]=r.useState(null),[eJ,eV]=r.useState(null),[eK,eX]=r.useState(null),[eq,eY]=r.useState(!1),[e$,eQ]=r.useState(null),[e0,e2]=r.useState(""),[e1,e5]=r.useState(!1),[e6,e3]=r.useState(!1),[e7,e8]=r.useState(null),[e4,e9]=r.useState(null),[te,tt]=r.useState(!1),[tn,ta]=r.useState(!1),[tr,ti]=r.useState(null),{provider:to,address:ts}=(0,R.m)(),tl=(0,eA.u)(),td=(0,eC.useAgentENSClient)(),tc=(0,eI.h)(),tp=(0,eA.v)(o||"0xaa36a7"),tu=(0,eE.useAgentIdentityClient)(),ty=tp||tu,tm=(0,eD.v)(o||"0xaa36a7");r.useEffect(()=>{console.log("\uD83D\uDD0D ENS Client debug effect triggered"),console.log("\uD83D\uDD0D agentENSClientForChain:",!!tm),console.log("\uD83D\uDD0D selectedChainIdHex:",o),tm?(console.log("\uD83D\uDD0D ENS Client configured for chain:",o||"0xaa36a7"),console.log("\uD83D\uDD0D ENS Client available:",!!tm)):console.log("\uD83D\uDD0D No ENS client available")},[tm,o]),r.useEffect(()=>{if(!o){let e=Object.keys(tl)[0];e&&s(e)}},[tl,o]),r.useEffect(()=>{t&&(s("0xaa36a7"),console.log("Resetting chain to Ethereum Sepolia for Create Agent Identity"))},[t]),r.useEffect(()=>{w&&d&&""!==w.trim()&&""!==d.trim()?tT(w.trim(),d.trim()):console.info("Not calling checkAgentAvailability - conditions not met")},[w,d]),r.useEffect(()=>{let e=tv(f),t=tw(d);e&&t?T("".concat(e,".").concat(t,".eth")):(T(""),A(null))},[f,d]),r.useEffect(()=>{try{if(!eK)return;let e=tw(d);if(!e)return;let t="".concat(e,".eth");eY(!0),eQ(null);let n=!1;return(async()=>{try{let e=await tc.getOrgUrlByName(t);n||eX(e)}catch(e){n||eQ((null==e?void 0:e.message)||"Failed to fetch org URL")}finally{n||eY(!1)}})(),()=>{n=!0}}catch(e){eQ((null==e?void 0:e.message)||"Failed to fetch org URL")}},[d,tc]),r.useEffect(()=>{let e=!1;return(async()=>{try{if(!w||!tc)return;let t=await tc.getOrgUrlByName(w);!e&&t&&/^https?:\/\//i.test(t)&&$(t)}catch(e){}})(),()=>{e=!0}},[w,tc]),r.useEffect(()=>{if(!el)return;let e=f||(w?w.split(".")[0]:"");if(!e||!eK)return;let t=tv(e),n=eK.replace(/\/$/,""),a=n&&t?"".concat(n,"/").concat(t):"";a&&a!==eo&&es(a)},[f,eK,el,w]);let tg=r.useCallback(()=>{if("0xaa36a7"===o&&td)return td;if(tm)return tm;if(!td)throw Error("No ENS client available");return td},[o,td,tm]),th=e=>({request:async t=>{let{method:n,params:a}=t;console.log("\uD83D\uDD0D Provider request: ".concat(n),a);try{let t;if(e.request)t=await e.request({method:n,params:a});else if(e.send)t=await e.send(n,a||[]);else if(e._send)t=await e._send(n,a||[]);else{let r=e.provider||e._provider;if(r&&r.request)t=await r.request({method:n,params:a});else throw Error("No compatible request method found on provider: ".concat(Object.keys(e)))}return console.log("\uD83D\uDD0D Provider response:",t),t}catch(e){throw console.error(" Provider request failed:",e),e}}}),tf=r.useMemo(()=>{let e=(0,eZ.hf)(o||"0xaa36a7");return(null==e?void 0:e.rpcUrl)||"https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A"},[o]),tb=r.useMemo(()=>{let e=(0,eZ.hf)(o||"0xaa36a7");return(null==e?void 0:e.bundlerUrl)||"https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT"},[o]),tx=r.useMemo(()=>{let e=(0,eZ.hf)(o||"0xaa36a7");return(null==e?void 0:e.viemChain)||z.F},[o]);function tv(e){return e.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").toLowerCase()}function tw(e){let t=e.trim().toLowerCase().replace(/^ens:\s*/i,"").replace(/\.eth$/i,""),n=t.replace(/[^a-z0-9-]/g,"");return console.info("............cleanOrg: base: ",t,"baseClean: ",n),n}async function tT(e,t){if(e&&t){console.info("checking agent availability"),tt(!0),ti(null);try{let t=tx.id,n=(0,eZ._V)(t),a="L2"===n,r=tg();console.info("Checking availability for: ".concat(e," (").concat(a?"L2":"L1",")")),console.info("Selected chain: ".concat(o,", resolvedChain.id: ").concat(t,", isL2: ").concat(a));let i=!1;try{console.info(".................... getAgentAccountByName: ",e);let t=await r.getAgentAccountByName(e);i=!t||"0x0000000000000000000000000000000000000000"===t}catch(e){i=!0}console.info("".concat(a?"L2":"L1"," availability result:"),i),e9(i),console.info("Agent ".concat(e," availability:"),i)}catch(e){console.error("Error checking agent availability:",e),ti(e instanceof Error?e.message:"Failed to check availability")}finally{tt(!1)}}}async function tj(e,t,n){if(!e||!t)throw Error("Missing agent name or org name for deployment");if(!tb)throw Error("Missing BUNDLER_URL for deployment");let a=eu||E,r=null;try{var i;let t=(0,k.v)({chain:tx,transport:(0,M.d)(tf)}),n=o||"0xaa36a7";await to.request({method:"wallet_addEthereumChain",params:[{chainId:n,chainName:(null===(i=(0,eZ.hf)(n))||void 0===i?void 0:i.chainName)||"ETH Sepolia",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:[tf]}]}),await to.request({method:"wallet_switchEthereumChain",params:[{chainId:n}]}),await new Promise(e=>setTimeout(e,2e3));let s=new K.Q(to),l=th(s),d=(0,P.K)({chain:tx,transport:(0,O.P)(l),account:ts});try{d.account=ts}catch(e){}let c=(0,J.r)({transport:(0,M.d)(tb)}),p=(0,V.E)({transport:(0,M.d)(tb),paymaster:!0,chain:tx,paymasterContext:{mode:"SPONSORED"}});if(r=await tS(e.toLowerCase(),t,d),a=await r.getAddress(),!await r.isDeployed()){let{fast:e}=await c.getUserOperationGasPrice();console.info("send user operation with bundlerClient 2: ",p);let t=await p.sendUserOperation({account:r,calls:[{to:U.DR}],...e});console.info("individual account is deployed - done");let{receipt:n}=await p.waitForUserOperationReceipt({hash:t})}}catch(e){console.error("Failed to compute agent address:",e),ti("Failed to compute agent address for agent name creation");return}if(a){ta(!0),ti(null);try{let t=e.split(".");if(t.length<2)throw Error("Invalid subname format");let n=t.slice(1).join("."),i=tx.id,s=(0,eZ._V)(i);console.info("Creating subname - Selected chain: ".concat(o,", resolvedChain.id: ").concat(i,", isL2: ").concat("L2"===s)),console.log("deployment done ======> prepareAddAgentNameToOrgCalls");let l="https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A",d=(0,k.v)({chain:z.F,transport:(0,M.d)(l)}),c=(0,B.L)("0xff85d3e0d73d08284d5dee93bc74faff93280d84e82baf68a72e809092ed245f");console.info("@@@@@@@@@@@@@@@@@@@ orgOwnerAddress: ",eO),console.info("@@@@@@@@@@@@@@@@@@@ l1RpcUrl: ",l),console.info("@@@@@@@@@@@@@@@@@@@ orgOwnerEOA: ",c),console.info("@@@@@@@@@@@@@@@@@@@ resolvedChain: ",tx.id),console.info("@@@@@@@@@@@@@@@@@@@ parentName: ",n),console.info("@@@@@@@@@@@@@@@@@@@ orgStatus: ",ej),console.info("@@@@@@@@@@@@@@@@@@@ agentAccountClient address: ",await r.getAddress());let p=await (0,H.gU)({address:eO,client:d,implementation:G.vc.Hybrid,signatory:{account:c}}),u=e.trim().split(".")[0];console.info("@@@@@@@@@@@@@@@@@@@ agentNameLabel: ",u);let y=eo&&/^https?:\/\//i.test(eo)?eo:Y&&/^https?:\/\//i.test(Y)?Y:"";await et({agentENSClient:tg(),bundlerUrl:tb,chain:tx,orgAccountClient:p,orgName:n,agentAccountClient:r,agentName:u,agentUrl:y,agentAccount:a}),console.log("Agent name added to org successfully!"),console.log("Setting agentExists to true and agentAvailable to false"),F(!0),e9(!1),ts&&(eg(ts),console.log("Setting ensAgentOwnerEoa to:",ts));try{console.log("Refreshing agent URL for:",e);let t=await tg().getAgentUrlByName(e);console.log("Retrieved agent URL:",t),$(t),es(null!=t?t:"")}catch(e){console.warn("Failed to refresh agent URL after creation:",e)}}catch(e){console.error("Error creating agent name:",e),ti(e instanceof Error?e.message:"Failed to create agent name")}finally{ta(!1)}}}r.useEffect(()=>{if(!w||!w.trim())return;let e=!1;return(async()=>{try{Z(!0);let t=tg(),n=await t.getAgentAccountByName(w);e||A(n)}catch(t){e||A(null)}finally{e||Z(!1)}})(),()=>{e=!0}},[o,w,tm,td]);let tS=r.useCallback(async(e,t,n)=>{try{let a=await n.getChainId();if(a!==tx.id){console.info("\uD83D\uDD04 Wallet is on chain ".concat(a,", switching to ").concat(tx.id," (").concat(tx.name,")"));try{await n.switchChain({id:tx.id}),console.info(" Successfully switched to chain ".concat(tx.id))}catch(e){throw console.error(" Failed to switch chain:",e),Error("Wallet is connected to chain ".concat(a," but expected chain ").concat(tx.id,". Please switch to ").concat(tx.name," manually."))}}if(e&&""!==e.trim()){if(!tm)throw Error("ENS client not available for the selected chain");let{agentId:a,account:r}=await tm.getAgentIdentityByName(e.trim());if(r)return await (0,H.gU)({address:r,client:t,implementation:G.vc.Hybrid,signatory:{walletClient:n}})}}catch(t){console.error("error getting agent by name",e,t)}let a=await tg().getAgentAccountByName(e);if(a){let r=await (0,H.gU)({address:a,client:t,implementation:G.vc.Hybrid,signatory:{walletClient:n}});return console.info("++++++++++++++ ens found with name",e,r.address),r}let r=(0,er.w)((0,W.$G)(e));return await (0,H.gU)({client:t,implementation:G.vc.Hybrid,deployParams:[ts,[],[],[]],signatory:{walletClient:n},deploySalt:r})},[ts,tx]);async function tC(e){var t,a,r;if(console.log("********************* handleSubmit",e),e.preventDefault(),!to){h("Please login first");return}if(!w.trim()){h("agent name is required");return}h(null),y(!0);try{await tj(w,d,eu||E);let e=w.trim().toLowerCase(),r=(0,k.v)({chain:tx,transport:(0,M.d)(tf)});if(!ts)throw Error("No EOA address from Web3Auth");let i=o||"0xaa36a7";await to.request({method:"wallet_addEthereumChain",params:[{chainId:i,chainName:(null===(t=(0,eZ.hf)(i))||void 0===t?void 0:t.chainName)||"ETH Sepolia",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:[tf]}]}),await to.request({method:"wallet_switchEthereumChain",params:[{chainId:i}]}),console.log("********************* 3333333333333333 Waiting for wallet to adapt to chain switch..."),await new Promise(e=>setTimeout(e,2e3)),console.log("********************* Chain switch adaptation complete");let s=new K.Q(to),l=th(s),c=(0,P.K)({chain:tx,transport:(0,O.P)(l),account:ts});try{c.account=ts}catch(e){}console.info(".................... getDefaultAgentAccountClient 2: ",e);let p=await tS(e,r,c),u=await p.getAddress();try{let{agentId:e}=await tg().getAgentIdentityByAccount(u);if(e&&e>0n){y(!1),h("Agent already exists for address ".concat(u," (id ").concat(e.toString(),")"));return}}catch(e){}let m="";try{let t=(eo||"").replace(/\/$/,""),n=tv(f);"".concat(n,".").concat(t);let r="".concat(t,"/.well-known/agent-card.json"),i=[];r&&i.push({name:"A2A",endpoint:r,version:"0.3.0"}),e&&i.push({name:"ENS",endpoint:e,version:"v1"});let s=(0,eZ.hf)(o||"0xaa36a7"),l=(null==s?void 0:s.chainId)||11155111;i.push({name:"agentAccount",endpoint:"eip155:".concat(l,":").concat(u),version:"v1"});let d={type:"https://eips.ethereum.org/EIPS/eip-8004#registration-v1",name:e,description:x||"",image:null,endpoints:i,registrations:(async()=>{try{let e=(0,eZ.v4)(l);if(e)return[{agentRegistry:"eip155:".concat(l,":").concat(e)}]}catch(e){}return[]})(),supportedTrust:["reputation","crypto-economic","tee-attestation"]};"function"==typeof(null===(a=d.registrations)||void 0===a?void 0:a.then)&&(d.registrations=await d.registrations),m=(await eS.uploadJson({data:d,filename:"agent_".concat(e,".json")})).url}catch(e){console.warn("IPFS upload failed, proceeding without tokenUri",e)}console.log("********************* adapterCreateAIAgentIdentity: tokenUri",m),await en({agentIdentityClient:ty,bundlerUrl:tb,chain:tx,agentAccount:p,name:e,tokenUri:m}),y(!1),n()}catch(e){y(!1),h(null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"Failed to submit")}}return r.useEffect(()=>{if(!w||!w.trim()||!ts){L(null);return}let e=!1;return(async()=>{try{let t=(0,k.v)({chain:tx,transport:(0,M.d)(tf)}),n=(0,P.K)({chain:tx,transport:(0,O.P)(to),account:ts});try{n.account=ts}catch(e){}console.info(".................... getDefaultAgentAccountClient 1: ",w.toLowerCase());let a=await tS(w.toLowerCase(),t,n),r=await a.getAddress();e||(L(r),console.log("Computed agent AA default address:",r,"for chain:",tx.name))}catch(t){e||(console.warn("Failed to compute agent AA default address:",t),L(null))}})(),()=>{e=!0}},[w,o,ts,to,tx,tf,tS]),r.useEffect(()=>{if(!w||!w.trim()){ex(null),eT(null);return}let e=!1;return(async()=>{try{let{agentId:t,account:n}=await tg().getAgentIdentityByName(w.trim());e||(t&&t>0n?(ex(!0),eT(t.toString()),console.log("Agent identity exists for",w,"with ID:",t.toString())):(ex(!1),eT(null),console.log("No agent identity found for",w)))}catch(t){e||(console.warn("Failed to check agent identity existence:",t),ex(null),eT(null))}})(),()=>{e=!0}},[w,tg]),r.useEffect(()=>{let e=tw(d);if(!e){eN(null),ek(!1),eP(null),eW(null),eL(null),ez(null),eG(null),eV(null),eX(null),eY(!1),e2(""),eF(null),eQ(null);return}let t=!1;return(async()=>{var n,a,r;try{ek(!0),eP(null);let r=(0,k.v)({chain:z.F,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")}),i=await ev.checkEnsNameStatus(e,z.F);t||eN(i);let o=null;if(i&&(o=i.isWrapped?i.nameWrapperOwner||i.ensRegistryOwner||null:i.baseRegistrarOwner||i.ensRegistryOwner||null),t||eF(o),o){try{let e=await r.getBytecode({address:o});t||eW(!!e)}catch(e){t||eW(null)}try{let e=await tc.getOrgNameByAccount(o);t||eL(e)}catch(e){t||eL(null)}try{eY(!0),eQ(null);try{let n=await tc.getOrgUrlByName(e);t||(eX(n),e2(null!=n?n:""))}catch(e){t||(eX(null),e2(""),eQ(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Failed to read url"))}finally{t||eY(!1)}}catch(e){t||(eV(null),eX(null),e2(""),eQ(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Failed to read resolver"))}try{let e=null;if(await r.getBytecode({address:o})){try{e=await r.readContract({address:o,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[],outputs:[{type:"address"}]}],functionName:"owner"})}catch(e){}if(!e)try{e=await r.readContract({address:o,abi:[{name:"getOwner",type:"function",stateMutability:"view",inputs:[],outputs:[{type:"address"}]}],functionName:"getOwner"})}catch(e){}if(!e)try{let t=await r.readContract({address:o,abi:[{name:"owners",type:"function",stateMutability:"view",inputs:[],outputs:[{type:"address[]"}]}],functionName:"owners"});Array.isArray(t)&&t.length>0&&(e=t[0])}catch(e){}}else e=o;if(t||ez(e),e)try{let n=await tc.getOrgNameByAccount(e);t||eG(n)}catch(e){t||eG(null)}else t||eG(null)}catch(e){t||(ez(null),eG(null))}}else t||(eW(null),eL(null),ez(null),eG(null),eV(null),eX(null),e2(""))}catch(e){t||(eN(null),eP(null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"Failed to check org"),eW(null),eL(null),ez(null),eG(null),eV(null),eX(null),e2(""),eF(null))}finally{t||ek(!1)}})(),()=>{t=!0}},[d]),(0,a.jsxs)(j.Z,{open:t,onClose:n,fullWidth:!0,maxWidth:"md",sx:{"& .MuiDialog-paper":{minHeight:"600px"}},children:[(0,a.jsxs)(S.Z,{children:["Create Agent Identity",(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",display:"block",children:["Connected EOA: ",null!=ts?ts:"Not connected"]})]}),(0,a.jsx)(C.Z,{sx:{overflow:"visible"},children:(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsxs)(i.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:"bold"},children:"Agent Chain"}),(0,a.jsx)("select",{value:o,onChange:e=>{let t=e.target.value||"0xaa36a7";s(t),"0xaa36a7"===t?c("8004-agent"):"0x14a34"===t?c("agnt"):c("")},style:{flex:1,padding:"8px 12px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"14px"},children:Object.keys(tl).map(e=>{let t=(0,eZ.hf)(e),n=(null==t?void 0:t.chainName)||e;return(0,a.jsx)("option",{value:e,children:n},e)})})]}),(0,a.jsx)(p.Z,{label:"Org",placeholder:"8004-agent.eth",value:d,onChange:e=>c(e.target.value),fullWidth:!0,autoFocus:!0}),(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",display:"block",sx:{ml:5,wordBreak:"break-all",minHeight:"20px"},children:d?eR?"Org: checking":eM?"Org: error  ".concat(eM):(null==ej?void 0:ej.exists)?(()=>{let e=tw(d),t=ej.isWrapped?"wrapped":"unwrapped",n="https://sepolia.app.ens.domains/".concat(e,".eth");return(0,a.jsxs)(i.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,a.jsxs)("span",{children:["Org ENS: ",(0,a.jsxs)("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:[e,".eth"]}),"  ",t]}),!ej.isWrapped&&("baseRegistrar"===ej.registrationMethod||"ensRegistry"===ej.registrationMethod)&&(0,a.jsx)(l.Z,{size:"small",variant:"outlined",disabled:!!(e6||!to),onClick:async()=>{try{if(e3(!0),e8(null),!to)throw Error("Wallet not connected");let e=tw(d),t="".concat(e,".eth"),n=await tc.getOrgAccountByName(t),a="0xff85d3e0d73d08284d5dee93bc74faff93280d84e82baf68a72e809092ed245f";if(!a)throw Error("NEXT_PUBLIC_ETH_SEPOLIA_ENS_PRIVATE_KEY not configured");let r=(0,B.L)(a);console.info("@@@@@@@@@@@@@@@@@@@ ensAccount: ",r.address),console.info("@@@@@@@@@@@@@@@@@@@ orgOwnerAddress: ",n);let i=(0,P.K)({chain:z.F,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A"),account:r}),o=new X.r6("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A"),s=new q.w(a,o),l=(0,k.v)({chain:z.F,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")});console.info("@@@@@@@@@@@@@@@@@@@ orgOwnerAddress: ",n);let c=await (0,H.gU)({address:n,client:l,implementation:G.vc.Hybrid,signatory:{walletClient:i}});console.info("@@@@@@@@@@@@@@@@@@@ wrapping org name: ",e),console.info("@@@@@@@@@@@@@@@@@@@ smartAccountClient: ",c.address),await ev.wrapEnsDomainName(s,c,e,z.F);let p=await ev.checkEnsNameStatus(t,z.F);eN(p),e3(!1)}catch(e){console.error("Error wrapping org:",e),e8((null==e?void 0:e.message)||"Failed to wrap domain"),e3(!1)}},children:e6?"Wrapping...":"Wrap Domain"}),e7&&(0,a.jsx)(m.Z,{variant:"caption",color:"error",children:e7})]})})():(()=>{let e=tw(d),t="https://sepolia.app.ens.domains/".concat(e,".eth");return(0,a.jsxs)(a.Fragment,{children:["Org not found  ",(0,a.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:["search ",e,".eth"]})]})})():"Enter an ENS Org (e.g. airbnb.eth)"}),(0,a.jsx)("br",{}),(0,a.jsx)(p.Z,{label:"Agent Name",value:f,onChange:e=>b(e.target.value),fullWidth:!0}),(0,a.jsx)(p.Z,{label:"Agent URL",value:eo,onChange:e=>{es(e.target.value)},fullWidth:!0,placeholder:"https://example.com/agent-name",sx:{ml:5}}),(0,a.jsx)(p.Z,{label:"Agent Description",value:x,onChange:e=>v(e.target.value),fullWidth:!0}),w&&d&&(0,a.jsx)(i.Z,{spacing:1,sx:{ml:5,mt:1},children:te?(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",children:"Checking availability..."}):!0===e4?(0,a.jsx)(i.Z,{direction:"row",alignItems:"center",spacing:1,children:(0,a.jsxs)(m.Z,{variant:"caption",color:"success.main",children:[" ",w," is available"]})}):!0===N?(0,a.jsxs)(i.Z,{spacing:.5,children:[(0,a.jsxs)(m.Z,{variant:"caption",color:"success.main",children:[" ",(0,a.jsx)("a",{href:"https://sepolia.app.ens.domains/".concat(w),target:"_blank",rel:"noopener noreferrer",children:w})," exists"]}),E&&"0x0000000000000000000000000000000000000000"!==E&&(0,a.jsxs)(m.Z,{variant:"caption",color:"warning.main",children:[" Agent account already exists: ",E,". Cannot create new identity."]}),em&&ts&&em.toLowerCase()!==ts.toLowerCase()&&(0,a.jsxs)(m.Z,{variant:"caption",color:"error",children:[" ENS name is owned by a different account (",em,"). Connect that wallet or use a name you control."]})]}):!1===e4?(0,a.jsxs)(m.Z,{variant:"caption",color:"warning.main",children:[" ",w," is not available"]}):tr?(0,a.jsxs)(m.Z,{variant:"caption",color:"error",children:["Error: ",tr]}):null}),!0===eb&&(0,a.jsxs)(m.Z,{variant:"body2",color:"error",children:["Create disabled: Agent Identity already exists for this agent",ew?" (ID: ".concat(ew,")"):"","."]}),g&&(0,a.jsx)(m.Z,{variant:"body2",color:"error",children:g})]})}),(0,a.jsxs)(D.Z,{children:[(0,a.jsx)(l.Z,{onClick:n,disabled:u,children:"Cancel"}),(0,a.jsx)(l.Z,{onClick:tC,variant:"contained",disableElevation:!0,disabled:!!(u||!to||!0===eb||!w.trim()||!eo||!/^https?:\/\//i.test(eo)||em&&ts&&em.toLowerCase()!==ts.toLowerCase()||!0===N&&E&&"0x0000000000000000000000000000000000000000"!==E),children:"Create Agent Identity"})]})]})}var eR=n(51363),ek=n(84922);function eM(e){console.log("\uD83D\uDD0D generatePublicKeyJwkFromPrivateKey called with:",e.slice(0,10)+"...");let t=(0,B.L)(e).publicKey;console.log("\uD83D\uDD0D Generated public key from private key:",t);let n=t.slice(2),a=n.slice(0,64),r=n.slice(64,128);console.log("\uD83D\uDD0D Extracted coordinates:",{xHex:a,yHex:r});let i=eU(a),o=eU(r);return console.log("\uD83D\uDD0D Base64URL coordinates:",{x:i,y:o}),{x:i,y:o,jwk:{kty:"EC",crv:"secp256k1",x:i,y:o}}}function eP(e){console.log("\uD83D\uDD0D generateDeterministicJwkFromAddress called with:",e);let t=(0,er.w)((0,W.$G)(e)),n="0x".concat(t.slice(2));return console.log("\uD83D\uDD0D Generated deterministic private key:",n.slice(0,10)+"..."),eM(n)}async function eO(e,t){try{var n;console.log("\uD83D\uDD0D Generating JWK from wallet signature...",{provider:!!e,address:t,hasRequest:"function"==typeof(null==e?void 0:e.request),isMetaMask:null==e?void 0:e.isMetaMask,providerType:null==e?void 0:null===(n=e.constructor)||void 0===n?void 0:n.name});let a="DID:Web JWK Generation for ".concat(t),r=(0,er.w)((0,W.$G)(a));console.log("\uD83D\uDCDD Requesting signature from wallet...",{message:a,messageHash:r,address:t,messageLength:a.length});let i=await e.request({method:"personal_sign",params:[a,t]});console.log(" Wallet signature received:",{signature:i,address:t,message:a,signatureLength:i.length});let o=i.slice(2),s="0x".concat(o.slice(0,64)),l="0x".concat(o.slice(64,128)),d=parseInt(o.slice(128,130),16);console.log("\uD83D\uDD0D Signature components:",{r:s,s:l,v:d});let c=await eF({hash:r,signature:{r:s,s:l,v:BigInt(d)}});console.log(" Public key recovered:",c);let p=c.slice(4,68),u=c.slice(68,132),y=eU(p),m=eU(u);return console.log(" JWK coordinates generated:",{x:y,y:m}),{x:y,y:m,jwk:{kty:"EC",crv:"secp256k1",x:y,y:m}}}catch(e){return console.error(" Error generating JWK from MetaMask:",e),null}}async function eF(e){let{hash:t,signature:a}=e,{recoverPublicKey:r}=await n.e(28).then(n.bind(n,52162));return await r({hash:t,signature:{r:a.r,s:a.s,v:a.v}})}function eU(e){let t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substr(n,2),16);return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function eW(e,t,a){try{console.log("\uD83D\uDD0D Verifying JWK signature:",{message:e,signature:t,publicKeyJwk:a,xLength:a.x.length,yLength:a.y.length});let r=e_(a.x),i=e_(a.y);console.log("\uD83D\uDD0D Converted coordinates:",{xHex:r,yHex:i,xHexLength:r.length,yHexLength:i.length,expectedLength:64});let o="0x04".concat(r).concat(i);console.log("\uD83D\uDD0D Expected public key from JWK:",{publicKey:o,length:o.length,expectedLength:131,xHexLength:r.length,yHexLength:i.length,totalHexLength:r.length+i.length});let{recoverPublicKey:s}=await n.e(28).then(n.bind(n,52162)),l=(0,er.w)((0,W.$G)(e)),d=t.slice(2),c="0x".concat(d.slice(0,64)),p="0x".concat(d.slice(64,128)),u=parseInt(d.slice(128,130),16);console.log("\uD83D\uDD0D Signature components:",{r:c,s:p,v:u});let y=await s({hash:l,signature:{r:c,s:p,v:BigInt(u)}});console.log("\uD83D\uDD0D Recovered public key from signature:",{publicKey:y,length:y.length,expectedLength:131});let m=y.toLowerCase()===o.toLowerCase();return console.log(" JWK signature verification result:",m),console.log("\uD83D\uDD0D Detailed Comparison:",{recovered:y.toLowerCase(),expected:o.toLowerCase(),recoveredLength:y.length,expectedLength:o.length,exactMatch:y.toLowerCase()===o.toLowerCase(),recoveredStartsWith:y.startsWith("0x04"),expectedStartsWith:o.startsWith("0x04")}),m||(console.log(" Public keys don't match! Let's debug further..."),console.log("\uD83D\uDD0D Recovered public key format:",{prefix:y.slice(0,4),xCoord:y.slice(4,68),yCoord:y.slice(68,132)}),console.log("\uD83D\uDD0D Expected public key format:",{prefix:o.slice(0,4),xCoord:o.slice(4,68),yCoord:o.slice(68,132)})),m}catch(e){return console.error(" Error verifying JWK signature:",e),!1}}function e_(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";return Array.from(new Uint8Array(atob(t).split("").map(e=>e.charCodeAt(0)))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function eL(e,t){try{var n,a;if(console.log("\uD83D\uDD0D Extracting private key from wallet:",{provider:!!e,address:t,providerKeys:e?Object.keys(e):"no provider",providerType:null==e?void 0:null===(n=e.constructor)||void 0===n?void 0:n.name,hasPrivateKey:!!(null==e?void 0:e.privateKey),hasPrivateKeyProp:!!(null==e?void 0:e.privateKey),providerValues:e?Object.values(e).slice(0,5):"no provider"}),e&&e.privateKey)return console.log(" Found private key in provider.privateKey"),e.privateKey;if(window.web3auth){let e=window.web3auth;if(console.log("\uD83D\uDD0D Checking global web3auth:",{hasProvider:!!e.provider,providerKeys:e.provider?Object.keys(e.provider):"no provider",hasPrivateKey:!!(null===(a=e.provider)||void 0===a?void 0:a.privateKey)}),e.provider&&e.provider.privateKey)return console.log(" Found private key in global web3auth.provider.privateKey"),e.provider.privateKey}if(e&&e._privateKey)return console.log(" Found private key in provider._privateKey"),e._privateKey;for(let t of["_privateKey","privateKey","key","_key","signingKey"])if(e&&e[t])return console.log(" Found private key in provider.".concat(t)),e[t];return console.warn(" No private key found in any of the checked locations"),null}catch(e){return console.error(" Error extracting private key from wallet:",e),null}}async function eB(e,t){try{var n;console.log("\uD83D\uDD0D generateJwkFromConnectedWallet called:",{hasProvider:!!e,address:t,providerType:null==e?void 0:null===(n=e.constructor)||void 0===n?void 0:n.name,isMetaMask:null==e?void 0:e.isMetaMask,providerKeys:e?Object.keys(e):"no provider"});let a=await eL(e,t);if(a){console.log(" Using private key from Web3Auth:",a.slice(0,10)+"...");let e=eM(a);return console.log(" Generated JWK from private key:",e.jwk),e}if(e&&e.request&&"function"==typeof e.request){console.log("\uD83D\uDD0D Provider has request method, attempting signature-based approach");try{let n=await eO(e,t);return console.log(" Generated JWK from signature:",null==n?void 0:n.jwk),n}catch(e){console.warn(" Signature-based approach failed:",e)}}console.log(" No private key or signature method available, using deterministic fallback");let r=eP(t);return console.log(" Generated deterministic JWK:",r.jwk),r}catch(e){return console.error(" Error generating JWK from wallet:",e),null}}var ez=n(77193),eH=n(53540),eG=n(87913),eJ=n(35516),eV=n(32608);function eK(e){let{open:t,onClose:n,agent:o,ensName:c}=e,{provider:u,address:y}=(0,R.m)(),[g,h]=r.useState(!1),[f,b]=r.useState(null),[x,v]=r.useState(null),[E,A]=r.useState(null),[I,Z]=r.useState(""),[F,U]=r.useState(null),[_,L]=r.useState(null),[B,H]=r.useState(null),[G,J]=r.useState(""),[V,K]=r.useState(""),[X,q]=r.useState("");r.useEffect(()=>{o&&t&&(J(o.agentDomain),K(c||""),q("https://".concat(o.agentDomain,"/.well-known/did.json")),b(null),v(null),U(null),H(null),Y())},[o,t,c]),r.useEffect(()=>{o&&t&&u&&y&&!E&&(console.log("\uD83D\uDD04 Provider/EOA became available, regenerating DID document..."),Y())},[u,y,o,t,E]);let Y=async()=>{if(o){h(!1),b(null),v(null);try{let e=eV.env.NEXT_PUBLIC_RPC_URL||"https://rpc.ankr.com/eth_sepolia";(0,k.v)({chain:z.F,transport:(0,M.d)(e)});let t=o.agentAddress.toLowerCase(),n=o.agentDomain,a="did:web:".concat(n),r=[{id:"".concat(a,"#aa-eth"),type:"EcdsaSecp256k1RecoveryMethod2020",controller:a,blockchainAccountId:"eip155:".concat(z.F.id,":").concat(t),ethereumAddress:t,accept:["EIP-1271","EIP-712"]}],i=null;if(console.log("\uD83D\uDD0D JWK Generation Debug:",{provider:!!u,eoa:y,agentAddress:t}),u&&y)try{console.log("\uD83D\uDE80 Attempting to generate JWK from connected wallet..."),i=await eB(u,y),console.log(" JWK generated successfully:",i)}catch(e){console.error(" Could not generate JWK from wallet:",e)}if(!i)try{console.log("\uD83D\uDD04 Generating fallback JWK..."),i=eP(t),console.log(" Fallback JWK generated:",i)}catch(e){console.warn(" Fallback JWK generation failed:",e)}i?(L(i),r.push({id:"".concat(a,"#server-jwk"),type:"JsonWebKey2020",controller:a,publicKeyJwk:i.jwk}),console.log(" Server-jwk verification method added to DID document")):console.warn(" No JWK available for server-jwk verification method");let s=["did:pkh:eip155:".concat(z.F.id,":").concat(t),"https://sepolia.app.ens.domains/"];c&&c.trim()&&s.push("https://sepolia.app.ens.domains/name/".concat(c.trim()));let l=[];l.push({id:"".concat(a,"#did-document"),type:"DIDDocument",serviceEndpoint:"https://".concat(n,"/.well-known/did.json")});let d={"@context":["https://www.w3.org/ns/did/v1","https://w3id.org/security/v2","https://w3id.org/security/suites/secp256k1recovery-2020/v2","https://w3id.org/security/suites/eip712sig-2021/v1"],id:a,alsoKnownAs:s,verificationMethod:r,authentication:r.map(e=>e.id),assertionMethod:["".concat(a,"#aa-eth")],capabilityInvocation:["".concat(a,"#aa-eth")],service:l};A(d),Z(JSON.stringify(d,null,2)),v("DID document generated successfully!")}catch(e){console.error("Error generating DID document:",e),b(e instanceof Error?e.message:"Failed to generate DID document");try{let e=o.agentAddress.toLowerCase(),t={"@context":["https://www.w3.org/ns/did/v1"],id:"did:web:".concat(G.trim()),verificationMethod:[{id:"did:web:".concat(G.trim(),"#aa-eth"),type:"EcdsaSecp256k1RecoveryMethod2020",controller:"did:web:".concat(G.trim()),blockchainAccountId:"eip155:".concat(z.F.id,":").concat(e),ethereumAddress:e,accept:["EIP-1271","EIP-712"]}],authentication:["did:web:".concat(G.trim(),"#aa-eth")],assertionMethod:["did:web:".concat(G.trim(),"#aa-eth")],capabilityInvocation:["did:web:".concat(G.trim(),"#aa-eth")],alsoKnownAs:["did:pkh:eip155:".concat(z.F.id,":").concat(e),"https://sepolia.app.ens.domains/"],service:X?[{id:"did:web:".concat(G.trim(),"#did-document"),type:"DIDDocument",serviceEndpoint:X}]:[]};A(t),Z(JSON.stringify(t,null,2)),v("Generated basic DID document (fallback)")}catch(e){console.error("Fallback DID generation also failed:",e)}}finally{h(!1)}}},$=async()=>{if(!G.trim()){b("Domain is required");return}h(!0),b(null),v(null);try{let e=eV.env.NEXT_PUBLIC_RPC_URL||"https://rpc.ankr.com/eth_sepolia";(0,k.v)({chain:z.F,transport:(0,M.d)(e)});let t=o.agentAddress.toLowerCase(),n="did:web:".concat(G.trim()),a=[{id:"".concat(n,"#aa-eth"),type:"EcdsaSecp256k1RecoveryMethod2020",controller:n,blockchainAccountId:"eip155:".concat(z.F.id,":").concat(t),ethereumAddress:t,accept:["EIP-1271","EIP-712"]}],r=null;if(u&&y)try{(r=await eB(u,y))?(L(r),console.log("Generated JWK from wallet private key")):(console.warn("Could not extract private key, using deterministic approach"),r=eP(y),L(r))}catch(e){console.warn("Could not generate JWK from wallet:",e);try{r=eP(y),L(r)}catch(e){console.error("Fallback JWK generation also failed:",e)}}r&&a.push({id:"".concat(n,"#server-jwk"),type:"JsonWebKey2020",controller:n,publicKeyJwk:r.jwk});let i=["did:pkh:eip155:".concat(z.F.id,":").concat(t),"https://sepolia.app.ens.domains/"];V.trim()&&i.push("https://sepolia.app.ens.domains/name/".concat(V.trim()));let s=[];X.trim()&&s.push({id:"".concat(n,"#did-document"),type:"DIDDocument",serviceEndpoint:X.trim()});let l={"@context":["https://www.w3.org/ns/did/v1","https://w3id.org/security/v2","https://w3id.org/security/suites/secp256k1recovery-2020/v2","https://w3id.org/security/suites/eip712sig-2021/v1"],id:n,alsoKnownAs:i,verificationMethod:a,authentication:a.map(e=>e.id),assertionMethod:["".concat(n,"#aa-eth")],capabilityInvocation:["".concat(n,"#aa-eth")],service:s};A(l),Z(JSON.stringify(l,null,2)),v("DID document generated successfully!")}catch(e){b(e instanceof Error?e.message:"Failed to generate DID document")}finally{h(!1)}},Q=async()=>{if(!E||!u||!y){b("Missing required data for validation");return}h(!0),b(null),U(null);try{let e;let t=eV.env.NEXT_PUBLIC_RPC_URL||"https://rpc.ankr.com/eth_sepolia",n=(0,k.v)({chain:z.F,transport:(0,M.d)(t)});(0,P.K)({chain:z.F,transport:(0,O.P)(u),account:y});let a="DID:Web validation for ".concat(E.id," at ").concat(new Date().toISOString()),r=(0,er.w)((0,W.$G)(a));console.log("\uD83D\uDD0D EIP-1271 Validation Debug:",{testMessage:a,messageHash:r,eoa:y,agentAddress:o.agentAddress,smartAccountAddress:o.agentAddress});let i=await u.request({method:"personal_sign",params:[a,y]});console.log(" EOA signature created:",i),console.log("\uD83D\uDD0D Calling isValidSignature on smart account:",o.agentAddress);try{let e=await n.getBytecode({address:o.agentAddress});if(console.log("\uD83D\uDD0D Smart account code length:",(null==e?void 0:e.length)||0),console.log("\uD83D\uDD0D Smart account is deployed:",((null==e?void 0:e.length)||0)>2),e&&e.length>2){let e=await n.readContract({address:o.agentAddress,abi:[{name:"owner",type:"function",inputs:[],outputs:[{name:"",type:"address"}],stateMutability:"view"}],functionName:"owner"});console.log("\uD83D\uDD0D Smart account owner:",e),console.log("\uD83D\uDD0D EOA matches owner:",e.toLowerCase()===y.toLowerCase())}}catch(e){console.log(" Could not read owner or code (might not be a standard ERC-4337 account):",e)}console.log("\uD83D\uDD0D Using MetaMask delegation toolkit approach for signature validation...");try{if(console.log("\uD83D\uDD0D Attempting EIP-1271 validation with delegation toolkit considerations..."),e=await n.readContract({address:o.agentAddress,abi:[{name:"isValidSignature",type:"function",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}],stateMutability:"view"}],functionName:"isValidSignature",args:[r,i]}),console.log("\uD83D\uDD0D Standard EIP-1271 validation result:",e),"0x1626ba7e"!==e){console.log("\uD83D\uDD0D Standard validation failed, trying EIP-191 prefixed message...");let t="\x19Ethereum Signed Message:\n".concat(a.length).concat(a),r=(0,er.w)((0,W.$G)(t));e=await n.readContract({address:o.agentAddress,abi:[{name:"isValidSignature",type:"function",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}],stateMutability:"view"}],functionName:"isValidSignature",args:[r,i]}),console.log("\uD83D\uDD0D EIP-191 prefixed validation result:",e)}}catch(e){throw console.log(" All validation attempts failed:",e),e}console.log("\uD83D\uDD0D Smart account validation result:",e),console.log("\uD83D\uDD0D Expected magic value: 0x1626ba7e"),console.log("\uD83D\uDD0D Magic value match:","0x1626ba7e"===e),console.log("\uD83D\uDD0D Signature analysis:",{signature:i,signatureLength:i.length,expectedLength:132,messageHash:r,messageHashLength:r.length}),132!==i.length&&console.warn(" Signature length is not 132 characters (0x + 130 hex chars)");let s="0x1626ba7e"===e;U({isValid:s,message:s?"Signature validation successful! The DID document is valid.":"Signature validation failed. The smart account could not verify the signature."})}catch(e){U({isValid:!1,message:"Validation error: ".concat(e instanceof Error?e.message:"Unknown error")})}finally{h(!1)}},ee=async()=>{if(!_||!u||!y){b("Missing required data for JWK verification");return}h(!0),b(null),H(null);try{var e;let t="DID:Web JWK Generation for ".concat(y);console.log("\uD83D\uDD0D Signing test message for JWK verification:",{message:t,eoa:y,messageLength:t.length,timestamp:new Date().toISOString(),provider:!!u,providerType:null==u?void 0:null===(e=u.constructor)||void 0===e?void 0:e.name,providerKeys:u?Object.keys(u):"no provider"});let n=await u.request({method:"personal_sign",params:[t,y]});console.log(" Test message signed:",{signature:n,eoa:y,testMessage:t,signatureLength:n.length}),console.log("\uD83D\uDD0D Verifying signature against JWK public key...");let a=await eW(t,n,_.jwk);console.log(" JWK verification result:",a),H({isValid:a,message:a?"JWK signature verification successful! The JsonWebKey2020 verification method is valid and can verify signatures.":"JWK signature verification failed. The JsonWebKey2020 verification method could not verify the signature."})}catch(e){console.error(" JWK verification error:",e),H({isValid:!1,message:"JWK verification error: ".concat(e instanceof Error?e.message:"Unknown error")})}finally{h(!1)}},et=e=>{navigator.clipboard.writeText(e)};return(0,a.jsxs)(j.Z,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,children:[(0,a.jsxs)(S.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",component:"div",children:"Generate DID:Web Document"}),(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:["Create a DID document for ",null==o?void 0:o.agentDomain]})]}),(0,a.jsx)(C.Z,{sx:{height:"80vh",display:"flex",flexDirection:"column",p:0},children:(0,a.jsxs)(d.Z,{sx:{display:"flex",gap:3,flex:1,overflow:"hidden"},children:[(0,a.jsxs)(d.Z,{sx:{flex:1,display:"flex",flexDirection:"column",gap:3,overflow:"auto",p:3,borderRight:"1px solid",borderColor:"divider"},children:[(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",gutterBottom:!0,children:"Configuration"}),(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsx)(p.Z,{fullWidth:!0,label:"Domain",value:G,onChange:e=>J(e.target.value),placeholder:"example.com",helperText:"The domain for the DID:Web identifier"}),(0,a.jsx)(p.Z,{fullWidth:!0,label:"ENS Name (optional)",value:V,onChange:e=>K(e.target.value),placeholder:"example.eth",helperText:"ENS name to include in alsoKnownAs"}),(0,a.jsx)(p.Z,{fullWidth:!0,label:"DID Document URL (optional)",value:X,onChange:e=>q(e.target.value),placeholder:"https://example.com/.well-known/did.json",helperText:"URL to the DID document service"})]})]}),(0,a.jsx)(N.Z,{}),(0,a.jsx)(d.Z,{children:(0,a.jsx)(l.Z,{variant:"outlined",onClick:$,disabled:g||!G.trim(),startIcon:g?(0,a.jsx)(eR.Z,{size:20}):null,children:"Regenerate DID Document"})}),f&&(0,a.jsx)(ek.Z,{severity:"error",icon:(0,a.jsx)(eG.Z,{}),children:f}),x&&(0,a.jsx)(ek.Z,{severity:"success",icon:(0,a.jsx)(eH.Z,{}),children:x}),F&&(0,a.jsx)(ek.Z,{severity:F.isValid?"success":"error",icon:F.isValid?(0,a.jsx)(eH.Z,{}):(0,a.jsx)(eG.Z,{}),children:F.message}),B&&(0,a.jsx)(ek.Z,{severity:B.isValid?"success":"error",icon:B.isValid?(0,a.jsx)(eH.Z,{}):(0,a.jsx)(eG.Z,{}),children:B.message})]}),(0,a.jsxs)(d.Z,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",p:3},children:[(0,a.jsx)(m.Z,{variant:"h6",gutterBottom:!0,children:"Generated DID Document"}),I?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,a.jsx)(s.Z,{label:"DID: ".concat(null==E?void 0:E.id),color:"primary",variant:"outlined"}),(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(w.Z,{title:"Copy to clipboard",children:(0,a.jsx)(T.Z,{onClick:()=>et(I),children:(0,a.jsx)(ez.Z,{})})}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>{let e=new Blob([I],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="did.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},sx:{ml:1},children:"Download"})]})]}),(0,a.jsx)(d.Z,{sx:{height:"400px",overflow:"auto",border:"1px solid",borderColor:"divider",borderRadius:1,p:1,display:"flex",flexDirection:"column"},children:(0,a.jsx)("pre",{style:{fontFamily:"monospace",fontSize:"0.75rem",margin:0,padding:0,whiteSpace:"pre-wrap",wordBreak:"break-word",flex:1,minHeight:"350px"},children:I})}),(0,a.jsxs)(d.Z,{sx:{mt:2,display:"flex",flexDirection:"column",gap:1},children:[(0,a.jsx)(m.Z,{variant:"subtitle2",gutterBottom:!0,children:"Verification Methods"}),(0,a.jsxs)(d.Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,a.jsx)(l.Z,{variant:"outlined",onClick:Q,disabled:g||!u||!y,startIcon:g?(0,a.jsx)(eR.Z,{size:16}):null,size:"small",children:"EIP-1271 (Smart Account)"}),_&&(0,a.jsx)(l.Z,{variant:"outlined",onClick:ee,disabled:g||!u||!y,startIcon:(0,a.jsx)(eJ.Z,{}),size:"small",children:"JWK Signature"})]})]})]}):(0,a.jsx)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,border:"1px dashed",borderColor:"divider",borderRadius:1,minHeight:"400px"},children:(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:g?"Generating DID document...":"Configure settings to generate DID document"})})]})]})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:n,children:"Close"})})]})}let eX=e=>{let{open:t,onClose:n,agent:i,ensName:o}=e,{provider:u,address:y}=(0,R.m)(),[g,h]=(0,r.useState)(null),[f,b]=(0,r.useState)(""),[x,v]=(0,r.useState)(""),[E,I]=(0,r.useState)(""),[P,O]=(0,r.useState)(null),[F,U]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&i&&u&&y&&_()},[t,i,u,y,o]),(0,r.useEffect)(()=>{if((null==i?void 0:i.agentDNSDomain)&&(null==i?void 0:i.agentENSDomain)){console.log("\uD83D\uDD0D Setting service endpoints from agent data:",{agentENSDomain:i.agentENSDomain,agentDNSDomain:i.agentDNSDomain});let e="https://".concat(i.agentDNSDomain,"/.well-known/agent-card.json");v(e),I(e);let t="wss://".concat(i.agentDNSDomain,"/.well-known/mcp");b(t),console.log(" Service endpoints set:",{a2a:e,mcp:t,ens:o||"none"})}},[i,o]);let _=async()=>{if(console.log("\uD83D\uDD0D generateDidDocumentAuto called with:",{agent:!!i,provider:!!u,eoa:!!y}),!i||!u||!y){console.log("\uD83D\uDD0D Missing required props, returning early");return}console.log("\uD83D\uDD0D Setting isGenerating to true"),U(!0);try{console.log("\uD83D\uDD0D Auto-generating DID:Agent document..."),console.log(" Using account abstraction address for verification:",i.agentAddress);let e=[{id:"did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth"),type:"EcdsaSecp256k1RecoveryMethod2020",controller:"did:agent:eip155:11155111:".concat(i.agentId),blockchainAccountId:"eip155:11155111:".concat(i.agentAddress),ethereumAddress:i.agentAddress,accept:["EIP-1271","EIP-712"],erc8004:{agentId:i.agentId,registry:"0x8004a6090Cd10A7288092483047B097295Fb8847",chainId:11155111}}],t=["https://".concat(i.agentDNSDomain),...o?["ens:".concat(o)]:[]],n={"@context":["https://www.w3.org/ns/did/v1","https://w3id.org/security/multikey/v1"],id:"did:agent:eip155:11155111:".concat(i.agentId),alsoKnownAs:t,verificationMethod:e,authentication:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],assertionMethod:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],capabilityInvocation:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],capabilityDelegation:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],service:[{id:"#mcp-ws",type:"MCP",serviceEndpoint:{uri:f||"wss://".concat(i.agentDNSDomain,"/.well-known/mcp"),protocol:"model-context-protocol",version:"0.1",transport:"websocket",accept:["application/json"],auth:["did-jws","eip-1271"]}},...o?[{id:"#ens",type:"ENSService",serviceEndpoint:{name:o,network:"eip155:1",records:{addr:i.agentAddress,contenthash:"ipfs://bafy.../".concat(i.agentDNSDomain,"/agent-card.json"),url:"https://".concat(i.agentDNSDomain),"org.did":"did:agent:eip155:11155111:".concat(i.agentId)},auth:["eip-1271","eip-712"]}}]:[],{id:"#linked-domains",type:"LinkedDomains",serviceEndpoint:{origins:["https://".concat(i.agentDNSDomain)]}},{id:"#agent-card",type:"AgentCard",serviceEndpoint:x||"https://".concat(i.agentDNSDomain,"/.well-known/agent-card.json")},{id:"#agent-interface",type:"AgentInterface",serviceEndpoint:"https://".concat(i.agentDNSDomain,"/.well-known/a2a")},{id:"#reputation",type:"ReputationRegistry",serviceEndpoint:{chainId:11155111,contract:"0xREPUT4TI0NADDRE55",methods:["acceptFeedback"]}}],agent:{standard:"ERC-8004",domain:i.agentENSDomain,address:i.agentAddress}};h(n),console.log(" Generated DID:Agent document:",n),console.log(" Setting isGenerating to false")}catch(e){console.error(" Error generating DID:Agent document:",e),h({"@context":["https://www.w3.org/ns/did/v1","https://w3id.org/security/multikey/v1"],id:"did:agent:eip155:11155111:".concat(i.agentId),alsoKnownAs:["https://".concat(i.agentDNSDomain),...o?["ens:".concat(o)]:[]],verificationMethod:[{id:"did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth"),type:"EcdsaSecp256k1RecoveryMethod2020",controller:"did:agent:eip155:11155111:".concat(i.agentId),blockchainAccountId:"eip155:11155111:".concat(i.agentAddress),ethereumAddress:i.agentAddress,accept:["EIP-1271","EIP-712"],erc8004:{agentId:i.agentId,registry:"0x8004a6090Cd10A7288092483047B097295Fb8847",chainId:11155111}}],authentication:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],assertionMethod:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],capabilityInvocation:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],capabilityDelegation:["did:agent:eip155:11155111:".concat(i.agentId,"#aa-eth")],service:[{id:"#agent-card",type:"AgentCard",serviceEndpoint:x||"https://".concat(i.agentDNSDomain,"/.well-known/agent-card.json")}],agent:{standard:"ERC-8004",domain:i.agentENSDomain,address:i.agentAddress}})}finally{console.log("\uD83D\uDD0D Finally block: setting isGenerating to false"),U(!1)}},L=async()=>{if(i&&u&&y){U(!0);try{await _()}finally{U(!1)}}},B=e=>{navigator.clipboard.writeText(e)},H=async()=>{if(u&&y&&i)try{let e;console.log("\uD83D\uDD0D Starting EIP-1271 signature validation for DID:Agent...");let t="DID:Agent Validation for ".concat(i.agentId),n=(0,er.w)((0,W.$G)(t));console.log("\uD83D\uDD0D Test message:",t),console.log("\uD83D\uDD0D Message hash:",n),console.log("\uD83D\uDD0D EOA address:",y),console.log("\uD83D\uDD0D Agent address:",i.agentAddress);let a=await u.request({method:"personal_sign",params:[t,y]});console.log("\uD83D\uDD0D Signature:",a),console.log("\uD83D\uDD0D Signature length:",a.length);let r=(0,k.v)({chain:z.F,transport:(0,M.d)()});try{let e=await r.getBytecode({address:i.agentAddress});if(console.log("\uD83D\uDD0D Smart account code length:",(null==e?void 0:e.length)||0),e&&e.length>2){console.log(" Smart account is deployed");try{let e=await r.readContract({address:i.agentAddress,abi:[{name:"owner",type:"function",inputs:[],outputs:[{name:"",type:"address"}],stateMutability:"view"}],functionName:"owner"});console.log("\uD83D\uDD0D Smart account owner:",e),console.log("\uD83D\uDD0D EOA matches owner:",e.toLowerCase()===y.toLowerCase())}catch(e){console.log(" Could not read owner (might not be standard ERC-4337):",e)}}else console.log(" Smart account is not deployed yet")}catch(e){console.log(" Could not read code or owner:",e)}console.log("\uD83D\uDD0D Using MetaMask delegation toolkit approach for signature validation...");try{if(e=await r.readContract({address:i.agentAddress,abi:[{name:"isValidSignature",type:"function",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}],stateMutability:"view"}],functionName:"isValidSignature",args:[n,a]}),console.log("\uD83D\uDD0D Standard EIP-1271 validation result:",e),"0x1626ba7e"!==e){console.log("\uD83D\uDD0D Standard validation failed, trying EIP-191 prefixed message...");let n="\x19Ethereum Signed Message:\n".concat(t.length).concat(t),o=(0,er.w)((0,W.$G)(n));e=await r.readContract({address:i.agentAddress,abi:[{name:"isValidSignature",type:"function",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}],stateMutability:"view"}],functionName:"isValidSignature",args:[o,a]}),console.log("\uD83D\uDD0D EIP-191 prefixed validation result:",e)}}catch(e){throw console.log(" All validation attempts failed:",e),e}console.log("\uD83D\uDD0D Smart account validation result:",e),console.log("\uD83D\uDD0D Expected magic value: 0x1626ba7e"),console.log("\uD83D\uDD0D Magic value match:","0x1626ba7e"===e),"0x1626ba7e"===e?(O("success"),console.log(" EIP-1271 signature validation successful!")):(O("failure"),console.log(" EIP-1271 signature validation failed. Result:",e))}catch(e){console.error(" Error validating EIP-1271 signature:",e),O("error")}};return(0,a.jsxs)(j.Z,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh"}},children:[(0,a.jsx)(S.Z,{children:(0,a.jsxs)(d.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(m.Z,{variant:"h6",children:"DID:Agent Document Generator"}),(0,a.jsxs)(d.Z,{display:"flex",gap:1,children:[(0,a.jsx)(s.Z,{label:"Account Abstraction",color:"primary",size:"small",icon:(0,a.jsx)(eH.Z,{})}),(0,a.jsx)(l.Z,{variant:"outlined",size:"small",onClick:L,disabled:F,children:F?"Generating...":"Regenerate DID Document"})]})]})}),(0,a.jsx)(C.Z,{sx:{height:"80vh",overflow:"hidden"},children:(0,a.jsxs)(d.Z,{display:"flex",height:"100%",gap:2,children:[(0,a.jsxs)(d.Z,{flex:1,overflow:"auto",p:3,children:[(0,a.jsx)(m.Z,{variant:"h6",gutterBottom:!0,children:"DID:Agent Configuration"}),(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,label:"MCP Service Endpoint",value:f,onChange:e=>b(e.target.value),placeholder:"wss://".concat((null==i?void 0:i.agentDNSDomain)||"example.com","/.well-known/mcp"),helperText:"WebSocket endpoint for MCP (Model Context Protocol) service - derived from agent domain"})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,label:"Agent Card Endpoint",value:x,onChange:e=>v(e.target.value),placeholder:"https://".concat((null==i?void 0:i.agentDNSDomain)||"example.com","/.well-known/agent-card.json"),helperText:"HTTP endpoint for Agent Card service - derived from agent domain"})})]}),(0,a.jsx)(N.Z,{sx:{my:3}}),(0,a.jsx)(m.Z,{variant:"h6",gutterBottom:!0,children:"Agent Information"}),(0,a.jsx)(A.Z,{variant:"outlined",children:(0,a.jsxs)(Z.Z,{children:[(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:[(0,a.jsx)("strong",{children:"Agent ID:"})," ",i.agentId]}),(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:[(0,a.jsx)("strong",{children:"Agent Address:"})," ",i.agentAddress]}),(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:[(0,a.jsx)("strong",{children:"Agent ENSDomain:"})," ",i.agentENSDomain]}),(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:[(0,a.jsx)("strong",{children:"Agent DNSDomain:"})," ",i.agentDNSDomain]}),o&&(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:[(0,a.jsx)("strong",{children:"ENS Name:"})," ",o]})]})})]}),(0,a.jsxs)(d.Z,{flex:1,overflow:"auto",p:3,children:[(0,a.jsxs)(d.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,a.jsx)(m.Z,{variant:"h6",children:"Generated DID:Agent Document"}),g&&(0,a.jsx)(w.Z,{title:"Copy to clipboard",children:(0,a.jsx)(T.Z,{onClick:()=>B(JSON.stringify(g,null,2)),children:(0,a.jsx)(ez.Z,{})})})]}),(0,a.jsx)(d.Z,{sx:{height:"400px",overflow:"auto",border:"1px solid #ddd",borderRadius:1,p:2,backgroundColor:"#f5f5f5"},children:(0,a.jsx)("pre",{style:{margin:0,fontSize:"12px",lineHeight:"1.4",minHeight:"350px"},children:g?JSON.stringify(g,null,2):"Generating DID:Agent document..."})}),(0,a.jsx)(d.Z,{mt:2,display:"flex",gap:2,children:(0,a.jsx)(l.Z,{variant:"contained",color:"primary",onClick:H,disabled:!u||!y,startIcon:"success"===P?(0,a.jsx)(eH.Z,{}):"failure"===P?(0,a.jsx)(eG.Z,{}):void 0,children:"EIP-1271 (Smart Account)"})}),P&&(0,a.jsxs)(ek.Z,{severity:"success"===P?"success":"failure"===P?"error":"warning",sx:{mt:2},children:["success"===P&&"EIP-1271 signature validation successful!","failure"===P&&"EIP-1271 signature validation failed. Check console for details.","error"===P&&"Error during EIP-1271 validation. Check console for details."]})]})]})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:n,children:"Close"})})]})};async function eq(e,t,n){let{nodes:a,edges:r}=e,i=await fetch("/api/graph-layout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nodes:a.map(e=>({id:e.id,label:e.label})),edges:r.map(e=>({from:e.from,to:e.to,weight:e.weight})),width:t,height:n})});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Layout generation failed")}let o=(await i.json()).layout||[];return a.forEach(e=>{let a=o.find(t=>t.id===e.id);a?(e.x=a.x,e.y=a.y):(e.x=Math.random()*(t-60)+30,e.y=Math.random()*(n-60)+30)}),{nodes:a,edges:r}}function eY(e){let{open:t,onClose:n,agentId:s,agentName:c}=e,[p,u]=r.useState(null),[y,g]=r.useState(!1),[h,f]=r.useState(null),[b,x]=r.useState(null),[v,w]=r.useState(!1);r.useEffect(()=>{if(!t||!s){u(null),f(null),x(null);return}!async function(){g(!0),f(null);try{let e=await fetch("/api/agents/".concat(s));if(!e.ok)throw Error("Failed to fetch agent data");let t=await e.json();u(t.description||null)}catch(e){f((null==e?void 0:e.message)||"Failed to load agent data")}finally{g(!1)}}()},[t,s]);let[T,E]=r.useState(null);return r.useEffect(()=>{if(!p){x(null),E(null);return}(async function(){console.log("TrustGraphModal - Raw description:",p);let e=function(e){if(!e)return null;let t=[],n=[],a=new Set;try{let r,i=e.replace(/\/\*[\s\S]*?\*\//g,"");i=i.replace(/[\u00A0\u1680\u2000-\u200B\u202F\u205F\u3000\uFEFF]/g," ").replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim(),console.log("Attempting to parse cleaned JSON..."),console.log("First 200 chars:",i.substring(0,200)),console.log("Description length:",i.length),console.log("Description type:",typeof i);try{r=JSON.parse(i),console.log("Successfully parsed JSON:",r),console.log("Parsed type:",typeof r),console.log("Has nodes?",Array.isArray(null==r?void 0:r.nodes)),console.log("Has trust_atoms?",Array.isArray(null==r?void 0:r.trust_atoms))}catch(t){console.error("JSON.parse error:",t),console.error("Error message:",t.message);let e=t.message.match(/position (\d+)/);if(e){let t=parseInt(e[1]);console.error("Context around error position:",{before:i.substring(Math.max(0,t-50),t),at:i.substring(t,t+1),after:i.substring(t+1,Math.min(i.length,t+51)),charCode:i.charCodeAt(t)})}throw t}if("string"==typeof r)try{r=JSON.parse(r)}catch(e){}if(r){Array.isArray(r.nodes)&&r.nodes.forEach(e=>{let n=e.id||e.name||String(e),r=e.label||e.name||n,i=e.type;"Person"===i||n.startsWith("person.")||(a.add(n),t.push({id:n,label:r,type:i}))});let e=r.edges||r.relationships||r.links||r.trust_atoms,i=[],o=null;if(Array.isArray(e)&&(e.forEach(e=>{var t,r,s;let l=e.from||e.source||e.start||e.subj,d=e.to||e.target||e.end||e.obj,c=e.pred||e.predicate||e.type,p=e.weight||e.score||e.trust||(null===(t=e.attrs)||void 0===t?void 0:t.score)||(null===(r=e.attrs)||void 0===r?void 0:r.match_score);if("gave_feedback_to"===c||l&&l.startsWith("person.")&&d){"number"==typeof p&&(i.push({score:p,comment:null===(s=e.attrs)||void 0===s?void 0:s.comment}),o=String(d));return}!(l&&l.startsWith("person."))&&l&&d&&(a.add(l),a.add(d),n.push({from:String(l),to:String(d),weight:"number"==typeof p?p:void 0,label:void 0!==p?String(p):void 0}))}),i.length>0&&o)){let e=i.reduce((e,t)=>e+t.score,0)/i.length;console.log("Aggregating ".concat(i.length," feedback items with avg score ").concat(e.toFixed(2)))}if(console.log("JSON parsing result: ".concat(t.length," nodes, ").concat(n.length," edges")),console.log("Nodes:",t.map(e=>e.id)),console.log("Edges:",n.map(e=>"".concat(e.from," -> ").concat(e.to))),n.length>0&&0===t.length&&(console.log("Creating nodes from edges"),a.forEach(e=>{t.push({id:e,label:e})})),t.length>0&&n.length>0)return console.log("Returning parsed graph structure with ".concat(t.length," nodes and ").concat(n.length," edges")),{nodes:t,edges:n};if(t.length>0)return console.log("Returning graph with ".concat(t.length," nodes but no edges")),{nodes:t,edges:[]};console.log("No valid graph structure found in JSON")}}catch(e){console.error("JSON parsing failed:",e)}let r=e.match(/(?:trust\s+graph|relationships?):\s*([^\n]+(?:\n(?!\n)[^\n]+)*)/i);if(r){let e=r[1];[/([a-zA-Z0-9_-]+)\s*->\s*([a-zA-Z0-9_-]+)(?:\s*\(([0-9.]+)\))?/g,/([a-zA-Z0-9_-]+)\s+trusts\s+([a-zA-Z0-9_-]+)(?::\s*([0-9.]+))?/gi,/([a-zA-Z0-9_-]+)\s*\s*([a-zA-Z0-9_-]+)(?:\s*\(([0-9.]+)\))?/g].forEach(t=>{let r;for(;null!==(r=t.exec(e));){let e=r[1].trim(),t=r[2].trim(),i=r[3]?parseFloat(r[3]):void 0;a.add(e),a.add(t),n.push({from:e,to:t,weight:i,label:i?"".concat(i):void 0})}})}let i=e.match(/(?:nodes?|agents?):\s*([^\n]+)/i);return(i&&i[1].split(/[,;]/).map(e=>e.trim()).filter(Boolean).forEach(e=>a.add(e)),a.forEach(e=>{t.find(t=>t.id===e)||t.push({id:e,label:e})}),0===t.length||0===n.length)?null:{nodes:t,edges:n}}(p);if(console.log("TrustGraphModal - Parsed graph data:",e),!e){x(null),E(null);return}try{if(p){let e=p.replace(/\/\*[\s\S]*?\*\//g,"").replace(/[\u00A0\u1680\u2000-\u200B\u202F\u205F\u3000\uFEFF]/g," ").trim(),t=JSON.parse(e),n=((null==t?void 0:t.trust_atoms)||[]).filter(e=>{var t;return"gave_feedback_to"===e.pred&&(null===(t=e.attrs)||void 0===t?void 0:t.score)!==void 0});if(n.length>0){let e=n.reduce((e,t)=>e+(t.attrs.score||0),0)/n.length;E({count:n.length,avgScore:e})}else E(null)}else E(null)}catch(e){E(null)}w(!0);try{console.log("Attempting AI-enhanced layout...");let t=await eq(e,1400,700);console.log(" AI layout successful!"),x(t)}catch(n){console.warn(" AI layout failed, using fallback:",n);let t=function(e,t,n){let{nodes:a,edges:r}=e,i=a.find(e=>e.id&&(e.id.startsWith("agent.")||"Agent"===e.type));i&&(i.x=700,i.y=80);let o=a.filter(e=>e.id!==(null==i?void 0:i.id)),s=Math.min(6,Math.ceil(Math.sqrt(1.5*o.length))),l=Math.ceil(o.length/s),d=1300/(s+1),c=400/(l+1);o.forEach((e,t)=>{e.x=50+(t%s+1)*d,e.y=250+(Math.floor(t/s)+1)*c});for(let e=0;e<80;e++){for(let e=0;e<o.length;e++)for(let t=e+1;t<o.length;t++){let n=o[t].x-o[e].x,a=o[t].y-o[e].y,r=Math.sqrt(n*n+a*a)||1,i=4e3/(r*r),s=n/r*i,l=a/r*i;o[e].x-=s,o[e].y-=l,o[t].x+=s,o[t].y+=l}r.forEach(e=>{let t=a.find(t=>t.id===e.from),n=a.find(t=>t.id===e.to);if(t&&n&&t.id!==(null==i?void 0:i.id)&&n.id!==(null==i?void 0:i.id)){let e=n.x-t.x,a=n.y-t.y,r=Math.sqrt(e*e+a*a)||1,i=(r-120)*.08,o=e/r*i,s=a/r*i;t.x+=o,t.y+=s,n.x-=o,n.y-=s}})}return a.forEach(e=>{e.id===(null==i?void 0:i.id)?(e.x=700,e.y=80):(e.x=Math.max(50,Math.min(1350,e.x)),e.y=Math.max(50,Math.min(650,e.y)))}),{nodes:a,edges:r}}(e,1400,0);console.log("Using fallback force-directed layout"),x(t)}finally{w(!1)}})()},[p]),(0,a.jsxs)(j.Z,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,children:[(0,a.jsxs)(S.Z,{children:["Trust Graph  ",c]}),(0,a.jsx)(C.Z,{children:y?(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading agent data..."}):v?(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Generating AI-optimized graph layout..."}):h?(0,a.jsx)(m.Z,{variant:"body2",color:"error",children:h}):b?(0,a.jsxs)(a.Fragment,{children:[T&&(0,a.jsx)(o.Z,{variant:"outlined",sx:{p:2.5,mb:2,bgcolor:"#fff3e0",borderColor:"#ff9800",borderWidth:2},children:(0,a.jsxs)(i.Z,{direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[(0,a.jsxs)(d.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(m.Z,{variant:"h3",sx:{fontWeight:700,color:"#f57c00",mb:.5},children:T.avgScore.toFixed(2)}),(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:1},children:"Average Score"})]}),(0,a.jsxs)(d.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(m.Z,{variant:"h4",sx:{fontWeight:600,color:"#333"},children:T.count}),(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:1},children:"Client Reviews"})]})]})}),(0,a.jsxs)(o.Z,{variant:"outlined",sx:{p:2},children:[(0,a.jsx)(d.Z,{sx:{width:"100%",border:"1px solid #e0e0e0",borderRadius:1},children:(0,a.jsxs)("svg",{width:"100%",height:"700",viewBox:"0 0 1400 700",style:{display:"block"},children:[(0,a.jsx)("defs",{children:(0,a.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:(0,a.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#666"})})}),b.edges.map((e,t)=>{var n,r;let i=b.nodes.find(t=>t.id===e.from),o=b.nodes.find(t=>t.id===e.to);if(!i||!o)return null;let s=o.x-i.x,l=o.y-i.y,d=Math.sqrt(s*s+l*l),c="Agent"===i.type||(null===(n=i.id)||void 0===n?void 0:n.startsWith("agent.")),p="Agent"===o.type||(null===(r=o.id)||void 0===r?void 0:r.startsWith("agent.")),u=c?18:12,y=p?18:12,m=(i.x+o.x)/2,g=(i.y+o.y)/2,h=c||p;return(0,a.jsxs)("g",{children:[(0,a.jsx)("line",{x1:i.x+s/d*u,y1:i.y+l/d*u,x2:o.x-s/d*y,y2:o.y-l/d*y,stroke:h?"#1976d2":"#999",strokeWidth:h?"2.5":"1.5",markerEnd:"url(#arrowhead)",opacity:h?.8:.4}),e.label&&(0,a.jsx)("text",{x:m,y:g-5,fontSize:"9",fill:h?"#1976d2":"#666",textAnchor:"middle",fontWeight:"600",children:e.label})]},t)}),b.nodes.map((e,t)=>{var n;let r="Agent"===e.type||(null===(n=e.id)||void 0===n?void 0:n.startsWith("agent.")),i=r?18:12,o=r?10:8;return(0,a.jsxs)("g",{children:[(0,a.jsx)("circle",{cx:e.x,cy:e.y,r:i,fill:r?"#1976d2":"#90caf9",stroke:"#fff",strokeWidth:r?"3":"2",opacity:r?1:.85}),(0,a.jsx)("text",{x:e.x,y:e.y+i+14,fontSize:o,fill:"#333",textAnchor:"middle",fontWeight:r?"700":"500",children:e.label.split("\n").map((t,n)=>(0,a.jsx)("tspan",{x:e.x,dy:0===n?0:o+2,children:t},n))})]},t)})]})}),(0,a.jsx)(d.Z,{sx:{mt:2},children:(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",children:"Graph shows trust relationships from agent description. Agent node (dark blue) is at the top. Arrows indicate relationship direction, labels show scores. Scroll to explore the full graph."})})]})]}):(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No trust graph data found in agent description."}),(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:'Expected JSON format with "nodes" and "edges" arrays, or text format like "A -> B (0.9)"'}),p&&(0,a.jsxs)(d.Z,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1,maxHeight:"400px",overflow:"auto"},children:[(0,a.jsx)(m.Z,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Raw Description Data:"}),(0,a.jsx)(m.Z,{component:"pre",variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"0.7rem"},children:p})]})]})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:n,children:"Close"})})]})}var e$=n(32608);async function eQ(e){let{registry:t,agentName:n}=e,a=e.rpcUrl||e$.env.NEXT_PUBLIC_RPC_URL||"https://rpc.ankr.com/eth_sepolia",r=z.F,i=(0,k.v)({chain:r,transport:(0,M.d)(a)}),o={};if(e.a2aUrl&&/^https?:\/\//i.test(e.a2aUrl))try{let t=await fetch(e.a2aUrl);if(t.ok){let e=await t.json();e&&"object"==typeof e&&!Array.isArray(e)&&(o={...e})}}catch(e){}let s=await $({publicClient:i,registry:t,agentName:n});if(s){var l;let t="eip155:".concat(null!==(l=e.chainId)&&void 0!==l?l:11155111,":").concat(s.agentAddress),a={agentId:Number(s.agentId),agentAddress:t};if(e.signMessage)try{let t=await e.signMessage(n);a.signature=t}catch(e){}let r=Array.isArray(o.registrations)?[...o.registrations]:[],i=r.findIndex(e=>Number(null==e?void 0:e.agentId)===Number(a.agentId));i>=0?r[i]={...r[i],...a}:r.push(a),o.registrations=r}if(e.trustModels&&e.trustModels.length){if(Array.isArray(o.trustModels)){let t=new Set([...o.trustModels,...e.trustModels]);o.trustModels=Array.from(t)}else o.trustModels=e.trustModels}return o}var e0=n(598),e2=n(20719),e1=n(54269),e5=n(48140),e6=JSON.parse('[{"inputs":[{"internalType":"address","name":"_identityRegistry","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"ECDSAInvalidSignature","type":"error"},{"inputs":[{"internalType":"uint256","name":"length","type":"uint256"}],"name":"ECDSAInvalidSignatureLength","type":"error"},{"inputs":[{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"ECDSAInvalidSignatureS","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"agentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"clientAddress","type":"address"},{"indexed":true,"internalType":"uint64","name":"feedbackIndex","type":"uint64"}],"name":"FeedbackRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"agentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"clientAddress","type":"address"},{"indexed":false,"internalType":"uint8","name":"score","type":"uint8"},{"indexed":true,"internalType":"bytes32","name":"tag1","type":"bytes32"},{"indexed":false,"internalType":"bytes32","name":"tag2","type":"bytes32"},{"indexed":false,"internalType":"string","name":"feedbackUri","type":"string"},{"indexed":false,"internalType":"bytes32","name":"feedbackHash","type":"bytes32"}],"name":"NewFeedback","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"agentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"clientAddress","type":"address"},{"indexed":false,"internalType":"uint64","name":"feedbackIndex","type":"uint64"},{"indexed":true,"internalType":"address","name":"responder","type":"address"},{"indexed":false,"internalType":"string","name":"responseUri","type":"string"},{"indexed":false,"internalType":"bytes32","name":"responseHash","type":"bytes32"}],"name":"ResponseAppended","type":"event"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"address","name":"clientAddress","type":"address"},{"internalType":"uint64","name":"feedbackIndex","type":"uint64"},{"internalType":"string","name":"responseUri","type":"string"},{"internalType":"bytes32","name":"responseHash","type":"bytes32"}],"name":"appendResponse","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"}],"name":"getClients","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getIdentityRegistry","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"address","name":"clientAddress","type":"address"}],"name":"getLastIndex","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"address","name":"clientAddress","type":"address"},{"internalType":"uint64","name":"feedbackIndex","type":"uint64"},{"internalType":"address[]","name":"responders","type":"address[]"}],"name":"getResponseCount","outputs":[{"internalType":"uint64","name":"count","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"address[]","name":"clientAddresses","type":"address[]"},{"internalType":"bytes32","name":"tag1","type":"bytes32"},{"internalType":"bytes32","name":"tag2","type":"bytes32"}],"name":"getSummary","outputs":[{"internalType":"uint64","name":"count","type":"uint64"},{"internalType":"uint8","name":"averageScore","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"uint8","name":"score","type":"uint8"},{"internalType":"bytes32","name":"tag1","type":"bytes32"},{"internalType":"bytes32","name":"tag2","type":"bytes32"},{"internalType":"string","name":"feedbackUri","type":"string"},{"internalType":"bytes32","name":"feedbackHash","type":"bytes32"},{"internalType":"bytes","name":"feedbackAuth","type":"bytes"}],"name":"giveFeedback","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"address[]","name":"clientAddresses","type":"address[]"},{"internalType":"bytes32","name":"tag1","type":"bytes32"},{"internalType":"bytes32","name":"tag2","type":"bytes32"},{"internalType":"bool","name":"includeRevoked","type":"bool"}],"name":"readAllFeedback","outputs":[{"internalType":"address[]","name":"clients","type":"address[]"},{"internalType":"uint8[]","name":"scores","type":"uint8[]"},{"internalType":"bytes32[]","name":"tag1s","type":"bytes32[]"},{"internalType":"bytes32[]","name":"tag2s","type":"bytes32[]"},{"internalType":"bool[]","name":"revokedStatuses","type":"bool[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"address","name":"clientAddress","type":"address"},{"internalType":"uint64","name":"index","type":"uint64"}],"name":"readFeedback","outputs":[{"internalType":"uint8","name":"score","type":"uint8"},{"internalType":"bytes32","name":"tag1","type":"bytes32"},{"internalType":"bytes32","name":"tag2","type":"bytes32"},{"internalType":"bool","name":"isRevoked","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"agentId","type":"uint256"},{"internalType":"uint64","name":"feedbackIndex","type":"uint64"}],"name":"revokeFeedback","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),e3=n(80368).lW,e7=n(32608);function e8(e){var t,K,X,q,$,Q,ee,et,en,er,ei,eo,es,el,ed,ec,ep,eu,ey,em,eg,eh,ef,eb;let{chainIdHex:ex}=e,[ew,eT]=r.useState(""),[ej,eD]=r.useState(""),[eR,ek]=r.useState(""),[eM,eP]=r.useState(!1),[eO,eF]=r.useState({rows:[],total:0,page:1,pageSize:50}),[eU,eW]=r.useState(!1),[e_,eL]=r.useState({}),{provider:eB,address:eH}=(0,R.m)(),[eG,eJ]=r.useState(""),[eV,eq]=r.useState(!1),[e$,e8]=r.useState(null),[e4,e9]=r.useState(null),[te,tt]=r.useState({}),[tn,ta]=r.useState(!1),[tr,ti]=r.useState(!1),[to,ts]=r.useState(null),[tl,td]=r.useState(null),[tc,tp]=r.useState(""),[tu,ty]=r.useState(null),[tm,tg]=r.useState([]),[th,tf]=r.useState(null),[tb,tx]=r.useState(!1),[tv,tw]=r.useState(null),[tT,tj]=r.useState(null),[tS,tC]=r.useState({}),[tD,tE]=r.useState({}),[tA,tI]=r.useState(!1),[tZ,tN]=r.useState(!1),[tR,tk]=r.useState(null),[tM,tP]=r.useState(null),[tO,tF]=r.useState(!1),[tU,tW]=r.useState(!1),[t_,tL]=r.useState(null),[tB,tz]=r.useState(null),[tH,tG]=r.useState(!1),[tJ,tV]=r.useState(null),[tK,tX]=r.useState(null),[tq,tY]=r.useState(null),[t$,tQ]=r.useState(null),[t0,t2]=r.useState(!1),[t1,t5]=r.useState({}),[t6,t3]=r.useState(!1),[t7,t8]=r.useState(null),[t4,t9]=r.useState(!1),[ne,nt]=r.useState(!1),[nn,na]=r.useState([]),[nr,ni]=r.useState(!1),[no,ns]=r.useState(null),[nl,nd]=r.useState(!1),[nc,np]=r.useState([]),[nu,ny]=r.useState(!1),[nm,ng]=r.useState(null),[nh,nf]=r.useState(null),[nb,nx]=r.useState({}),[nv,nw]=r.useState({}),[nT,nj]=r.useState({}),[nS,nC]=r.useState({}),[nD,nE]=r.useState(!1),[nA,nI]=r.useState(null),[nZ,nN]=r.useState(!1),[nR,nk]=r.useState(null),[nM,nP]=r.useState(null),[nO,nF]=r.useState(""),[nU,nW]=r.useState(""),[n_,nL]=r.useState(!1),[nB,nz]=r.useState(null),[nH,nG]=r.useState(!1),[nJ,nV]=r.useState(!1),[nK,nX]=r.useState(!1),[nq,nY]=r.useState(null),[n$,nQ]=r.useState(null),[n0,n2]=r.useState(!1),[n1,n5]=r.useState(null),n6=r.useRef(void 0),n3=r.useRef(null),n7=r.useRef(null),n8=r.useRef(null),n4=(0,eC.useAgentENSClient)(),n9=(0,eE.useAgentIdentityClient)(),ae=(0,eA.u)(),at=(0,eI.h)();async function an(e){try{tf(e),ta(!0),ti(!0),ts(null),td(null),tj(null);let a=null;if(e.metadataURI&&e.metadataURI.startsWith("data:application/json"))try{console.info("............openIdentityJson: metadataURI is inline data:",e.metadataURI);let t=e.metadataURI.indexOf(",");if(-1!==t){let n;let r=e.metadataURI.substring(t+1);if(e.metadataURI.startsWith("data:application/json;base64,"))try{let e=e3.from(r,"base64").toString("utf-8");n=JSON.parse(e)}catch(e){console.info("............openIdentityJson: base64 decode failed, trying plain JSON");try{n=JSON.parse(r)}catch(t){let e=decodeURIComponent(r);n=JSON.parse(e)}}else try{n=JSON.parse(r)}catch(t){let e=decodeURIComponent(r);n=JSON.parse(e)}a=n,tj(e.metadataURI),console.info("............openIdentityJson: parsed inline data:",a)}}catch(e){console.warn("............openIdentityJson: Failed to parse inline data URI:",e)}else if(e.metadataURI&&e.metadataURI.trim().startsWith("{")&&e.metadataURI.trim().endsWith("}"))try{console.info("............openIdentityJson: metadataURI is plain JSON:",e.metadataURI),a=JSON.parse(e.metadataURI),tj(e.metadataURI),console.info("............openIdentityJson: parsed plain JSON:",a)}catch(e){console.warn("............openIdentityJson: Failed to parse plain JSON:",e)}if(!a){let r=e.chainId,i=(0,eZ.RM)(r),o=(0,eZ.v4)(r);if(!i||!o){console.warn("Missing configuration for chain ".concat(r));return}let{ethers:s}=await n.e(733).then(n.bind(n,12350)),l=new s.JsonRpcProvider(i),{EthersAdapter:d}=await Promise.resolve().then(n.t.bind(n,48140,23)),{ERC8004Client:c}=await Promise.resolve().then(n.t.bind(n,48140,23)),p=new d(l),u=new c({adapter:p,addresses:{identityRegistry:o,reputationRegistry:"0x0000000000000000000000000000000000000000",validationRegistry:"0x0000000000000000000000000000000000000000",chainId:r}});try{let n=await u.identity.getTokenURI(BigInt(e.agentId));if(tj(null!=n?n:null),n){let e=String(n).trim();if(/^ipfs:\/\//i.test(e))try{var t;let n=null===(t=e.slice(7).split("/")[0])||void 0===t?void 0:t.trim();if(n){let e=await fetch("".concat(eS.apiBase,"/api/web3storage/download/").concat(n));a=await e.json().catch(()=>null)}}catch(e){}else if(/^https?:\/\//i.test(e))try{let t=await fetch("/api/proxy?url=".concat(encodeURIComponent(e)));a=await t.json().catch(()=>null)}catch(e){}}}catch(e){}if(!a)try{a=await u.identity.getRegistrationFile(BigInt(e.agentId))}catch(e){}}a&&td(a);try{tp(JSON.stringify(a,null,2)),ty(null)}catch(e){tp("")}try{let e=Array.isArray(null==a?void 0:a.endpoints)?a.endpoints:[];tg(e.map(e=>{var t,n;return{name:String(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:""),endpoint:String(null!==(n=null==e?void 0:e.endpoint)&&void 0!==n?n:""),version:(null==e?void 0:e.version)?String(e.version):""}}))}catch(e){tg([])}}catch(e){ts((null==e?void 0:e.message)||"Failed to load Identity JSON")}finally{ti(!1)}}async function aa(){try{if(!tl||!th)return;if(!e_[th.agentId])throw Error("You can only update identities for agents you own");tx(!0),tw(null);let e={...tl||{},endpoints:tm};console.log("********************* updateIdentityRegistration: merged",e);let{url:t}=await eS.uploadJson({data:e,filename:"agent-".concat(th.agentId,"-registration.json")});console.log("********************* updateIdentityRegistration: url",t);let n=ae[(0,eZ.bM)(th.chainId)||"0xaa36a7"]||null;if(!n)throw Error("Identity client unavailable for chain ".concat(th.chainId));console.log("********************* updateIdentityRegistration: agentId",th.agentId);let a=await n.getAgentName(BigInt(th.agentId));if(console.log("********************* updateIdentityRegistration: agentName",a),!a)throw Error("Agent ENS name not found");console.log("********************* updateIdentityRegistration: identityCurrentAgent.agentAddress",th.agentAddress);let r=await n.getAgentEoaByAgentAccount(th.agentAddress);if(!eH||!r||r.toLowerCase()!==eH.toLowerCase())throw console.log("********************* updateIdentityRegistration: accountOwner",r,eH),Error("Connected wallet is not the owner of this agent account");if(!eB||!eH)throw Error("Not connected");let i=th.chainId,o=(0,eZ.RM)(i),s=(0,eZ.WH)(i),l=(0,eZ.eh)(i);if(!o||!s||!l)throw Error("Missing configuration for chain ".concat(i));let d=(0,k.v)({chain:s,transport:(0,M.d)(o)}),c=(0,P.K)({chain:s,transport:(0,O.P)(eB),account:eH}),p=await (0,H.gU)({address:th.agentAddress,client:d,implementation:G.vc.Hybrid,signatory:{walletClient:c}});await ea({agentIdentityClient:n,bundlerUrl:l,chain:s,agentAccountClient:p,agentId:BigInt(th.agentId),registrationUri:t})}catch(e){tw((null==e?void 0:e.message)||"Failed to update")}finally{tx(!1)}}function ar(e,t,n){tg(a=>{let r=[...a];return r[e]={...r[e],[t]:n},r})}async function ai(e){try{tF(!0),tW(!0),tL(null),tz(null);let t=e.agentId,n=e.chainId;console.info("+++++++++++++++++++ openAgentInfo: row",e),console.info("+++++++++++++++++++ openAgentInfo: agentId",t,"chainId",n,"type:",typeof n);let a=BigInt(t),r=(0,eZ.bM)(n);if(!r)throw Error("No chain configuration found for chainId ".concat(n,". Cannot fetch agent account."));console.info("+++++++++++++++++++ openAgentInfo: chainIdHex",r,"for chainId",n),console.info("+++++++++++++++++++ openAgentInfo: available clients",Object.keys(ae));let i=ae[r];if(!i)throw Error("No identity client available for chainId ".concat(n," (").concat(r,")"));let o=null,s=null,l=null;e.agentName&&(o=e.agentName,console.info("+++++++++++++++++++ openAgentInfo: using agentName from row",o)),e.metadataURI&&(l=e.metadataURI,console.info("+++++++++++++++++++ openAgentInfo: using tokenUri from row",l));try{if(console.info("++++++++++++++++++++++++ openAgentInfo: get agent name from agentIdentityClient for chain",n,"chainIdHex",r),console.info("openAgentInfo: Fetching agent account for agentId ".concat(a," on chain ").concat(n," (").concat(r,")")),o||(o=await i.getAgentName(a)),s=await i.getAgentAccount(a),!l)try{l=await i.getTokenURI(a),console.info("+++++++++++++++++++ openAgentInfo: fetched tokenUri from chain",l)}catch(e){console.warn("Failed to fetch token URI from chain:",e)}}catch(t){console.warn("Failed to get agent info from identity client:",t),!o&&e.agentName&&(o=e.agentName)}console.info("++++++++++++++++++++ openAgentInfo: name",o,"account",s,"tokenUri",l),tz({agentId:t,agentName:o||null,agentAccount:s||null,tokenUri:l||null,chainId:n,a2aEndpoint:e.a2aEndpoint||null})}catch(e){tL((null==e?void 0:e.message)||"Failed to load agent info")}finally{tW(!1)}}async function ao(e){try{tI(!0),tN(!0),tk(null),tP(null);let t=e.ensEndpoint||nb[e.agentAddress];if(!t){tk("No ENS name");return}let n=BigInt((0,F.V)(t)).toString(),a=await ev.getTextRecord(t,"url",z.F,"https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A"),r=await ev.getTextRecord(t,"agent-identity",z.F,"https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A"),i=function(e){try{if(!e||!/^0x[0-9a-fA-F]+$/.test(e))return null;let t=e.slice(2),n=t.slice(4,12),a=parseInt(n,16),r=t.slice(12,52),i=parseInt(t.slice(52,54),16),o=t.slice(54,54+2*i);return{chainId:a,address:"0x".concat(r),agentId:BigInt("0x".concat(o||"0")).toString()}}catch(e){return null}}(r);tP({name:t,tokenId:n,urlText:a,agentIdentity:null!=r?r:null,decodedIdentity:i})}catch(e){tk((null==e?void 0:e.message)||"Failed to load ENS details")}finally{tN(!1)}}function as(e){console.info("&&&&&&&&&&&& buildMerged: base: ",e);let t=e||{},n=t1.name||t.name,a=t1.description||t.description,r=t1.url||t.url,i=t1.version||t.version,o=t1.preferredTransport||t.preferredTransport,s=t1.protocolVersion||t.protocolVersion,l=Array.isArray(t1.skills)?t1.skills.map((e,n)=>{var a,r,i;let o=Array.isArray(t.skills)?t.skills:[],s=((null==e?void 0:e.id)?o.find(t=>(null==t?void 0:t.id)===e.id):o[n])||{};return{...s,id:null!==(a=null==e?void 0:e.id)&&void 0!==a?a:s.id,name:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:s.name,description:null!==(i=null==e?void 0:e.description)&&void 0!==i?i:s.description,tags:Array.isArray(null==e?void 0:e.tags)?e.tags.filter(Boolean):Array.isArray(null==s?void 0:s.tags)?s.tags:[],examples:Array.isArray(null==e?void 0:e.examples)?e.examples.filter(Boolean):Array.isArray(null==s?void 0:s.examples)?s.examples:[],inputModes:Array.isArray(null==e?void 0:e.inputModes)?e.inputModes.filter(Boolean):Array.isArray(null==s?void 0:s.inputModes)?s.inputModes:[],outputModes:Array.isArray(null==e?void 0:e.outputModes)?e.outputModes.filter(Boolean):Array.isArray(null==s?void 0:s.outputModes)?s.outputModes:[]}}):(()=>{let e=Array.isArray(t.skills)&&t.skills[0]||{};return[{id:t1.skillId||e.id,name:t1.skillName||e.name,description:t1.skillDesc||e.description,tags:String(t1.skillTags||"").split(",").map(e=>e.trim()).filter(Boolean).concat(Array.isArray(e.tags)?e.tags:[]).filter(Boolean),examples:String(t1.skillExamples||"").split(/\n|,/).map(e=>e.trim()).filter(Boolean).concat(Array.isArray(e.examples)?e.examples:[]).filter(Boolean),inputModes:Array.isArray(e.inputModes)?e.inputModes:[],outputModes:Array.isArray(e.outputModes)?e.outputModes:[]}]})(),d=Array.isArray(t1.trustModels)?t1.trustModels:String(t1.trustModels||"").split(",").map(e=>e.trim()).filter(Boolean),c={streaming:!!t1.capStream,pushNotifications:!!t1.capPush,stateTransitionHistory:!!t1.capStateTransitionHistory},p=Array.isArray(t1.defaultInputModes)?t1.defaultInputModes.filter(Boolean):String(t1.defaultInputModes||"").split(",").map(e=>e.trim()).filter(Boolean),u=Array.isArray(t1.defaultOutputModes)?t1.defaultOutputModes.filter(Boolean):String(t1.defaultOutputModes||"").split(",").map(e=>e.trim()).filter(Boolean),y=t1.providerOrganization||t1.providerUrl?{organization:t1.providerOrganization||void 0,url:t1.providerUrl||void 0}:void 0,m={};if(m.name=n,m.description=a,m.url=r,m.version=i,m.preferredTransport=o,m.protocolVersion=s,m.skills=l,null==t?void 0:t.registrations){let e=Array.isArray(t.registrations)?t.registrations:[];m.registrations=e.map(e=>({...e,signature:null==e?void 0:e.signature}))}return m.trustModels=d,m.capabilities=c,m.defaultInputModes=p,m.defaultOutputModes=u,y&&(m.provider=y),void 0!==t1.supportsAuthenticatedExtendedCard&&(m.supportsAuthenticatedExtendedCard=t1.supportsAuthenticatedExtendedCard),m}async function al(){if(tq)try{let e=tK?JSON.parse(tK):{},t=as(e),n=JSON.stringify(t,null,2);ay(tq,n),tX(n)}catch(t){var e;tQ(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Save failed")}}function ad(e,t){t5(n=>({...n,[e]:t})),n6.current&&window.clearTimeout(n6.current),n6.current=window.setTimeout(()=>{al()},600)}async function ac(e){var t,n,a,r,i,o,s,l,d,c,p,u,y,m,g,h;let f=Array.isArray(null==e?void 0:e.skills)?e.skills:[],b=null;if((null==e?void 0:null===(n=e.registrations)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.signature)&&e.registrations[0].signature.includes(""))try{let e=tq||"example.com";if(console.log("Signature is truncated, regenerating for domain:",e),eB){let t=await eB.request({method:"personal_sign",params:[e,ej]});b=t,console.log("Regenerated signature:",t)}}catch(e){console.log("Could not regenerate signature:",e)}t5({name:null!==(d=null==e?void 0:e.name)&&void 0!==d?d:"",description:null!==(c=null==e?void 0:e.description)&&void 0!==c?c:"",url:null!==(p=null==e?void 0:e.url)&&void 0!==p?p:"",version:null!==(u=null==e?void 0:e.version)&&void 0!==u?u:"",preferredTransport:null!==(y=null==e?void 0:e.preferredTransport)&&void 0!==y?y:"",protocolVersion:null!==(m=null==e?void 0:e.protocolVersion)&&void 0!==m?m:"",trustModels:Array.isArray(null==e?void 0:e.trustModels)?e.trustModels:[],capStream:!!(null==e?void 0:null===(a=e.capabilities)||void 0===a?void 0:a.streaming),capPush:!!(null==e?void 0:null===(r=e.capabilities)||void 0===r?void 0:r.pushNotifications),capStateTransitionHistory:!!(null==e?void 0:null===(i=e.capabilities)||void 0===i?void 0:i.stateTransitionHistory),defaultInputModes:Array.isArray(null==e?void 0:e.defaultInputModes)?e.defaultInputModes:[],defaultOutputModes:Array.isArray(null==e?void 0:e.defaultOutputModes)?e.defaultOutputModes:[],providerOrganization:null!==(g=null==e?void 0:null===(o=e.provider)||void 0===o?void 0:o.organization)&&void 0!==g?g:"",providerUrl:null!==(h=null==e?void 0:null===(s=e.provider)||void 0===s?void 0:s.url)&&void 0!==h?h:"",supportsAuthenticatedExtendedCard:!!(null==e?void 0:e.supportsAuthenticatedExtendedCard),skills:f.map(e=>{var t,n,a;return{id:null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"",name:null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"",description:null!==(a=null==e?void 0:e.description)&&void 0!==a?a:"",tags:Array.isArray(null==e?void 0:e.tags)?e.tags:"string"==typeof(null==e?void 0:e.tags)?[e.tags]:[],examples:Array.isArray(null==e?void 0:e.examples)?e.examples:"string"==typeof(null==e?void 0:e.examples)?[e.examples]:[],inputModes:Array.isArray(null==e?void 0:e.inputModes)?e.inputModes:[],outputModes:Array.isArray(null==e?void 0:e.outputModes)?e.outputModes:[]}})}),b&&(null==e?void 0:null===(l=e.registrations)||void 0===l?void 0:l[0])&&(e.registrations[0].signature=b,tX(JSON.stringify(e,null,2)))}async function ap(){var e,t,n,a,r,i;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1?arguments[1]:void 0;eP(!0),console.info("&&&&&&&&&&&& fetchData: page: ",o),console.info("&&&&&&&&&&&& fetchData: overrides: ",s);let l=new URL("/api/agents",window.location.origin),d=null!==(e=null==s?void 0:s.name)&&void 0!==e?e:ew,c=null!==(t=null==s?void 0:s.address)&&void 0!==t?t:ej,p=null!==(n=null==s?void 0:s.agentId)&&void 0!==n?n:eR,u=null==s?void 0:s.chainId;d&&l.searchParams.set("name",d),c&&l.searchParams.set("address",c),p&&l.searchParams.set("id",p),u&&l.searchParams.set("chainId",String(u)),l.searchParams.set("page",String(o)),l.searchParams.set("pageSize","50");try{console.info("&&&&&&&&&&&& fetchData: url: ",l);let e=await fetch(l);if(!e.ok){eF({page:o,pageSize:50,total:0,rows:[]});return}let t=await e.text(),n=null;if(t&&t.trim().length>0)try{n=JSON.parse(t)}catch(e){n=null}let s=null!=n?n:{page:o,pageSize:50,total:0,rows:[]};eF({page:null!==(a=s.page)&&void 0!==a?a:o,pageSize:null!==(r=s.pageSize)&&void 0!==r?r:50,total:null!==(i=s.total)&&void 0!==i?i:0,rows:Array.isArray(s.rows)?s.rows:[]})}finally{eP(!1)}}async function au(){try{if(eq(!0),e8(null),!Array.isArray(eO.rows)||0===eO.rows.length){e9(new Set),tt({});return}let e=eO.rows.map(e=>{var t;return{agentId:e.agentId,agentName:e.agentName,description:null!==(t=e.description)&&void 0!==t?t:null}}),t=await fetch("/api/discover",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:eG,agents:e})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Discover request failed")}let n=await t.json(),a=Array.isArray(null==n?void 0:n.matches)?n.matches:[],r=new Set,i={};a.forEach(e=>{let t="string"==typeof e?e:null==e?void 0:e.agentId;t&&(r.add(t),i[t]={score:"object"==typeof e&&"number"==typeof e.trustScore?e.trustScore:50,reasoning:"object"==typeof e?e.reasoning:void 0})}),e9(r),tt(i)}catch(e){e8((null==e?void 0:e.message)||"Failed to run discover")}finally{eq(!1)}}function ay(e,t){try{localStorage.setItem("agent_card:".concat(e.trim().toLowerCase()),t)}catch(e){}}async function am(e){let t={};try{let{ethers:a}=await n.e(733).then(n.bind(n,12350)),r=new a.JsonRpcProvider("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A"),{EthersAdapter:i}=await Promise.resolve().then(n.t.bind(n,48140,23)),{ERC8004Client:o}=await Promise.resolve().then(n.t.bind(n,48140,23)),s=new i(r),l=new o({adapter:s,addresses:{identityRegistry:"0x8004a6090Cd10A7288092483047B097295Fb8847",reputationRegistry:"0x0000000000000000000000000000000000000000",validationRegistry:"0x0000000000000000000000000000000000000000",chainId:11155111}}),d=await l.identity.getRegistrationFile(BigInt(e.agentId));if(console.info(">>>>>>>>>>>>>>>>> identity: ",d),d&&"object"==typeof d&&!Array.isArray(d)){"string"==typeof d.name&&d.name.trim()&&(t.name=d.name.trim()),"string"==typeof d.description&&d.description.trim()&&(t.description=d.description.trim()),"string"==typeof d.url&&/^https?:\/\//i.test(d.url)&&(t.url=d.url);try{let e=(Array.isArray(d.endpoints)?d.endpoints:[]).find(e=>"A2A"===String((null==e?void 0:e.name)||"").toUpperCase()),n=(null==e?void 0:e.endpoint)||(null==e?void 0:e.url);if(n&&/^https?:\/\//i.test(n)){let e=await fetch(n);if(e.ok){let n=await e.json().catch(()=>null);n&&"object"==typeof n&&!Array.isArray(n)&&(!t.name&&"string"==typeof n.name&&n.name.trim()&&(t.name=n.name.trim()),!t.description&&"string"==typeof n.description&&n.description.trim()&&(t.description=n.description.trim()),!t.url&&"string"==typeof n.url&&/^https?:\/\//i.test(n.url)&&(t.url=n.url))}}}catch(e){}}}catch(e){}return t}async function ag(e){console.info("viewOrCreateCard: ",e),console.info("row: ",e);let t=e.agentName.trim().toLowerCase();if(!e_[e.agentId])return;tV(e),tY(t),tQ(null),console.info("............getStoredCard for agentName: ",t);let n=function(e){try{return localStorage.getItem("agent_card:".concat(e.trim().toLowerCase()))}catch(e){return null}}(t);if(n){tX(n);try{await ac(JSON.parse(n))}catch(e){}tG(!0);return}await ah(e)}async function ah(e){var t,n;let a=e.agentName.trim().toLowerCase();t2(!0),tQ(null);try{if(!eB||!eH)throw Error("Not connected");let n=(0,P.K)({chain:z.F,transport:(0,O.P)(eB),account:eH}),r=await eQ({a2aUrl:null!==(t=e.a2aEndpoint)&&void 0!==t?t:void 0,registry:"0x8004a6090Cd10A7288092483047B097295Fb8847",agentName:a,chainId:11155111,trustModels:(e7.env.NEXT_PUBLIC_ERC8004_TRUST_MODELS||"feedback").split(",").map(e=>e.trim()).filter(Boolean),signMessage:async e=>await n.signMessage({account:eH,message:e})}),i=await am(e);console.info("............defaults: ",i),i.name&&(r.name=i.name),i.description&&(r.description=i.description),i.url&&(r.url=i.url);let o=JSON.stringify(r,null,2);ay(a,o),tX(o),await ac(r),tG(!0)}catch(e){tQ(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Failed to build agent card"),tG(!0)}finally{t2(!1)}}async function af(e){nf(e),nt(!0),ni(!0),ns(null),na([]);try{var t,n,a,r,i;console.info("............xxxx openFeedbackFor for agentId: ",e.agentId);let o=(0,k.v)({chain:z.F,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")}),s=e7.env.NEXT_PUBLIC_REPUTATION_REGISTRY;if(!s)throw Error("Reputation registry not configured");let l="0x0000000000000000000000000000000000000000000000000000000000000000";console.info("............readAllFeedback for agentId: ",e.agentId);let d=await o.readContract({address:s,abi:e6,functionName:"readAllFeedback",args:[BigInt(e.agentId),[],l,l,!0]});console.info("............res: ",d);let c=(null!==(t=null==d?void 0:d.outClients)&&void 0!==t?t:null==d?void 0:d[0])||[],p=(null!==(n=null==d?void 0:d.scores)&&void 0!==n?n:null==d?void 0:d[1])||[],u=(null!==(a=null==d?void 0:d.tag1s)&&void 0!==a?a:null==d?void 0:d[2])||[],y=(null!==(r=null==d?void 0:d.tag2s)&&void 0!==r?r:null==d?void 0:d[3])||[],m=(null!==(i=null==d?void 0:d.revokedStatuses)&&void 0!==i?i:null==d?void 0:d[4])||[],g=c.map((e,t)=>{var n;return{client:e,score:Number(null!==(n=p[t])&&void 0!==n?n:0),tag1:u[t],tag2:y[t],revoked:!!m[t]}});na(g)}catch(e){console.error("Error fetching feedback data:",e),ns(e.message||"Failed to fetch feedback data")}finally{ni(!1)}}async function ab(e){var t,n;console.log("Starting session creation for:",e.agentName),t9(!0);try{let n,a;if(!eB||!eH)throw Error("Not connected");let r=(0,k.v)({chain:z.F,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")}),i=(0,P.K)({chain:z.F,transport:(0,O.P)(eB),account:eH});console.info("*********** using agent account address from row: ",e.agentAddress);let o=await (0,H.gU)({address:e.agentAddress,client:r,implementation:G.vc.Hybrid,signatory:{walletClient:i}}),s=await o.getAddress();console.info("*********** ai agent address: ",s);let l=await (null===(t=o.getEntryPointAddress)||void 0===t?void 0:t.call(o))||"0x0000000071727De22E5E9d8BAf0edAc6f37da032",d=await r.getBytecode({address:s});if(!(d&&"0x"!==d)){let e="https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT",t=e7.env.NEXT_PUBLIC_PAYMASTER_URL||void 0;console.info("create bundler client ",e,t);let n=(0,J.r)({transport:(0,M.d)(e)}),a=(0,V.E)({transport:(0,M.d)(e),paymaster:!0,chain:z.F,paymasterContext:{mode:"SPONSORED"}});console.info("get gas price");let{fast:r}=await n.getUserOperationGasPrice();console.info("deploy indivAccount EOA address: ",eH),console.info("deploy indivAccountClient AA address: ",s);try{console.info("send user operation with bundlerClient 2: ",a);let e=await a.sendUserOperation({account:o,calls:[{to:U.DR}],...r});console.info("individual account is deployed - done");let{receipt:t}=await a.waitForUserOperationReceipt({hash:e})}catch(e){console.info("error deploying indivAccountClient: ",e)}}let c=(0,L.w)(),p=(0,B.L)(c),u=p.address,y=Math.floor(Date.now()/1e3),m="https://api.pimlico.io/v2/11155111/rpc?apikey=pim_HmE7RySzpkRBpcekjHfXpT",g=e7.env.NEXT_PUBLIC_PAYMASTER_URL||void 0,h=e7.env.NEXT_PUBLIC_REPUTATION_REGISTRY||"0x0000000000000000000000000000000000000000",f=await (0,H.gU)({client:r,implementation:G.vc.Hybrid,deployParams:[u,[],[],[]],signatory:{account:p},deploySalt:(0,W.NC)(10)}),b=await f.getAddress(),x=await r.getBytecode({address:b});if(!(x&&"0x"!==x)){let e=(0,J.r)({transport:(0,M.d)(m)}),t=(0,V.E)({transport:(0,M.d)(m),paymaster:!0,chain:z.F,paymasterContext:{mode:"SPONSORED"}}),{fast:n}=await e.getUserOperationGasPrice(),a=await t.sendUserOperation({account:f,calls:[{to:U.DR}],...n});await t.waitForUserOperationReceipt({hash:a})}console.log("Creating caveats using CaveatBuilder"),console.log("reputationRegistry:",h,typeof h);let v=o.environment,w=String(h).toLowerCase();console.log("registryAddress:",w);let T=(0,G.co)(v).addCaveat("allowedTargets",[w]).build(),j=await (0,G.lT)({from:s,to:b,caveats:T});if(o.signDelegation)a=await o.signDelegation({delegation:j});else if(i.signDelegation)a=await i.signDelegation({delegation:j});else throw Error("signDelegation helper not available");n={message:j,signature:a};let S={agentId:e.agentId,chainId:11155111,aa:s,sessionAA:b,reputationRegistry:h,selector:"0x8524d988",sessionKey:{privateKey:c,address:u,validAfter:y-60,validUntil:y+1800},entryPoint:l,bundlerUrl:m,paymasterUrl:g,signedDelegation:n};try{let t="0x8004a6090Cd10A7288092483047B097295Fb8847";if(t){let n=(0,_.R)({abi:Y,functionName:"approve",args:[b,BigInt(e.agentId)]}),a=(0,J.r)({transport:(0,M.d)(m)}),r=(0,V.E)({transport:(0,M.d)(m),paymaster:!0,chain:z.F,paymasterContext:{mode:"SPONSORED"}}),{fast:i}=await a.getUserOperationGasPrice(),s=await r.sendUserOperation({account:o,calls:[{to:t,data:n}],...i});await r.waitForUserOperationReceipt({hash:s}),console.info("sessionAA approved for tokenId",e.agentId)}}catch(e){console.info("failed to approve sessionAA operator",e)}console.log("Session created successfully:",S),t8(JSON.stringify(S,null,2)),t3(!0)}catch(e){console.error("Error creating session:",e),tQ(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Failed to build session")}finally{t9(!1)}}return r.useEffect(()=>{ap()},[]),r.useEffect(()=>{(async()=>{try{let{ethers:e}=await n.e(733).then(n.bind(n,12350)),t=new e.JsonRpcProvider("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A");new e5.EthersAdapter(t),n7.current=n4,n3.current=n9,n8.current=at}catch(e){}})(),async function(){if(!Array.isArray(eO.rows)||0===eO.rows.length||!eB||!eH){eL({});return}let e=(0,k.v)({chain:z.F,transport:(0,M.d)("https://eth-sepolia.g.alchemy.com/v2/WvEny4nR70VTUMX0DfR-A")}),t={};for(let a of eO.rows)try{let r=a.agentAddress,i=await e.getBytecode({address:r});if(i&&"0x"!==i){let i=null;try{i=await e.readContract({address:r,abi:[{name:"owner",type:"function",stateMutability:"view",inputs:[],outputs:[{type:"address"}]}],functionName:"owner",args:[]})}catch(e){}if(!i)try{i=await e.readContract({address:r,abi:[{name:"getOwner",type:"function",stateMutability:"view",inputs:[],outputs:[{type:"address"}]}],functionName:"getOwner",args:[]})}catch(e){}if(!i)try{var n;let t=await e.readContract({address:r,abi:[{name:"owners",type:"function",stateMutability:"view",inputs:[],outputs:[{type:"address[]"}]}],functionName:"owners",args:[]});i=null!==(n=null==t?void 0:t[0])&&void 0!==n?n:null}catch(e){}t[a.agentId]=!!i&&i.toLowerCase()===(null==eH?void 0:eH.toLowerCase())}else t[a.agentId]=(null==eH?void 0:eH.toLowerCase())===r.toLowerCase()}catch(e){}eL(t)}()},[eO,eB,eH]),(0,a.jsxs)(i.Z,{spacing:3,children:[(0,a.jsx)(o.Z,{variant:"outlined",sx:{p:2.5},children:(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[(0,a.jsxs)(i.Z,{direction:"row",alignItems:"center",spacing:2,children:[eH&&(0,a.jsx)(s.Z,{label:"EOA: ".concat(eH),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>window.open("".concat((0,eZ.jY)(11155111),"/address/").concat(eH),"_blank")}),(0,a.jsxs)(i.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(s.Z,{label:"Identity: ".concat("0x8004a6090Cd10A7288092483047B097295Fb8847".slice(0,10),"..."),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>{let e="0x8004a6090Cd10A7288092483047B097295Fb8847";e&&window.open("".concat((0,eZ.jY)(11155111),"/address/").concat(e),"_blank")}}),(0,a.jsx)(s.Z,{label:"Reputation: ".concat((e7.env.NEXT_PUBLIC_REPUTATION_REGISTRY||"Not configured").slice(0,10),"..."),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>{let e=e7.env.NEXT_PUBLIC_REPUTATION_REGISTRY;e&&window.open("".concat((0,eZ.jY)(11155111),"/address/").concat(e),"_blank")}})]})]}),eH&&(0,a.jsx)(l.Z,{variant:"contained",startIcon:(0,a.jsx)(e0.Z,{}),onClick:()=>nG(!0),size:"small",children:"Create Agent Identity"})]}),(0,a.jsx)(d.Z,{component:"form",onSubmit:function(e){e.preventDefault(),ap(1)},children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,md:3,children:(0,a.jsx)(p.Z,{fullWidth:!0,label:"address",placeholder:"0x",value:ej,onChange:e=>eD(e.target.value),size:"small"})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:3,children:(0,a.jsx)(p.Z,{fullWidth:!0,label:"name",placeholder:"Filter by name (ENS or metadata)",value:ew,onChange:e=>eT(e.target.value),size:"small"})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:3,children:(0,a.jsx)(p.Z,{fullWidth:!0,label:"id",placeholder:"Filter by id",value:eR,onChange:e=>ek(e.target.value),size:"small"})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:1,children:(0,a.jsx)(u.Z,{control:(0,a.jsx)(y.Z,{checked:eU,onChange:e=>eW(e.target.checked),size:"small"}),label:"Mine"})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:2,children:(0,a.jsxs)(i.Z,{direction:"row",spacing:1,sx:{height:"100%"},children:[(0,a.jsx)(l.Z,{type:"submit",variant:"contained",disableElevation:!0,sx:{flex:1},disabled:eM,children:eM?"Searching":"Search"}),(0,a.jsx)(l.Z,{type:"button",variant:"outlined",sx:{flex:1},disabled:eM,onClick:function(){eT(""),eD(""),ek(""),eW(!1),ap(1,{name:"",address:"",agentId:""})},children:"Clear"})]})})]})}),(0,a.jsx)(d.Z,{component:"form",onSubmit:e=>{e.preventDefault(),au()},children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,alignItems:"center",children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,md:9,children:(0,a.jsx)(p.Z,{fullWidth:!0,label:"discover agents",placeholder:"Describe what you're looking for",value:eG,onChange:e=>eJ(e.target.value),size:"small"})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:3,children:(0,a.jsxs)(i.Z,{direction:"row",spacing:1,sx:{height:"100%"},children:[(0,a.jsx)(l.Z,{type:"submit",variant:"contained",disableElevation:!0,sx:{flex:1},disabled:eV||!eG.trim(),children:eV?"Discovering":"Discover"}),(0,a.jsx)(l.Z,{type:"button",variant:"outlined",sx:{flex:1},disabled:eV&&!e4,onClick:function(){eJ(""),e8(null),e9(null),tt({})},children:"Clear"})]})}),e$&&(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(m.Z,{variant:"body2",color:"error",children:e$})}),e4&&(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",children:["Showing ",e4.size," discovered match(es)"]})})]})})]})}),(0,a.jsx)(g.Z,{component:o.Z,variant:"outlined",sx:{overflowX:"auto"},children:(0,a.jsxs)(h.Z,{size:"small",sx:{minWidth:1200},children:[(0,a.jsx)(f.Z,{children:(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(x.Z,{children:"Chain"}),(0,a.jsx)(x.Z,{children:"Account Address"}),(0,a.jsx)(x.Z,{children:"Name"}),(0,a.jsx)(x.Z,{children:"Description"}),(0,a.jsx)(x.Z,{children:"Identity ID"}),(0,a.jsx)(x.Z,{children:"A2A"}),e4&&(0,a.jsx)(x.Z,{children:"Trust Score"}),(0,a.jsx)(x.Z,{children:"Mine"}),eH&&(0,a.jsx)(x.Z,{})]})}),(0,a.jsxs)(v.Z,{children:[!eM&&0===eO.rows.filter(e=>(!e4||e4.has(e.agentId))&&(!eU||e_[e.agentId])).length&&(0,a.jsx)(b.Z,{children:(0,a.jsx)(x.Z,{colSpan:eH?e4?9:8:e4?8:7,align:"center",children:(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"No agents found."})})}),eM&&(0,a.jsx)(b.Z,{children:(0,a.jsx)(x.Z,{colSpan:eH?e4?9:8:e4?8:7,align:"center",children:(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading"})})}),null===(t=eO.rows.filter(e=>(!e4||e4.has(e.agentId))&&(!eU||e_[e.agentId])).sort((e,t)=>e4&&te[e.agentId]&&te[t.agentId]?te[t.agentId].score-te[e.agentId].score:e4&&te[e.agentId]?-1:e4&&te[t.agentId]?1:0))||void 0===t?void 0:t.map(e=>{var t,n;return(0,a.jsxs)(b.Z,{hover:!0,children:[(0,a.jsx)(x.Z,{children:(0,a.jsx)(s.Z,{label:(null===(t=(0,eZ.h2)(e.chainId))||void 0===t?void 0:t.chainName)||"Chain ".concat(e.chainId),size:"small",color:"L1"===(0,eZ._V)(e.chainId)?"primary":"secondary",sx:{fontFamily:"ui-monospace, monospace",fontSize:"0.7rem"}})}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(i.Z,{direction:"row",spacing:.25,alignItems:"center",children:(()=>{let t=nv[e.agentId]||e.agentAddress,n="".concat(t.slice(0,6),"...").concat(t.slice(-4));return(0,a.jsx)(m.Z,{component:"span",variant:"body2",sx:{fontFamily:"ui-monospace, monospace",cursor:"pointer","&:hover":{textDecoration:"underline"}},onMouseDown:e=>{1===e.button&&e.preventDefault()},noWrap:!0,title:"Click to view on ".concat((0,eZ.jz)(e.chainId),": ").concat(t),onClick:()=>window.open("".concat((0,eZ.jY)(e.chainId),"/address/").concat(t),"_blank"),children:n})})()})}),(0,a.jsxs)(x.Z,{children:[(()=>{let t=nv[e.agentId]||e.agentAddress,n=e.ensEndpoint||nb[t]||nb[e.agentAddress],r=e.agentName||"",i=nT[e.agentId]||null,o=r||i||null,s=tD[e.agentId],l=s?"".concat(o||n||"","\n\n").concat(s):o||n||"",d=o||n||"";return n?(0,a.jsx)(m.Z,{component:"a",href:"https://sepolia.app.ens.domains/".concat(n),target:"_blank",rel:"noopener noreferrer",variant:"body2",noWrap:!0,sx:{fontFamily:"ui-monospace, monospace",color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{color:"primary.dark",textDecoration:"none"}},title:l,children:d}):(0,a.jsx)(m.Z,{variant:"body2",noWrap:!0,sx:{fontFamily:"ui-monospace, monospace"},title:l,children:d})})(),(e.ensEndpoint||nb[e.agentAddress])&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.Z,{size:"small",onClick:()=>ao(e),sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto",ml:.5},children:"ENS"})})]}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(m.Z,{variant:"body2",noWrap:!0,sx:{fontFamily:"ui-monospace, monospace"},title:e.description||"",children:(e.description||"").slice(0,5)})}),(0,a.jsx)(x.Z,{children:(0,a.jsxs)(i.Z,{direction:"row",spacing:1,alignItems:"center",children:[(()=>{let t=(0,eZ.v4)(e.chainId);return t?(0,a.jsx)(m.Z,{component:"a",href:"".concat((0,eZ.jY)(e.chainId),"/nft/").concat(t,"/").concat(e.agentId),target:"_blank",rel:"noopener noreferrer",variant:"body2",sx:{fontFamily:"ui-monospace, monospace",color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{color:"primary.dark",textDecoration:"none"}},title:"View NFT #".concat(e.agentId," on ").concat((0,eZ.jz)(e.chainId)),children:e.agentId}):(0,a.jsx)(s.Z,{label:e.agentId,size:"small",sx:{fontFamily:"ui-monospace, monospace"}})})(),e_[e.agentId]&&(0,a.jsx)(w.Z,{title:"Burn Identity (send to 0x000dEaD)",children:(0,a.jsx)("span",{children:(0,a.jsx)(T.Z,{size:"small",color:"error",onClick:async()=>{try{var t;let n="0x8004a6090Cd10A7288092483047B097295Fb8847";if(!n)throw Error("Registry address not configured");let a=e7.env.NEXT_PUBLIC_RPC_URL||"https://rpc.ankr.com/eth_sepolia",r=(0,k.v)({chain:z.F,transport:(0,M.d)(a)}),i=(0,P.K)({chain:z.F,transport:(0,O.P)(eB),account:eH}),o=e.agentAddress,s=await (0,H.gU)({address:o,client:r,implementation:G.vc.Hybrid,signatory:{walletClient:i}}),l=(0,_.R)({abi:Y,functionName:"transferFrom",args:[o,"0x000000000000000000000000000000000000dEaD",BigInt(e.agentId)]}),d=e7.env.NEXT_PUBLIC_BUNDLER_URL||"",c=(0,J.r)({transport:(0,M.d)(d)}),p=(0,V.E)({transport:(0,M.d)(d),paymaster:!0,chain:z.F,paymasterContext:{mode:"SPONSORED"}}),{fast:u}=await c.getUserOperationGasPrice();console.info(" send user operation to burn identity");let y=await p.sendUserOperation({account:s,calls:[{to:n,data:l}],...u});await p.waitForUserOperationReceipt({hash:y}),console.info(" burn completed"),ap(null!==(t=null==eO?void 0:eO.page)&&void 0!==t?t:1)}catch(e){console.error("Failed to burn identity",e)}},sx:{minWidth:"auto",p:.5,lineHeight:1,height:"auto"},children:(0,a.jsx)(e1.Z,{fontSize:"small"})})})}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>ai(e),sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto",ml:.5},children:"INFO"}),(0,a.jsx)(w.Z,{title:e.metadataURI||"No registration URI",children:(0,a.jsx)("span",{children:(0,a.jsx)(l.Z,{size:"small",onClick:()=>an(e),disabled:!function(e){if(!e)return!1;let t=String(e).trim().replace(/^@+/,"");if(/^data:application\/json/i.test(t)||/^https?:\/\//i.test(t)||/^ipfs:\/\//i.test(t))return!0;if(t.startsWith("{")&&t.endsWith("}"))try{return JSON.parse(t),!0}catch(e){}return!1}(e.metadataURI)||!1===tS[e.agentId],sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"Reg"})})}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>ag(e),sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"Card"}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>{n5(e),n2(!0)},sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"Graph"}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>{e_[e.agentId]&&(nY(e),nQ(nb[e.agentAddress]||null),nV(!0))},sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"DID:Web"}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>{e_[e.agentId]&&(nY(e),nQ(nb[e.agentAddress]||null),nX(!0))},sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"DID:Agent"}),e_[e.agentId]&&(0,a.jsx)(l.Z,{size:"small",onClick:()=>ab(e),disabled:t4,sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:t4?"Loading...":"Session"})]})}),(0,a.jsx)(x.Z,{children:e.a2aEndpoint?(0,a.jsx)(l.Z,{size:"small",onClick:()=>window.open(e.a2aEndpoint,"_blank"),sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"A2A"}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:""})}),e4&&(0,a.jsx)(x.Z,{children:te[e.agentId]?(0,a.jsx)(w.Z,{title:te[e.agentId].reasoning||"Trust score based on feedback and relationships",arrow:!0,children:(0,a.jsx)(s.Z,{label:"".concat(te[e.agentId].score,"/100"),size:"small",color:te[e.agentId].score>=70?"success":te[e.agentId].score>=40?"warning":"error",sx:{fontWeight:600}})}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:""})}),(0,a.jsx)(x.Z,{children:e_[e.agentId]?(0,a.jsx)(s.Z,{label:"Mine",color:"primary",size:"small"}):null}),eH&&(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(l.Z,{size:"small",onClick:()=>af(e),sx:{minWidth:"auto",px:.5,py:.25,fontSize:"0.65rem",lineHeight:1,height:"auto"},children:"Feedback"}),(0,a.jsx)(T.Z,{size:"small",sx:{p:.5,color:"primary.main","&:hover":{color:"primary.dark",backgroundColor:"action.hover"}},title:"Give feedback to ".concat(null===(n=e.agentName)||void 0===n?void 0:n.replace(/\/$/,"")),onClick:()=>{var t;let n=null===(t=e.agentName)||void 0===t?void 0:t.replace(/\/$/,""),a=n.startsWith("http")?n:"http://".concat(n);window.open(a,"_blank")},children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,16.5L18,9.5L16.5,8L11,13.5L7.5,10L6,11.5L11,16.5Z"})})})]})]},"".concat(e.chainId,"-").concat(e.agentId))})]})]})}),(0,a.jsxs)(j.Z,{open:tn,onClose:()=>ta(!1),fullWidth:!0,maxWidth:"md",children:[(0,a.jsx)(S.Z,{children:"Agent Identity Registration"}),(0,a.jsxs)(C.Z,{dividers:!0,children:[(null==th?void 0:th.agentId)&&(0,a.jsxs)(d.Z,{sx:{mb:1},children:[(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",children:["NFT URL:\xa0",(()=>{let e=(0,eZ.v4)(th.chainId);if(e){let t="".concat((0,eZ.jY)(th.chainId),"/nft/").concat(e,"/").concat(th.agentId);return(0,a.jsx)(m.Z,{component:"a",href:t,target:"_blank",rel:"noopener noreferrer",variant:"caption",sx:{color:"primary.main",textDecoration:"underline"},children:t})}return(0,a.jsx)(m.Z,{component:"span",variant:"caption",children:""})})()]}),tT&&(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["tokenURI:\xa0",(0,a.jsx)(m.Z,{component:"a",href:tT,target:"_blank",rel:"noopener noreferrer",variant:"caption",sx:{color:"primary.main",textDecoration:"underline"},children:tT})]})]}),tr?(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading"}):to?(0,a.jsx)(m.Z,{variant:"body2",color:"error",children:to}):tl?(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsxs)(i.Z,{spacing:1,children:[tv&&(0,a.jsx)(d.Z,{sx:{p:1,bgcolor:"error.light",borderRadius:1},children:(0,a.jsx)(m.Z,{variant:"caption",color:"error",children:tv})}),(0,a.jsxs)(i.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsx)(m.Z,{variant:"subtitle2",children:"Endpoints"}),(0,a.jsx)(T.Z,{size:"small",onClick:function(){tg(e=>[...e,{name:"",endpoint:"",version:""}])},children:(0,a.jsx)(e0.Z,{fontSize:"inherit"})})]}),(0,a.jsx)(i.Z,{spacing:1,children:tm.map((e,t)=>(0,a.jsxs)(d.Z,{sx:{p:1,border:"1px dashed",borderColor:"divider",borderRadius:1},children:[(0,a.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[(0,a.jsxs)(m.Z,{variant:"caption",children:["Endpoint #",t+1]}),(0,a.jsx)(T.Z,{size:"small",onClick:()=>{tg(e=>{let n=[...e];return n.splice(t,1),n})},children:(0,a.jsx)(e2.Z,{fontSize:"inherit"})})]}),(0,a.jsxs)(c.ZP,{container:!0,spacing:1,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"name",value:e.name,onChange:e=>ar(t,"name",e.target.value)})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"version",value:e.version||"",onChange:e=>ar(t,"version",e.target.value)})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"endpoint",value:e.endpoint,onChange:e=>ar(t,"endpoint",e.target.value)})})]})]},t))})]})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsxs)(d.Z,{sx:{position:"relative",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5},children:[(0,a.jsx)(T.Z,{size:"small","aria-label":"Copy JSON",onClick:()=>{try{let e={...tl||{},endpoints:tm};navigator.clipboard.writeText(JSON.stringify(e,null,2)).catch(()=>{})}catch(e){}},sx:{position:"absolute",top:4,right:4},children:(0,a.jsx)(ez.Z,{fontSize:"inherit"})}),(0,a.jsx)(d.Z,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:12,fontFamily:"ui-monospace, monospace",m:0},children:(()=>{try{let e={...tl||{},endpoints:tm};return JSON.stringify(e,null,2)}catch(e){return tc}})()})]})})]}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"No data"})]}),(0,a.jsxs)(D.Z,{children:[(0,a.jsx)(l.Z,{variant:"contained",size:"small",disabled:tb||tr||!tl,onClick:aa,children:tb?"Updating":"Update"}),(0,a.jsx)(l.Z,{onClick:()=>{try{let e=Array.isArray(null==tl?void 0:tl.endpoints)?tl.endpoints:[];tg(e.map(e=>{var t,n;return{name:String(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:""),endpoint:String(null!==(n=null==e?void 0:e.endpoint)&&void 0!==n?n:""),version:(null==e?void 0:e.version)?String(e.version):""}}))}catch(e){tg([])}},children:"Reset"}),(0,a.jsx)(l.Z,{onClick:()=>ta(!1),children:"Close"})]})]}),(0,a.jsxs)(j.Z,{open:tA,onClose:()=>tI(!1),fullWidth:!0,maxWidth:"sm",children:[(0,a.jsx)(S.Z,{children:"ENS Details"}),(0,a.jsx)(C.Z,{dividers:!0,children:tZ?(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading"}):tR?(0,a.jsx)(m.Z,{variant:"body2",color:"error",children:tR}):tM?(0,a.jsxs)(i.Z,{spacing:1,children:[(0,a.jsxs)(m.Z,{variant:"body2",children:[(0,a.jsx)("strong",{children:"Name:"})," ",tM.name]}),(0,a.jsxs)(m.Z,{variant:"body2",children:[(0,a.jsx)("strong",{children:"NFT tokenId:"})," ",tM.tokenId]}),(0,a.jsxs)(m.Z,{variant:"body2",children:[(0,a.jsx)("strong",{children:"URL:"})," ",null!==(K=tM.urlText)&&void 0!==K?K:""]}),(0,a.jsxs)(m.Z,{variant:"body2",children:[(0,a.jsx)("strong",{children:"agent-identity:"})," ",null!==(X=tM.agentIdentity)&&void 0!==X?X:""]}),tM.decodedIdentity&&(0,a.jsxs)(i.Z,{spacing:.5,sx:{pl:1},children:[(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",children:["chainId: ",tM.decodedIdentity.chainId]}),(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",children:["address: ",tM.decodedIdentity.address]}),(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",children:["agentId: ",tM.decodedIdentity.agentId]})]})]}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"No details"})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>tI(!1),children:"Close"})})]}),(0,a.jsx)(j.Z,{open:tO,onClose:()=>tF(!1),fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:2}},children:tU?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{children:"Loading"}),(0,a.jsx)(C.Z,{children:(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",sx:{py:4,textAlign:"center"},children:"Loading agent information"})})]}):t_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{children:"Error"}),(0,a.jsx)(C.Z,{children:(0,a.jsx)(m.Z,{variant:"body2",color:"error",sx:{py:2},children:t_})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>tF(!1),children:"Close"})})]}):tB?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d.Z,{sx:{bgcolor:"primary.main",color:"primary.contrastText",p:3,position:"relative"},children:[(0,a.jsx)(m.Z,{variant:"h4",component:"h1",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:tB.agentName||"Unnamed Agent"}),tB.agentName&&(0,a.jsx)(E.Z,{href:"https://sepolia.app.ens.domains/".concat(tB.agentName),target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.contrastText",opacity:.9,textDecoration:"none",fontSize:"0.875rem","&:hover":{textDecoration:"underline"}},children:"View on ENS App "})]}),(0,a.jsx)(C.Z,{sx:{p:0},children:(0,a.jsxs)(i.Z,{spacing:0,children:[(0,a.jsxs)(A.Z,{variant:"outlined",sx:{borderRadius:0,borderLeft:"none",borderRight:"none",borderTop:"none"},children:[(0,a.jsx)(I.Z,{title:"Address",titleTypographyProps:{variant:"subtitle2",fontWeight:600,textTransform:"uppercase",letterSpacing:1},sx:{pb:1}}),(0,a.jsx)(Z.Z,{sx:{pt:0},children:tB.agentAccount?(0,a.jsx)(i.Z,{spacing:1,children:(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:tB.chainId?(0,eZ.jz)(tB.chainId):"Ethereum"}),(0,a.jsxs)(i.Z,{direction:"row",spacing:1,alignItems:"center",children:[tB.chainId&&(0,eZ.jY)(tB.chainId)&&tB.agentAccount?(0,a.jsx)(E.Z,{href:"".concat((0,eZ.jY)(tB.chainId),"/address/").concat(tB.agentAccount),target:"_blank",rel:"noopener noreferrer",sx:{fontFamily:"monospace",wordBreak:"break-all",fontWeight:500,textDecoration:"none",color:"inherit",flex:1,"&:hover":{textDecoration:"underline"}},children:tB.agentAccount}):(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"monospace",wordBreak:"break-all",fontWeight:500,flex:1},children:tB.agentAccount}),(0,a.jsx)(w.Z,{title:"Copy address",children:(0,a.jsx)(T.Z,{size:"small",onClick:()=>navigator.clipboard.writeText(tB.agentAccount),children:(0,a.jsx)(ez.Z,{fontSize:"small"})})})]})]})}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"No address set"})})]}),(0,a.jsxs)(A.Z,{variant:"outlined",sx:{borderRadius:0,borderLeft:"none",borderRight:"none",borderTop:"none"},children:[(0,a.jsx)(I.Z,{title:"Records",titleTypographyProps:{variant:"subtitle2",fontWeight:600,textTransform:"uppercase",letterSpacing:1},sx:{pb:1}}),(0,a.jsx)(Z.Z,{sx:{pt:0},children:(0,a.jsxs)(i.Z,{spacing:2,children:[tB.agentId&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Agent ID"}),(0,a.jsxs)(i.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"monospace",fontWeight:500},children:tB.agentId}),tB.chainId&&(()=>{let e=(0,eZ.v4)(tB.chainId),t=(0,eZ.jY)(tB.chainId);if(e&&t){let n="".concat(t,"/nft/").concat(e,"/").concat(tB.agentId);return(0,a.jsxs)(E.Z,{href:n,target:"_blank",rel:"noopener noreferrer",sx:{fontSize:"0.875rem",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:["View on ",(0,eZ.jz)(tB.chainId)," "]})}return null})()]})]}),tB.a2aEndpoint&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"A2A Endpoint"}),(0,a.jsx)(E.Z,{href:tB.a2aEndpoint,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all",fontSize:"0.875rem",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:tB.a2aEndpoint})]}),tB.tokenUri&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Token URI"}),(0,a.jsx)(m.Z,{variant:"body2",sx:{wordBreak:"break-all",fontFamily:"monospace",fontSize:"0.875rem"},children:tB.tokenUri})]})]})})]})]})}),(0,a.jsx)(D.Z,{sx:{p:2,borderTop:1,borderColor:"divider"},children:(0,a.jsx)(l.Z,{onClick:()=>tF(!1),variant:"outlined",children:"Close"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{children:"No Information"}),(0,a.jsx)(C.Z,{children:(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",sx:{py:2},children:"No agent information available"})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>tF(!1),children:"Close"})})]})}),(0,a.jsxs)(j.Z,{open:tH,onClose:()=>tG(!1),fullWidth:!0,maxWidth:"md",children:[(0,a.jsxs)(S.Z,{children:["Agent Card ",tq?" ".concat(tq):""]}),(0,a.jsx)(C.Z,{dividers:!0,children:(0,a.jsxs)(c.ZP,{container:!0,spacing:2,children:[(0,a.jsxs)(c.ZP,{item:!0,xs:12,md:6,children:[(0,a.jsxs)(i.Z,{spacing:1,sx:{mb:2},children:[(0,a.jsx)(p.Z,{label:"name",size:"small",value:null!==(q=t1.name)&&void 0!==q?q:"",onChange:e=>ad("name",e.target.value)}),(0,a.jsx)(p.Z,{label:"description",size:"small",value:null!==($=t1.description)&&void 0!==$?$:"",onChange:e=>ad("description",e.target.value)}),(0,a.jsx)(p.Z,{label:"url",size:"small",value:null!==(Q=t1.url)&&void 0!==Q?Q:"",onChange:e=>ad("url",e.target.value)}),(0,a.jsx)(p.Z,{label:"version",size:"small",value:null!==(ee=t1.version)&&void 0!==ee?ee:"",onChange:e=>ad("version",e.target.value)}),(0,a.jsx)(p.Z,{label:"preferredTransport",size:"small",value:null!==(et=t1.preferredTransport)&&void 0!==et?et:"",onChange:e=>ad("preferredTransport",e.target.value)}),(0,a.jsx)(p.Z,{label:"protocolVersion",size:"small",value:null!==(en=t1.protocolVersion)&&void 0!==en?en:"",onChange:e=>ad("protocolVersion",e.target.value)}),(0,a.jsx)(N.Z,{sx:{my:1}}),(0,a.jsx)(m.Z,{variant:"subtitle2",children:"Provider"}),(0,a.jsx)(p.Z,{label:"Provider Organization",size:"small",value:null!==(er=t1.providerOrganization)&&void 0!==er?er:"",onChange:e=>ad("providerOrganization",e.target.value)}),(0,a.jsx)(p.Z,{label:"Provider URL",size:"small",value:null!==(ei=t1.providerUrl)&&void 0!==ei?ei:"",onChange:e=>ad("providerUrl",e.target.value)}),(0,a.jsx)(N.Z,{sx:{my:1}}),(0,a.jsx)(m.Z,{variant:"subtitle2",children:"Capabilities"}),(0,a.jsx)(u.Z,{control:(0,a.jsx)(y.Z,{checked:!!t1.capStream,onChange:e=>ad("capStream",e.target.checked)}),label:"Streaming"}),(0,a.jsx)(u.Z,{control:(0,a.jsx)(y.Z,{checked:!!t1.capPush,onChange:e=>ad("capPush",e.target.checked)}),label:"Push Notifications"}),(0,a.jsx)(u.Z,{control:(0,a.jsx)(y.Z,{checked:!!t1.capStateTransitionHistory,onChange:e=>ad("capStateTransitionHistory",e.target.checked)}),label:"State Transition History"}),(0,a.jsx)(N.Z,{sx:{my:1}}),(0,a.jsx)(m.Z,{variant:"subtitle2",children:"Extended Card"}),(0,a.jsx)(u.Z,{control:(0,a.jsx)(y.Z,{checked:!!t1.supportsAuthenticatedExtendedCard,onChange:e=>ad("supportsAuthenticatedExtendedCard",e.target.checked)}),label:"Supports Authenticated Extended Card"}),(0,a.jsx)(N.Z,{sx:{my:1}}),(0,a.jsxs)(i.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsx)(m.Z,{variant:"subtitle2",children:"Skills"}),(0,a.jsx)(T.Z,{size:"small",onClick:()=>ad("skills",[...t1.skills||[],{id:"",name:"",description:"",tags:[],examples:[],inputModes:[],outputModes:[]}]),children:(0,a.jsx)(e0.Z,{fontSize:"inherit"})})]}),(0,a.jsx)(i.Z,{spacing:1,children:(t1.skills||[]).map((e,t)=>(0,a.jsxs)(d.Z,{sx:{p:1,border:"1px dashed",borderColor:"divider",borderRadius:1},children:[(0,a.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[(0,a.jsxs)(m.Z,{variant:"caption",children:["Skill #",t+1]}),(0,a.jsx)(T.Z,{size:"small",onClick:()=>{let e=[...t1.skills||[]];e.splice(t,1),ad("skills",e)},children:(0,a.jsx)(e2.Z,{fontSize:"inherit"})})]}),(0,a.jsxs)(c.ZP,{container:!0,spacing:1,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"id",value:e.id,onChange:e=>{let n=[...t1.skills||[]];n[t]={...n[t],id:e.target.value},ad("skills",n)}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"name",value:e.name,onChange:e=>{let n=[...t1.skills||[]];n[t]={...n[t],name:e.target.value},ad("skills",n)}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"description",value:e.description,onChange:e=>{let n=[...t1.skills||[]];n[t]={...n[t],description:e.target.value},ad("skills",n)}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"examples (one per line)",multiline:!0,minRows:2,value:(e.examples||[]).join("\n"),onChange:e=>{let n=e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean),a=[...t1.skills||[]];a[t]={...a[t],examples:n},ad("skills",a)}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"tags (one per line)",multiline:!0,minRows:2,value:(e.tags||[]).join("\n"),onChange:e=>{let n=e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean),a=[...t1.skills||[]];a[t]={...a[t],tags:n},ad("skills",a)}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"inputModes (one per line)",multiline:!0,minRows:2,value:(e.inputModes||[]).join("\n"),onChange:e=>{let n=e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean),a=[...t1.skills||[]];a[t]={...a[t],inputModes:n},ad("skills",a)}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",label:"outputModes (one per line)",multiline:!0,minRows:2,value:(e.outputModes||[]).join("\n"),onChange:e=>{let n=e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean),a=[...t1.skills||[]];a[t]={...a[t],outputModes:n},ad("skills",a)}})})]})]},t))}),(0,a.jsx)(N.Z,{sx:{my:1}}),(0,a.jsx)(p.Z,{label:"trustModels (one per line)",size:"small",multiline:!0,minRows:2,value:Array.isArray(t1.trustModels)?t1.trustModels.join("\n"):"",onChange:e=>ad("trustModels",e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean))}),(0,a.jsx)(p.Z,{label:"defaultInputModes (one per line)",size:"small",multiline:!0,minRows:2,value:Array.isArray(t1.defaultInputModes)?t1.defaultInputModes.join("\n"):"",onChange:e=>ad("defaultInputModes",e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean))}),(0,a.jsx)(p.Z,{label:"defaultOutputModes (one per line)",size:"small",multiline:!0,minRows:2,value:Array.isArray(t1.defaultOutputModes)?t1.defaultOutputModes.join("\n"):"",onChange:e=>ad("defaultOutputModes",e.target.value.split(/\n/).map(e=>e.trim()).filter(Boolean))})]}),t0&&(0,a.jsx)(m.Z,{variant:"body2",children:"Building"}),t$&&(0,a.jsx)(m.Z,{variant:"body2",color:"error",children:t$})]}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(d.Z,{children:(0,a.jsxs)(d.Z,{sx:{position:"relative",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5},children:[(0,a.jsx)(T.Z,{size:"small","aria-label":"Copy JSON",onClick:()=>{try{let e=tK?JSON.parse(tK):{},t={...e,name:t1.name||e.name,description:t1.description||e.description,homepage:t1.homepage||e.homepage,url:t1.url||e.url,version:t1.version||e.version,preferredTransport:t1.preferredTransport||e.preferredTransport,protocolVersion:t1.protocolVersion||e.protocolVersion,trustModels:Array.isArray(t1.trustModels)?t1.trustModels:String(t1.trustModels||"").split(",").map(e=>e.trim()).filter(Boolean),capabilities:{pushNotifications:!!t1.capPush,streaming:!!t1.capStream},defaultInputModes:String(t1.defaultInputModes||"").split(",").map(e=>e.trim()).filter(Boolean),defaultOutputModes:String(t1.defaultOutputModes||"").split(",").map(e=>e.trim()).filter(Boolean),skills:[{id:t1.skillId||void 0,name:t1.skillName||void 0,description:t1.skillDesc||void 0,tags:String(t1.skillTags||"").split(",").map(e=>e.trim()).filter(Boolean),examples:String(t1.skillExamples||"").split(/\n|,/).map(e=>e.trim()).filter(Boolean)}]};navigator.clipboard.writeText(JSON.stringify(t,null,2)).catch(()=>{})}catch(e){navigator.clipboard.writeText(tK||"").catch(()=>{})}},sx:{position:"absolute",top:4,right:4},children:(0,a.jsx)(ez.Z,{fontSize:"inherit"})}),tK&&(()=>{try{var e,t;let n=JSON.parse(tK),r={...as(n)};(null==n?void 0:null===(t=n.registrations)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.signature)&&(r.registrations[0].signature=n.registrations[0].signature);let{description:i,...o}=r,s=JSON.stringify(o,null,2);return(0,a.jsx)(d.Z,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:12,fontFamily:"ui-monospace, monospace",m:0},children:s})}catch(e){return(0,a.jsx)(d.Z,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:12,fontFamily:"ui-monospace, monospace",m:0},children:tK})}})()]})})})]})}),(0,a.jsxs)(D.Z,{children:[(0,a.jsx)(l.Z,{onClick:async()=>{tJ&&await ah(tJ)},children:"Reset"}),(0,a.jsx)(l.Z,{onClick:()=>{tK&&tq&&ay(tq,tK),tG(!1)},children:"Close"})]})]}),(0,a.jsxs)(j.Z,{open:t6,onClose:()=>t3(!1),fullWidth:!0,maxWidth:"sm",children:[(0,a.jsx)(S.Z,{children:"Session Package"}),(0,a.jsx)(C.Z,{dividers:!0,children:(0,a.jsxs)(d.Z,{sx:{position:"relative",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5},children:[(0,a.jsx)(T.Z,{size:"small","aria-label":"Copy",onClick:()=>{t7&&navigator.clipboard.writeText(t7).catch(()=>{})},sx:{position:"absolute",top:4,right:4},children:(0,a.jsx)(ez.Z,{fontSize:"inherit"})}),(0,a.jsx)(d.Z,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:12,fontFamily:"ui-monospace, monospace",m:0},children:t7})]})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>t3(!1),children:"Close"})})]}),(0,a.jsxs)(j.Z,{open:ne,onClose:()=>nt(!1),maxWidth:"md",fullWidth:!0,children:[(0,a.jsxs)(S.Z,{children:["Feedback for ",null==nh?void 0:nh.agentName]}),(0,a.jsxs)(C.Z,{children:[nr&&(0,a.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,a.jsx)(m.Z,{children:"Loading feedback data..."})}),no&&(0,a.jsx)(d.Z,{sx:{p:2,bgcolor:"error.light",borderRadius:1,mb:2},children:(0,a.jsx)(m.Z,{color:"error",children:no})}),!nr&&!no&&0===nn.length&&(0,a.jsx)(d.Z,{sx:{p:2,textAlign:"center"},children:(0,a.jsx)(m.Z,{color:"text.secondary",children:"No feedback data available"})}),!nr&&!no&&nn.length>0&&(0,a.jsxs)(i.Z,{spacing:2,children:[nn.map((e,t)=>(0,a.jsx)(o.Z,{sx:{p:2,bgcolor:"grey.50"},children:(0,a.jsx)(i.Z,{spacing:1,children:Object.entries(e).map(e=>{let[t,n]=e;return(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)(m.Z,{variant:"subtitle2",color:"primary",sx:{fontWeight:600},children:[t,":"]}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"object"==typeof n?"ui-monospace, monospace":"inherit",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:"object"==typeof n?JSON.stringify(n,null,2):String(n)})]},t)})})},t)),(0,a.jsxs)(i.Z,{direction:"row",spacing:1,sx:{mt:1},children:[(0,a.jsx)(l.Z,{variant:"contained",size:"small",disabled:tb,onClick:aa,children:tb?"Updating":"Update"}),(0,a.jsx)(l.Z,{size:"small",onClick:()=>{try{let e=Array.isArray(null==tl?void 0:tl.endpoints)?tl.endpoints:[];tg(e.map(e=>{var t,n;return{name:String(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:""),endpoint:String(null!==(n=null==e?void 0:e.endpoint)&&void 0!==n?n:""),version:(null==e?void 0:e.version)?String(e.version):""}}))}catch(e){tg([])}},children:"Reset"})]})]})]}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>nt(!1),children:"Close"})})]}),(0,a.jsxs)(j.Z,{open:nl,onClose:()=>nd(!1),maxWidth:"md",fullWidth:!0,children:[(0,a.jsxs)(S.Z,{children:["All Feedback for ",null==nh?void 0:nh.agentName]}),(0,a.jsxs)(C.Z,{dividers:!0,children:[nu&&(0,a.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,a.jsx)(m.Z,{children:"Loading"})}),nm&&(0,a.jsx)(d.Z,{sx:{p:2,bgcolor:"error.light",borderRadius:1,mb:2},children:(0,a.jsx)(m.Z,{color:"error",children:nm})}),!nu&&!nm&&0===nc.length&&(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"No feedback found."}),!nu&&!nm&&nc.length>0&&(0,a.jsx)(i.Z,{spacing:1,children:nc.map((e,t)=>(0,a.jsx)(d.Z,{sx:{p:1,border:"1px solid",borderColor:"divider",borderRadius:1},children:(0,a.jsx)(m.Z,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:"string"==typeof e?e:JSON.stringify(e)})},t))})]}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>nd(!1),children:"Close"})})]}),(0,a.jsxs)(j.Z,{open:nD,onClose:()=>nE(!1),maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(S.Z,{sx:{pb:1},children:(0,a.jsx)(d.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"h5",sx:{fontWeight:600,mb:.5},children:"Agent ENS Domain"}),(null==nA?void 0:nA.name)&&(0,a.jsx)(m.Z,{variant:"h6",sx:{fontFamily:"ui-monospace, monospace",color:"primary.main",fontWeight:500,cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:()=>{window.open("https://sepolia.app.ens.domains/".concat(nA.name),"_blank")},children:nA.name})]})})}),(0,a.jsxs)(C.Z,{children:[nZ&&(0,a.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(m.Z,{children:"Loading ENS data..."})}),n_&&(0,a.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(m.Z,{children:"Checking parent domain status..."})}),nR&&(0,a.jsx)(d.Z,{sx:{p:2,bgcolor:"error.light",borderRadius:2,mb:3},children:(0,a.jsx)(m.Z,{color:"error",children:nR})}),!nZ&&!nR&&nA&&(0,a.jsx)(i.Z,{spacing:3,children:nA.name?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{sx:{p:3,border:"1px solid",borderColor:"divider",borderRadius:2},children:(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Owner"}),(0,a.jsx)(m.Z,{variant:"body1",sx:{fontFamily:"ui-monospace, monospace",color:"primary.main",cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:()=>window.open("".concat((0,eZ.jY)((null==nM?void 0:nM.chainId)||11155111),"/address/").concat(null==nM?void 0:nM.agentAddress),"_blank"),children:null==nM?void 0:nM.agentAddress})]}),(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"NFT Wrapper"}),(0,a.jsxs)(d.Z,{sx:{p:2,bgcolor:"white",borderRadius:1,border:"1px solid",borderColor:"info.main",display:"flex",alignItems:"center",gap:1,cursor:"pointer","&:hover":{bgcolor:"grey.50","& .nft-icon":{filter:"brightness(0) invert(1)"}}},onClick:()=>{if(nA.name){let e=BigInt((0,F.V)(nA.name)),t="https://sepolia.etherscan.io/nft/".concat(e7.env.NEXT_PUBLIC_ENS_IDENTITY_WRAPPER||"0x0635513f179D50A207757E05759CbD106d7dFcE8","/").concat(e);window.open(t,"_blank")}},children:[(0,a.jsx)("img",{src:"https://sepolia.etherscan.io/images/main/nft-placeholder.svg",alt:"NFT",className:"nft-icon",style:{width:24,height:24,transition:"filter 0.2s ease"}}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:500},children:"View on Etherscan"})]})]})]})}),nA.avatar&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"subtitle2",color:"primary",sx:{fontWeight:600,mb:1},children:"Avatar:"}),(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,a.jsx)("img",{src:nA.avatar,alt:"ENS Avatar",style:{width:64,height:64,borderRadius:"50%",objectFit:"cover"},onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"ui-monospace, monospace",wordBreak:"break-all"},children:nA.avatar})]})]}),(nA.website||nA.email||nA.twitter||nA.github||nA.discord)&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"subtitle2",color:"primary",sx:{fontWeight:600,mb:1},children:"Additional Records:"}),(0,a.jsxs)(i.Z,{spacing:1,children:[nA.website&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:600},children:"Website:"}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"ui-monospace, monospace"},children:nA.website})]}),nA.email&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:600},children:"Email:"}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"ui-monospace, monospace"},children:nA.email})]}),nA.twitter&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:600},children:"Twitter:"}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"ui-monospace, monospace"},children:nA.twitter})]}),nA.github&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:600},children:"GitHub:"}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"ui-monospace, monospace"},children:nA.github})]}),nA.discord&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",sx:{fontWeight:600},children:"Discord:"}),(0,a.jsx)(m.Z,{variant:"body2",sx:{fontFamily:"ui-monospace, monospace"},children:nA.discord})]})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{sx:{p:3,border:"1px solid",borderColor:"divider",borderRadius:2},children:(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(d.Z,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"warning.main"}}),(0,a.jsx)(m.Z,{variant:"h6",sx:{fontWeight:600},children:"No ENS Domain Found"})]}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"This agent address doesn't have an ENS domain associated with it. You can create a subdomain if you own a parent ENS domain."})]})}),(0,a.jsx)(o.Z,{sx:{p:3,border:"1px solid",borderColor:"divider",borderRadius:2},children:(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsx)(m.Z,{variant:"h6",sx:{fontWeight:600},children:"Create ENS Subdomain"}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Create a subdomain for this agent address using your parent ENS domain."}),(0,a.jsxs)(i.Z,{spacing:2,children:[(0,a.jsx)(p.Z,{label:"Parent Domain",value:nU,placeholder:"mydomain.eth",size:"small",fullWidth:!0,disabled:!0,helperText:"Parent domain from environment configuration"}),(0,a.jsx)(p.Z,{label:"Subdomain Name",value:nO,onChange:e=>nF(e.target.value),placeholder:"finder",size:"small",fullWidth:!0,helperText:"Enter a single label (no dots). Example: 'finder' creates 'finder.orgtrust.eth'",error:nO.includes(".")}),nO.includes(".")&&(0,a.jsx)(m.Z,{variant:"body2",color:"error",sx:{mt:1},children:' Invalid subdomain name: Cannot contain dots. Use a single label like "finder" instead of "finder.airbnb.org"'})]})]})})]})}),!nZ&&!n_&&(0,a.jsxs)(d.Z,{sx:{mt:3},children:[(0,a.jsx)(m.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Parent Domain"}),(0,a.jsxs)(o.Z,{sx:{p:3,border:"1px solid",borderColor:"success.main",borderRadius:2},children:[(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Domain"}),(0,a.jsx)(m.Z,{variant:"body1",sx:{fontFamily:"ui-monospace, monospace",color:"primary.main",cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:()=>window.open("https://sepolia.app.ens.domains/".concat(nU),"_blank"),children:nU})]}),(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Owner"}),(0,a.jsx)(m.Z,{variant:"body1",sx:{fontFamily:"ui-monospace, monospace",color:"primary.main",cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:()=>window.open("".concat((0,eZ.jY)(11155111),"/address/").concat(nB),"_blank"),children:nB})]})]})]})]}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(l.Z,{onClick:()=>nE(!1),children:"Close"})})]}),(0,a.jsx)(eN,{open:nH,onClose:()=>nG(!1)}),(0,a.jsx)(eK,{open:nJ,onClose:()=>nV(!1),agent:{agentId:null!==(eo=null==nq?void 0:nq.agentId)&&void 0!==eo?eo:"",agentAddress:null!==(es=null==nq?void 0:nq.agentAddress)&&void 0!==es?es:"",agentDomain:null!==(el=null==nq?void 0:nq.agentName)&&void 0!==el?el:""},ensName:n$}),(0,a.jsx)(eX,{open:nK,onClose:()=>nX(!1),agent:{agentId:null!==(ed=null==nq?void 0:nq.agentId)&&void 0!==ed?ed:"",agentAddress:null!==(ec=null==nq?void 0:nq.agentAddress)&&void 0!==ec?ec:"",agentName:null!==(ep=null==nq?void 0:nq.agentName)&&void 0!==ep?ep:"",agentENSDomain:null!=n$?n$:"",agentDNSDomain:null!=n$?n$:""},ensName:n$}),(0,a.jsx)(eY,{open:n0,onClose:()=>n2(!1),agentId:null!==(eu=null==n1?void 0:n1.agentId)&&void 0!==eu?eu:"",agentName:null!==(ey=null==n1?void 0:n1.agentName)&&void 0!==ey?ey:""}),(0,a.jsxs)(i.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:["Total: ",null!==(em=null==eO?void 0:eO.total)&&void 0!==em?em:0]}),(0,a.jsxs)(i.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(l.Z,{variant:"outlined",size:"small",disabled:(null!==(eg=null==eO?void 0:eO.page)&&void 0!==eg?eg:1)<=1||eM,onClick:()=>{var e;return ap(Math.max(1,(null!==(e=null==eO?void 0:eO.page)&&void 0!==e?e:1)-1))},children:"Prev"}),(0,a.jsx)(l.Z,{variant:"outlined",size:"small",disabled:eM||(null!==(eh=null==eO?void 0:eO.page)&&void 0!==eh?eh:1)*(null!==(ef=null==eO?void 0:eO.pageSize)&&void 0!==ef?ef:20)>=(null!==(eb=null==eO?void 0:eO.total)&&void 0!==eb?eb:0),onClick:()=>{var e;return ap((null!==(e=null==eO?void 0:eO.page)&&void 0!==e?e:1)+1)},children:"Next"})]})]})]})}var e4=n(36858),e9=n(53790),te=n(83827),tt=n(86522);function tn(e){let t=(0,eZ.h2)(e),n=(0,eZ._V)(e);return t?"L1"===n?"primary":"L2"===n?"secondary":"default":"default"}function ta(e){let{open:t,onClose:n}=e,[i,o]=r.useState(null),[l,p]=r.useState(!0),[u,y]=r.useState(null);return r.useEffect(()=>{if(!t)return;let e=async()=>{try{p(!0),y(null);let e=await fetch("/api/stats");if(!e.ok)throw Error("Failed to fetch stats");let t=await e.json();o(t)}catch(e){y(e.message)}finally{p(!1)}};e();let n=setInterval(e,3e4);return()=>clearInterval(n)},[t]),(0,a.jsxs)(j.Z,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{maxHeight:"90vh"}},children:[(0,a.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,children:"ERC-8004 Agent Statistics"}),(0,a.jsx)(T.Z,{onClick:n,size:"small",children:(0,a.jsx)(e4.Z,{})})]}),(0,a.jsxs)(C.Z,{sx:{p:3},children:[l&&(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:4},children:[(0,a.jsx)(eR.Z,{size:24,sx:{mr:2}}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading statistics..."})]}),u&&(0,a.jsxs)(ek.Z,{severity:"error",sx:{mb:3},children:["Failed to load statistics: ",u]}),i&&!l&&!u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.ZP,{container:!0,spacing:2,sx:{mb:3},children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,a.jsx)(e9.Z,{sx:{mr:1,color:"primary.main"}}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Total Agents"})]}),(0,a.jsx)(m.Z,{variant:"h4",fontWeight:600,children:i.summary.totalAgents.toLocaleString()})]})})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,a.jsx)(te.Z,{sx:{mr:1,color:"secondary.main"}}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Active Chains"})]}),(0,a.jsx)(m.Z,{variant:"h4",fontWeight:600,children:i.summary.totalChains})]})})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,a.jsx)(tt.Z,{sx:{mr:1,color:"success.main"}}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"With ENS"})]}),(0,a.jsx)(m.Z,{variant:"h4",fontWeight:600,children:i.ens.chains.reduce((e,t)=>e+t.withENS,0).toLocaleString()})]})})})]}),(0,a.jsx)(c.ZP,{container:!0,spacing:2,children:i.summary.chains.map(e=>{let t=i.metadata.chains.find(t=>t.chainId===e.chainId),n=i.ens.chains.find(t=>t.chainId===e.chainId),r=i.activity.recent24h.find(t=>t.chainId===e.chainId);return(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,children:e.chainName}),(0,a.jsx)(s.Z,{label:"".concat(e.agentCount," agents"),size:"small",color:tn(e.chainId)})]}),(0,a.jsx)(d.Z,{sx:{mb:1},children:(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:["Metadata: ",(null==t?void 0:t.withMetadata)||0," / ",e.agentCount,"(",(null==t?void 0:t.metadataPercentage)||0,"%)"]})}),(0,a.jsx)(d.Z,{sx:{mb:1},children:(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:["ENS Names: ",(null==n?void 0:n.withENS)||0," / ",e.agentCount,"(",(null==n?void 0:n.ensPercentage)||0,"%)"]})}),(0,a.jsx)(d.Z,{children:(0,a.jsxs)(m.Z,{variant:"body2",color:"text.secondary",children:["Recent (24h): ",(null==r?void 0:r.recentCount)||0," new agents"]})})]})})},e.chainId)})}),i.topAgents.length>0&&(0,a.jsxs)(d.Z,{sx:{mt:3},children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Recent Agents"}),(0,a.jsx)(c.ZP,{container:!0,spacing:1,children:i.topAgents.slice(0,6).map(e=>(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:1.5,border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,a.jsxs)(m.Z,{variant:"body2",fontWeight:600,noWrap:!0,children:["Agent #",e.agentId]}),(0,a.jsx)(s.Z,{label:e.chainName,size:"small",color:tn(e.chainId),sx:{fontSize:"0.7rem"}})]}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",noWrap:!0,children:e.agentName}),e.ensName&&(0,a.jsx)(m.Z,{variant:"caption",color:"primary.main",noWrap:!0,children:e.ensName})]})})},"".concat(e.chainId,"-").concat(e.agentId)))})]})]})]})]})}var tr=n(55723);function ti(){let{isLoggedIn:e,login:t,logout:n}=(0,R.m)(),[i,s]=r.useState(!1),[p,u]=r.useState(!1);return(0,a.jsxs)(tr.Z,{maxWidth:"xl",sx:{py:4},children:[(0,a.jsxs)(d.Z,{sx:{mb:3},children:[(0,a.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,a.jsx)(m.Z,{variant:"h5",fontWeight:600,children:"Agentic Trust Layer - Agent Explorer"}),(0,a.jsxs)(d.Z,{sx:{display:"flex",gap:1},children:[e&&(0,a.jsx)(l.Z,{variant:"outlined",onClick:()=>u(!0),disableElevation:!0,size:"small",children:"View Stats"}),(0,a.jsx)(l.Z,{variant:"contained",onClick:e?n:t,disableElevation:!0,size:"small",children:e?"Disconnect":"Login"})]})]}),(0,a.jsx)(m.Z,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"Discover, evaluate, and connect with AI agents in the agentic ecosystem."})]}),e?(0,a.jsx)(o.Z,{elevation:0,sx:{p:{xs:1,sm:2},bgcolor:"transparent"},children:(0,a.jsx)(e8,{})}):(0,a.jsxs)(d.Z,{sx:{textAlign:"center",py:8},children:[(0,a.jsx)(m.Z,{variant:"h3",fontWeight:600,sx:{mb:3,color:"primary.main"},children:"Create and Manage your Agent Identities"}),(0,a.jsx)(l.Z,{variant:"contained",size:"large",onClick:t,disableElevation:!0,sx:{px:4,py:1.5,fontSize:"1.1rem"},children:"Get Started with Social Login"}),(0,a.jsxs)(c.ZP,{container:!0,spacing:3,sx:{mt:6,maxWidth:"1200px",mx:"auto"},children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,textAlign:"center",border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Social Login, or Wallet"}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Connect with your social account or wallet for seamless agent identity management"})]})})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,textAlign:"center",border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Multi-Chain"}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Manage your agents across multiple blockchain networks with unified control"})]})})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,textAlign:"center",border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Strongly Named"}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Create human-readable agent names with ENS integration for easy identification"})]})})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,textAlign:"center",border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Uniquely Addressable & Onchain Verifiable"}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Each agent has a unique blockchain address with verifiable cryptographic signatures"})]})})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(A.Z,{elevation:0,sx:{p:2,textAlign:"center",border:"1px solid",borderColor:"divider"},children:(0,a.jsxs)(Z.Z,{children:[(0,a.jsx)(m.Z,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Agent Discovery - Trust Graph"}),(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Discover and connect with agents through cross-chain subgraphs and naming services"})]})})})]})]}),(0,a.jsx)(eN,{open:i,onClose:()=>s(!1)}),(0,a.jsx)(ta,{open:p,onClose:()=>u(!1)})]})}}},function(e){e.O(0,[111,28,733,737,351,503,779,744],function(){return e(e.s=95207)}),_N_E=e.O()}]);